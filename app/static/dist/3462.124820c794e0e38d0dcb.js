"use strict";(self.webpackChunkvenezia_frontend=self.webpackChunkvenezia_frontend||[]).push([[3462],{43462:function(e,t,a){a.r(t),a.d(t,{default:function(){return B}});var r=a(96540),l=a(71083),n=a(17133),s=a(32307),i=a(60367),d=a(15977),o=a(80697),m=a(27235),c=a(81966),g=a(44471),u=a(37946),x=a(98445),p=a(35627),b=a(48686),E=a(30862),v=a(70700),y=a(42203),h=(a(93823),a(72284)),f=a(11562),N=a(71428),k=a(28219),w=a(40961),A=a(3213),_=a(47504),C=a(19869),z=a(76069),S=a(86589),T=a(20053),$=({delivery:e,onEdit:t,onDelete:a,onStatusChange:l,onViewDetails:s,onViewRoute:d})=>{const[o,x]=(0,r.useState)(!1),[p,E]=(0,r.useState)({top:0,left:0}),v=(0,r.useRef)(null),y=(0,r.useRef)(null),f={pending:{label:"Pendiente",variant:"warning",icon:m.A,color:"text-amber-600 dark:text-amber-400",bgColor:"bg-amber-50 dark:bg-amber-900/20",borderColor:"border-amber-200 dark:border-amber-800"},assigned:{label:"Asignado",variant:"info",icon:b.A,color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-200 dark:border-blue-800"},in_transit:{label:"En Tránsito",variant:"info",icon:c.A,color:"text-indigo-600 dark:text-indigo-400",bgColor:"bg-indigo-50 dark:bg-indigo-900/20",borderColor:"border-indigo-200 dark:border-indigo-800"},delivered:{label:"Entregado",variant:"success",icon:g.A,color:"text-emerald-600 dark:text-emerald-400",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",borderColor:"border-emerald-200 dark:border-emerald-800"},failed:{label:"Fallido",variant:"danger",icon:u.A,color:"text-red-600 dark:text-red-400",bgColor:"bg-red-50 dark:bg-red-900/20",borderColor:"border-red-200 dark:border-red-800"}},N=f[e.status]||f.pending,$=N.icon;(0,r.useEffect)((()=>{const e=e=>{v.current&&!v.current.contains(e.target)&&y.current&&!y.current.contains(e.target)&&x(!1)};if(o)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[o]);const j=e=>{x(!1),e()};return r.createElement("div",{className:"bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-900 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-xl hover:shadow-venezia-100/50 dark:hover:shadow-venezia-900/50 hover:border-venezia-300 dark:hover:border-venezia-700 hover:-translate-y-1 transition-all duration-300 relative overflow-hidden group cursor-pointer"},r.createElement("div",{className:(0,T.A)("absolute top-0 left-0 right-0 h-1 transition-all duration-300 group-hover:h-1.5","pending"===e.status&&"bg-gradient-to-r from-amber-400 to-orange-500","assigned"===e.status&&"bg-gradient-to-r from-blue-400 to-blue-600","in_transit"===e.status&&"bg-gradient-to-r from-indigo-400 to-purple-600","delivered"===e.status&&"bg-gradient-to-r from-emerald-400 to-green-600","failed"===e.status&&"bg-gradient-to-r from-red-400 to-red-600")}),r.createElement("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700 ease-out"}),r.createElement("div",{className:"p-3"},r.createElement("div",{className:"flex items-start justify-between mb-2"},r.createElement("div",{className:"flex-1"},r.createElement("div",{className:"flex items-center gap-1 mb-1"},r.createElement("h3",{className:"text-sm font-medium text-gray-900 dark:text-white"},"#",e.order_number||e.id),r.createElement(k.A,{variant:N.variant,size:"xs"},r.createElement($,{className:"w-2.5 h-2.5 mr-1"}),N.label),e.priority&&"normal"!==e.priority&&r.createElement("span",{className:(0,T.A)("px-1.5 py-0.5 text-xs font-medium rounded-full",{low:"bg-gray-100 text-gray-600",normal:"bg-blue-100 text-blue-700",high:"bg-orange-100 text-orange-700",urgent:"bg-red-100 text-red-700"}[e.priority])},"urgent"===e.priority?"Urgente":"Alta")),r.createElement("p",{className:"text-xs text-gray-500 dark:text-gray-400"},"Hace ",(e=>{const t=Math.floor((Date.now()-new Date(e))/6e4);if(t<60)return`${t} min`;const a=Math.floor(t/60);return a<24?`${a}h`:`${Math.floor(a/24)}d`})(e.created_at))),r.createElement("div",{className:"relative"},r.createElement(h.A,{ref:y,variant:"ghost",size:"xs",icon:A.A,onClick:e=>{if(!o){const t=e.currentTarget.getBoundingClientRect();E({top:t.bottom+window.scrollY+2,left:t.right-160+window.scrollX})}x(!o)},className:"text-gray-400 hover:text-venezia-600 dark:hover:text-venezia-400 p-1.5 hover:bg-venezia-50 dark:hover:bg-venezia-900/20 rounded-lg transition-all duration-200 hover:scale-110"}),o&&(0,w.createPortal)(r.createElement("div",{ref:v,className:"fixed w-40 bg-white/95 dark:bg-gray-800/95 backdrop-blur-md rounded-xl shadow-xl ring-1 ring-black/10 dark:ring-white/10 z-50 py-2 animate-in slide-in-from-top-2 duration-200",style:{top:`${p.top}px`,left:`${p.left}px`}},r.createElement("button",{onClick:()=>j((()=>s(e))),className:"w-full text-left px-4 py-2.5 text-xs text-gray-700 dark:text-gray-300 hover:bg-venezia-50 dark:hover:bg-venezia-900/20 hover:text-venezia-700 dark:hover:text-venezia-300 flex items-center gap-3 transition-all duration-200 rounded-lg mx-1"},r.createElement(n.A,{className:"w-4 h-4 text-purple-500"}),"Ver Detalles"),r.createElement("button",{onClick:()=>j((()=>d(e))),className:"w-full text-left px-4 py-2.5 text-xs text-gray-700 dark:text-gray-300 hover:bg-venezia-50 dark:hover:bg-venezia-900/20 hover:text-venezia-700 dark:hover:text-venezia-300 flex items-center gap-3 transition-all duration-200 rounded-lg mx-1"},r.createElement(i.A,{className:"w-4 h-4 text-blue-500"}),"Ver Ruta"),"pending"===e.status&&r.createElement("button",{onClick:()=>j((()=>l(e,"assigned"))),className:"w-full text-left px-4 py-2.5 text-xs text-gray-700 dark:text-gray-300 hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:text-blue-700 dark:hover:text-blue-300 flex items-center gap-3 transition-all duration-200 rounded-lg mx-1"},r.createElement(b.A,{className:"w-4 h-4 text-blue-500"}),"Asignar Repartidor"),"assigned"===e.status&&r.createElement("button",{onClick:()=>j((()=>l(e,"in_transit"))),className:"w-full text-left px-4 py-2.5 text-xs text-gray-700 dark:text-gray-300 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 hover:text-indigo-700 dark:hover:text-indigo-300 flex items-center gap-3 transition-all duration-200 rounded-lg mx-1"},r.createElement(c.A,{className:"w-4 h-4 text-indigo-500"}),"Iniciar Entrega"),"in_transit"===e.status&&r.createElement("button",{onClick:()=>j((()=>l(e,"delivered"))),className:"w-full text-left px-4 py-2.5 text-xs text-gray-700 dark:text-gray-300 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 hover:text-emerald-700 dark:hover:text-emerald-300 flex items-center gap-3 transition-all duration-200 rounded-lg mx-1"},r.createElement(g.A,{className:"w-4 h-4 text-emerald-500"}),"Marcar Entregado"),r.createElement("div",{className:"border-t border-gray-200/50 dark:border-gray-600/50 my-1"}),r.createElement("button",{onClick:()=>j((()=>t(e))),className:"w-full text-left px-4 py-2.5 text-xs text-gray-700 dark:text-gray-300 hover:bg-amber-50 dark:hover:bg-amber-900/20 hover:text-amber-700 dark:hover:text-amber-300 flex items-center gap-3 transition-all duration-200 rounded-lg mx-1"},r.createElement(_.A,{className:"w-4 h-4 text-amber-500"}),"Editar Notas"),"pending"===e.status&&r.createElement("button",{onClick:()=>j((()=>a(e.id))),className:"w-full text-left px-4 py-2.5 text-xs text-gray-700 dark:text-gray-300 hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-700 dark:hover:text-red-300 flex items-center gap-3 transition-all duration-200 rounded-lg mx-1"},r.createElement(u.A,{className:"w-4 h-4 text-red-500"}),"Cancelar")),document.body))),r.createElement("div",{className:"space-y-1.5 mb-3"},r.createElement("div",{className:"flex items-center gap-2 text-xs"},r.createElement(b.A,{className:"w-3.5 h-3.5 text-slate-500 dark:text-slate-400"}),r.createElement("span",{className:"font-medium text-gray-900 dark:text-white"},e.customer_name)),e.customer_phone&&r.createElement("div",{className:"flex items-center gap-2 text-xs"},r.createElement(C.A,{className:"w-3.5 h-3.5 text-green-500 dark:text-green-400"}),r.createElement("a",{href:`tel:${e.customer_phone}`,className:"text-green-600 hover:text-green-700 dark:text-green-400 font-medium transition-colors"},e.customer_phone)),r.createElement("div",{className:"flex items-start gap-2 text-xs"},r.createElement(z.A,{className:"w-3.5 h-3.5 text-red-500 dark:text-red-400 mt-0.5 flex-shrink-0"}),r.createElement("span",{className:"text-gray-600 dark:text-gray-400 leading-relaxed"},(D=e.address)?`${D.street||""} ${D.number||""}, ${D.neighborhood||""}`:"Sin dirección"))),r.createElement("div",{className:"grid grid-cols-2 gap-3 mb-3"},r.createElement("div",{className:"flex items-center gap-2"},r.createElement(c.A,{className:"w-3.5 h-3.5 text-blue-500 dark:text-blue-400"}),r.createElement("div",null,r.createElement("p",{className:"text-xs text-gray-500 dark:text-gray-400"},"Repartidor"),r.createElement("p",{className:"text-xs font-medium text-gray-900 dark:text-white"},e.driver_name||"Sin asignar"))),r.createElement("div",{className:"flex items-center gap-2"},r.createElement(m.A,{className:"w-3.5 h-3.5 text-indigo-500 dark:text-indigo-400"}),r.createElement("div",null,r.createElement("p",{className:"text-xs text-gray-500 dark:text-gray-400"},"Estimado"),r.createElement("p",{className:"text-xs font-medium text-gray-900 dark:text-white"},e.estimated_time||"Por definir")))),e.items&&e.items.length>0&&r.createElement("div",{className:"border-t border-gray-100 dark:border-gray-700 pt-3 mb-3"},r.createElement("div",{className:"flex items-center gap-2 mb-2"},r.createElement(n.A,{className:"w-3.5 h-3.5 text-purple-500 dark:text-purple-400"}),r.createElement("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300"},"Productos (",e.items.length,")")),r.createElement("div",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-1"},e.items.slice(0,2).map(((e,t)=>r.createElement("div",{key:t,className:"flex justify-between"},r.createElement("span",null,e.quantity,"x ",e.product_name),e.price&&r.createElement("span",{className:"text-gray-500"},"$",e.price*e.quantity)))),e.items.length>2&&r.createElement("div",{className:"text-xs text-gray-500 italic"},"+",e.items.length-2," productos más..."))),r.createElement("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100 dark:border-gray-700"},r.createElement("div",{className:"flex items-center gap-2 text-xs text-gray-500"},r.createElement(S.A,{className:"w-3.5 h-3.5 text-emerald-500 dark:text-emerald-400"}),r.createElement("span",{className:"font-medium"},"Total")),r.createElement("span",{className:"text-sm font-bold text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/20 px-2 py-1 rounded-md"},"$",e.total_amount?.toFixed(2)||"0.00")),e.notes&&r.createElement("div",{className:"mt-3 flex gap-2"},r.createElement(_.A,{className:"w-3.5 h-3.5 text-amber-500 dark:text-amber-400 mt-0.5 flex-shrink-0"}),r.createElement("div",{className:"p-2 bg-amber-50 dark:bg-amber-900/20 rounded-lg text-xs text-amber-700 dark:text-amber-300 border border-amber-200 dark:border-amber-800"},e.notes))));var D},j=a(48697),D=a(48852),P=a(67773),O=a(76894),F=({isOpen:e,onClose:t,onSave:a,delivery:l=null,drivers:i=[],orders:d=[]})=>{const[o,g]=(0,r.useState)({order_id:"",driver_id:"",customer_name:"",customer_phone:"",address:{street:"",number:"",neighborhood:"",city:"Buenos Aires",instructions:""},scheduled_date:(new Date).toISOString().split("T")[0],scheduled_time:"",priority:"normal",estimated_time:"30-45 min",notes:""}),[u,x]=(0,r.useState)({}),[p,E]=(0,r.useState)(!1),[v,y]=(0,r.useState)(null);(0,r.useEffect)((()=>{g(l?{order_id:l.order_id||"",driver_id:l.driver_id||"",customer_name:l.customer_name||"",customer_phone:l.customer_phone||"",address:l.address||{street:"",number:"",neighborhood:"",city:"Buenos Aires",instructions:""},scheduled_date:l.scheduled_date?new Date(l.scheduled_date).toISOString().split("T")[0]:(new Date).toISOString().split("T")[0],scheduled_time:l.scheduled_time||"",priority:l.priority||"normal",estimated_time:l.estimated_time||"30-45 min",notes:l.notes||""}:{order_id:"",driver_id:"",customer_name:"",customer_phone:"",address:{street:"",number:"",neighborhood:"",city:"Buenos Aires",instructions:""},scheduled_date:(new Date).toISOString().split("T")[0],scheduled_time:"",priority:"normal",estimated_time:"30-45 min",notes:""}),x({})}),[l]),(0,r.useEffect)((()=>{if(o.order_id){const e=d.find((e=>e.id===parseInt(o.order_id)));e&&(y(e),g((t=>({...t,customer_name:e.customer_name||t.customer_name,customer_phone:e.customer_phone||t.customer_phone,address:e.delivery_address||t.address}))))}else y(null)}),[o.order_id,d]);const k=e=>{const{name:t,value:a}=e.target;g((e=>({...e,[t]:a}))),u[t]&&x((e=>({...e,[t]:""})))},w=e=>{const{name:t,value:a}=e.target;g((e=>({...e,address:{...e.address,[t]:a}}))),u.address&&x((e=>({...e,address:null})))};return r.createElement(P.A,{isOpen:e,onClose:t,title:r.createElement("div",{className:"flex items-center gap-2"},r.createElement(c.A,{className:"w-5 h-5"}),l?"Editar Entrega":"Nueva Entrega"),size:"lg"},r.createElement("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return o.customer_name.trim()||(e.customer_name="El nombre del cliente es requerido"),o.address.street.trim()||(e.address="La dirección es requerida"),x(e),0===Object.keys(e).length})()){E(!0);try{const e={...o,status:l?.status||"pending",created_by:l?.created_by||"current_user",...l&&{items:l.items,total_amount:l.total_amount,order_number:l.order_number,created_at:l.created_at}};await a(e),t()}catch(e){x({general:"Error al guardar la entrega"})}finally{E(!1)}}},className:"space-y-6"},u.general&&r.createElement(O.A,{error:u.general,variant:"block"}),!l&&d.length>0&&r.createElement(N.A,{label:"Orden de Venta",name:"order_id",value:o.order_id,onChange:k,options:[{value:"",label:"Seleccionar orden (opcional)"},...d.map((e=>({value:e.id.toString(),label:`#${e.id} - ${e.customer_name} - $${e.total}`})))],icon:n.A}),r.createElement("div",{className:"space-y-4"},r.createElement("h3",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2"},r.createElement(b.A,{className:"w-4 h-4"}),"Información del Cliente"),r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},r.createElement(f.A,{label:"Nombre",name:"customer_name",value:o.customer_name,onChange:k,placeholder:"Nombre completo",error:u.customer_name,required:!0}),r.createElement(f.A,{label:"Teléfono (opcional)",name:"customer_phone",type:"tel",value:o.customer_phone,onChange:k,placeholder:"+54 11 1234-5678",error:u.customer_phone,icon:C.A}))),r.createElement("div",{className:"space-y-4"},r.createElement("h3",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2"},r.createElement(z.A,{className:"w-4 h-4"}),"Dirección de Entrega"),r.createElement("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4"},r.createElement("div",{className:"col-span-2"},r.createElement(f.A,{label:"Calle",name:"street",value:o.address.street,onChange:w,placeholder:"Av. Corrientes",error:u.address,required:!0})),r.createElement(f.A,{label:"Número",name:"number",value:o.address.number,onChange:w,placeholder:"1234"}),r.createElement(f.A,{label:"Barrio",name:"neighborhood",value:o.address.neighborhood,onChange:w,placeholder:"Palermo"}),r.createElement(f.A,{label:"Ciudad",name:"city",value:o.address.city,onChange:w,placeholder:"Buenos Aires"})),r.createElement(f.A,{label:"Instrucciones de entrega",name:"instructions",value:o.address.instructions,onChange:w,placeholder:"Timbre 2B, portón negro",multiline:!0,rows:2})),r.createElement("div",{className:"space-y-4"},r.createElement("h3",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2"},r.createElement(s.A,{className:"w-4 h-4"}),"Programación"),r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4"},r.createElement(f.A,{label:"Fecha",name:"scheduled_date",type:"date",value:o.scheduled_date,onChange:k,error:u.scheduled_date,min:(new Date).toISOString().split("T")[0],required:!0}),r.createElement(N.A,{label:"Franja horaria",name:"scheduled_time",value:o.scheduled_time,onChange:k,options:[{value:"",label:"Seleccionar"},{value:"09:00-11:00",label:"9:00 - 11:00"},{value:"11:00-13:00",label:"11:00 - 13:00"},{value:"13:00-15:00",label:"13:00 - 15:00"},{value:"15:00-17:00",label:"15:00 - 17:00"},{value:"17:00-19:00",label:"17:00 - 19:00"},{value:"19:00-21:00",label:"19:00 - 21:00"}],icon:m.A}),r.createElement(N.A,{label:"Prioridad",name:"priority",value:o.priority,onChange:k,options:[{value:"low",label:"Baja"},{value:"normal",label:"Normal"},{value:"high",label:"Alta"},{value:"urgent",label:"Urgente"}]}))),r.createElement("div",{className:"space-y-4"},r.createElement("h3",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2"},r.createElement(c.A,{className:"w-4 h-4"}),"Asignación"),r.createElement(N.A,{label:"Repartidor (opcional)",name:"driver_id",value:o.driver_id,onChange:k,options:[{value:"",label:"Sin asignar (se puede asignar después)"},...i.map((e=>({value:e.id.toString(),label:`${e.name} ${e.available?"":"(No disponible)"}`})))],icon:b.A}),r.createElement(f.A,{label:"Tiempo estimado de entrega",name:"estimated_time",value:o.estimated_time,onChange:k,placeholder:"30-45 min",icon:m.A})),r.createElement(f.A,{label:"Notas",name:"notes",value:o.notes,onChange:k,placeholder:"Instrucciones especiales o comentarios",multiline:!0,rows:3,icon:_.A}),v&&r.createElement("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4"},r.createElement("h3",{className:"font-medium text-gray-900 dark:text-white mb-3"},"Resumen del Pedido"),r.createElement("div",{className:"space-y-2 text-sm"},v.items?.map(((e,t)=>r.createElement("div",{key:t,className:"flex justify-between"},r.createElement("span",null,e.quantity,"x ",e.product_name),r.createElement("span",null,"$",(e.quantity*e.price).toFixed(2))))),r.createElement("div",{className:"pt-2 border-t dark:border-gray-600 flex justify-between font-medium"},r.createElement("span",null,"Total"),r.createElement("span",{className:"text-venezia-600 dark:text-venezia-400"},"$",v.total.toFixed(2))))),r.createElement("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700"},r.createElement(h.A,{type:"button",onClick:t,variant:"outline",icon:j.A},"Cancelar"),r.createElement(h.A,{type:"submit",variant:"primary",icon:D.A,loading:p},l?"Actualizar":"Crear"," Entrega"))))},R=a(85265),I=({isOpen:e,onClose:t,deliveries:a=[],driver:l=null})=>{const[s,d]=(0,r.useState)([]),[o,x]=(0,r.useState)(null),[p,E]=(0,r.useState)(0),[v,y]=(0,r.useState)(0),f={pending:"bg-gray-100 text-gray-700",in_transit:"bg-yellow-100 text-yellow-700",delivered:"bg-green-100 text-green-700",failed:"bg-red-100 text-red-700"};return(0,r.useEffect)((()=>{if(a.length>0){const e=[...a].sort(((e,t)=>{const a={urgent:0,high:1,normal:2,low:3},r=a[e.priority]-a[t.priority];return 0!==r?r:new Date(e.scheduled_date)-new Date(t.scheduled_date)}));d(e),E(2.5*e.length),y(15*e.length+30)}}),[a]),r.createElement(P.A,{isOpen:e,onClose:t,title:r.createElement("div",{className:"flex items-center gap-2"},r.createElement(i.A,{className:"w-5 h-5"}),"Ruta de Entrega"),size:"xl"},r.createElement("div",{className:"space-y-6"},l&&r.createElement("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",{className:"flex items-center gap-3"},r.createElement("div",{className:"w-10 h-10 bg-venezia-100 dark:bg-venezia-900/20 rounded-full flex items-center justify-center"},r.createElement(b.A,{className:"w-5 h-5 text-venezia-600 dark:text-venezia-400"})),r.createElement("div",null,r.createElement("p",{className:"font-medium text-gray-900 dark:text-white"},l.name),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},l.vehicle," • ",l.phone))),r.createElement(k.A,{variant:"success"},"Activo"))),r.createElement("div",{className:"grid grid-cols-3 gap-4"},r.createElement("div",{className:"text-center"},r.createElement("p",{className:"text-2xl font-bold text-gray-900 dark:text-white"},s.length),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Entregas")),r.createElement("div",{className:"text-center"},r.createElement("p",{className:"text-2xl font-bold text-gray-900 dark:text-white"},p.toFixed(1)," km"),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Distancia total")),r.createElement("div",{className:"text-center"},r.createElement("p",{className:"text-2xl font-bold text-gray-900 dark:text-white"},Math.floor(v/60),"h ",v%60,"m"),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Tiempo estimado"))),r.createElement("div",{className:"flex justify-center"},r.createElement(h.A,{onClick:()=>{const e=[...s].sort((()=>Math.random()-.5));d(e)},variant:"outline",icon:R.A},"Optimizar Ruta")),r.createElement("div",{className:"space-y-4"},r.createElement("h3",{className:"font-medium text-gray-900 dark:text-white"},"Orden de entregas"),r.createElement("div",{className:"space-y-2"},s.map(((e,t)=>{const a=(e=>{switch(e){case"delivered":return g.A;case"failed":return u.A;case"in_transit":return c.A;default:return z.A}})(e.status),l=o?.id===e.id;return r.createElement("div",{key:e.id,className:(0,T.A)("relative pl-8 pb-8 cursor-pointer transition-colors","hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-lg p-4 -m-4",l&&"bg-venezia-50 dark:bg-venezia-900/20"),onClick:()=>x(l?null:e)},t<s.length-1&&r.createElement("div",{className:"absolute left-4 top-10 bottom-0 w-0.5 bg-gray-300 dark:bg-gray-600"}),r.createElement("div",{className:(0,T.A)("absolute left-2 top-4 w-4 h-4 rounded-full border-2","delivered"===e.status?"bg-green-500 border-green-500":"in_transit"===e.status?"bg-yellow-500 border-yellow-500":"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600")}),r.createElement("div",{className:"flex items-start justify-between"},r.createElement("div",{className:"flex-1"},r.createElement("div",{className:"flex items-center gap-2 mb-1"},r.createElement("span",{className:"text-sm font-medium text-gray-500"},"#",t+1),r.createElement("h4",{className:"font-medium text-gray-900 dark:text-white"},e.customer_name),r.createElement("span",{className:(0,T.A)("px-2 py-0.5 text-xs rounded-full",f[e.status])},"pending"===e.status&&"Pendiente","in_transit"===e.status&&"En camino","delivered"===e.status&&"Entregado","failed"===e.status&&"Fallido")),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1"},r.createElement(z.A,{className:"inline w-3 h-3 mr-1"}),(i=e.address)?`${i.street} ${i.number}, ${i.neighborhood}`:"Sin dirección"),e.scheduled_time&&r.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-500"},r.createElement(m.A,{className:"inline w-3 h-3 mr-1"}),e.scheduled_time)),r.createElement(a,{className:(0,T.A)("w-5 h-5 flex-shrink-0 ml-3","delivered"===e.status&&"text-green-500","failed"===e.status&&"text-red-500","in_transit"===e.status&&"text-yellow-500","pending"===e.status&&"text-gray-400")})),l&&r.createElement("div",{className:"mt-3 pt-3 border-t dark:border-gray-700 space-y-2"},r.createElement("div",{className:"flex items-center gap-2 text-sm"},r.createElement(C.A,{className:"w-4 h-4 text-gray-400"}),r.createElement("a",{href:`tel:${e.customer_phone}`,className:"text-venezia-600 hover:text-venezia-700",onClick:e=>e.stopPropagation()},e.customer_phone)),e.items&&r.createElement("div",{className:"text-sm text-gray-600 dark:text-gray-400"},r.createElement(n.A,{className:"inline w-4 h-4 mr-1"}),e.items.length," productos"),e.notes&&r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400 italic"},'"',e.notes,'"')));var i})))),r.createElement("div",{className:"bg-gray-100 dark:bg-gray-700 rounded-lg h-64 flex items-center justify-center"},r.createElement("div",{className:"text-center"},r.createElement(z.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),r.createElement("p",{className:"text-gray-500 dark:text-gray-400"},"Vista del mapa disponible próximamente"))),r.createElement("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700"},r.createElement(h.A,{onClick:t,variant:"outline",icon:j.A},"Cerrar"),r.createElement(h.A,{variant:"primary",icon:i.A},"Iniciar Navegación"))))},L=a(67561),q=a(3385),H=({isOpen:e,onClose:t,delivery:a})=>{if(!a)return null;const l={pending:{label:"Pendiente",variant:"default",icon:m.A,color:"text-gray-600"},assigned:{label:"Asignado",variant:"info",icon:b.A,color:"text-blue-600"},in_transit:{label:"En Tránsito",variant:"warning",icon:c.A,color:"text-yellow-600"},delivered:{label:"Entregado",variant:"success",icon:g.A,color:"text-green-600"},failed:{label:"Fallido",variant:"danger",icon:u.A,color:"text-red-600"}},i=l[a.status]||l.pending,d=i.icon,o=e=>new Date(e).toLocaleString("es-AR",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return(0,w.createPortal)(r.createElement(L.N,null,e&&r.createElement("div",{className:"fixed inset-0 z-[9999] overflow-y-auto"},r.createElement(q.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,className:"fixed inset-0 bg-black/50 backdrop-blur-sm"}),r.createElement("div",{className:"min-h-full flex items-center justify-center p-4"},r.createElement(q.P.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"relative w-full max-w-2xl max-h-[90vh] bg-white dark:bg-gray-800 rounded-xl shadow-2xl overflow-hidden"},r.createElement("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",{className:"flex items-center gap-3"},r.createElement(n.A,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"}),r.createElement("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white"},"Detalles de Entrega #",a.order_number||a.id)),r.createElement("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors"},r.createElement(j.A,{className:"h-5 w-5"})))),r.createElement("div",{className:"overflow-y-auto max-h-[calc(90vh-140px)]"},r.createElement("div",{className:"p-6 space-y-6"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement(k.A,{variant:i.variant,size:"lg"},r.createElement(d,{className:"w-4 h-4 mr-2"}),i.label),r.createElement("div",{className:"text-sm text-gray-500 dark:text-gray-400"},r.createElement(s.A,{className:"inline-block w-4 h-4 mr-1"}),o(a.created_at))),r.createElement("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4"},r.createElement("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3 flex items-center gap-2"},r.createElement(b.A,{className:"w-4 h-4"}),"Información del Cliente"),r.createElement("div",{className:"space-y-2"},r.createElement("div",null,r.createElement("span",{className:"text-xs text-gray-500 dark:text-gray-400"},"Nombre:"),r.createElement("p",{className:"text-sm font-medium text-gray-900 dark:text-white"},a.customer_name)),a.customer_phone&&r.createElement("div",null,r.createElement("span",{className:"text-xs text-gray-500 dark:text-gray-400"},"Teléfono:"),r.createElement("p",{className:"text-sm font-medium"},r.createElement("a",{href:`tel:${a.customer_phone}`,className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 flex items-center gap-1"},r.createElement(C.A,{className:"w-3 h-3"}),a.customer_phone))),r.createElement("div",null,r.createElement("span",{className:"text-xs text-gray-500 dark:text-gray-400"},"Dirección:"),r.createElement("p",{className:"text-sm font-medium text-gray-900 dark:text-white flex items-start gap-1"},r.createElement(z.A,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),(x=a.address)?`${x.street||""} ${x.number||""}, ${x.neighborhood||""}, ${x.city||""}`:"Sin dirección especificada")))),r.createElement("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4"},r.createElement("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3 flex items-center gap-2"},r.createElement(c.A,{className:"w-4 h-4"}),"Información de Entrega"),r.createElement("div",{className:"grid grid-cols-2 gap-4"},r.createElement("div",null,r.createElement("span",{className:"text-xs text-gray-500 dark:text-gray-400"},"Repartidor:"),r.createElement("p",{className:"text-sm font-medium text-gray-900 dark:text-white"},a.driver_name||"Sin asignar")),r.createElement("div",null,r.createElement("span",{className:"text-xs text-gray-500 dark:text-gray-400"},"Tiempo Estimado:"),r.createElement("p",{className:"text-sm font-medium text-gray-900 dark:text-white"},a.estimated_time||"Por definir")),a.delivered_at&&r.createElement("div",{className:"col-span-2"},r.createElement("span",{className:"text-xs text-gray-500 dark:text-gray-400"},"Entregado:"),r.createElement("p",{className:"text-sm font-medium text-green-600 dark:text-green-400"},o(a.delivered_at))))),a.items&&a.items.length>0&&r.createElement("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4"},r.createElement("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3 flex items-center gap-2"},r.createElement(n.A,{className:"w-4 h-4"}),"Productos (",a.items.length,")"),r.createElement("div",{className:"space-y-2"},a.items.map(((e,t)=>r.createElement("div",{key:t,className:"flex items-center justify-between text-sm"},r.createElement("div",{className:"flex items-center gap-2"},r.createElement("span",{className:"text-gray-600 dark:text-gray-400"},e.quantity,"x"),r.createElement("span",{className:"font-medium text-gray-900 dark:text-white"},e.product_name)),r.createElement("span",{className:"font-medium text-gray-900 dark:text-white"},"$",(e.price*e.quantity).toFixed(2))))),r.createElement("div",{className:"pt-2 mt-2 border-t border-gray-200 dark:border-gray-600"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("span",{className:"text-sm font-medium text-gray-900 dark:text-white"},"Total"),r.createElement("span",{className:"text-lg font-bold text-gray-900 dark:text-white"},"$",a.total_amount?.toFixed(2)||"0.00"))))),a.notes&&r.createElement("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4"},r.createElement("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2"},r.createElement(_.A,{className:"w-4 h-4"}),"Notas"),r.createElement("p",{className:"text-sm text-gray-700 dark:text-gray-300"},a.notes)))),r.createElement("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800"},r.createElement("div",{className:"flex justify-end gap-3"},r.createElement(h.A,{variant:"outline",onClick:t},"Cerrar"),a.customer_phone&&r.createElement(h.A,{variant:"primary",icon:C.A,onClick:()=>window.location.href=`tel:${a.customer_phone}`},"Llamar Cliente"))))))),document.body);var x},M=a(10607),B=()=>{const[e,t]=(0,r.useState)("all"),[a,w]=(0,r.useState)(""),[A,_]=(0,r.useState)("all"),[C,z]=(0,r.useState)("all"),[S,j]=(0,r.useState)("all"),[D,P]=(0,r.useState)("grid"),[O,R]=(0,r.useState)(!1),[L,q]=(0,r.useState)(!1),[B,V]=(0,r.useState)(!1),[W,U]=(0,r.useState)(null),[G,J]=(0,r.useState)(null),{success:X,error:Y,warning:K}=(0,y.d)(),{data:Q,loading:Z,error:ee,refetch:te}=(0,v.Wl)("/api/deliveries"),{data:ae,loading:re,refetch:le}=(0,v.Wl)("/api/drivers"),{data:ne,loading:se}=(0,v.Wl)("/api/sales"),ie=Q||[],de=ae||[],oe=ne?.sales||ne||[],me=Z||re||se,ce=(0,r.useMemo)((()=>{const e=new Date;e.setHours(0,0,0,0);const t=ie.filter((t=>{const a=new Date(t.scheduled_date);return a.setHours(0,0,0,0),a.getTime()===e.getTime()}));return{total:t.length,pending:t.filter((e=>"pending"===e.status)).length,inTransit:t.filter((e=>"in_transit"===e.status)).length,delivered:t.filter((e=>"delivered"===e.status)).length,failed:t.filter((e=>"failed"===e.status)).length}}),[ie]),ge=(0,r.useMemo)((()=>ie.filter((e=>{const t=e.customer_name?.toLowerCase().includes(a.toLowerCase())||e.customer_phone?.includes(a)||e.order_number?.toString().includes(a)||e.address?.street?.toLowerCase().includes(a.toLowerCase()),r="all"===A||e.status===A,l="all"===C||e.driver_id===parseInt(C);let n=!0;if("all"!==S){const t=new Date(e.scheduled_date),a=new Date;switch(S){case"today":t.setHours(0,0,0,0),a.setHours(0,0,0,0),n=t.getTime()===a.getTime();break;case"tomorrow":const e=new Date(a);e.setDate(e.getDate()+1),t.setHours(0,0,0,0),e.setHours(0,0,0,0),n=t.getTime()===e.getTime();break;case"week":const r=new Date;r.setDate(r.getDate()-7),n=t>=r}}return t&&r&&l&&n})).sort(((e,t)=>{const a={urgent:0,high:1,normal:2,low:3},r=a[e.priority]-a[t.priority];return 0!==r?r:new Date(e.scheduled_date)-new Date(t.scheduled_date)}))),[ie,a,A,C,S]),ue=(0,r.useMemo)((()=>{const e={};return ge.forEach((t=>{const a=t.driver_id||"unassigned";e[a]||(e[a]=[]),e[a].push(t)})),e}),[ge]),xe=async(e,t)=>{try{const a=await fetch(`/api/deliveries/${e.id}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})});if(a.ok)X("Estado actualizado",`La entrega ahora está ${ve(t)}`),te();else{const e=await a.json();Y("Error",e.error||"No se pudo actualizar el estado")}}catch(a){if(console.error("Error updating status:",a),a.message.includes("Failed to fetch")||a.message.includes("NetworkError"))try{E.A.updateStatus(e.id,t),E.A.syncWithApiCache(),X("Estado actualizado",`La entrega ahora está ${ve(t)} (modo offline)`),te()}catch(e){Y("Error","No se pudo actualizar el estado localmente")}else Y("Error","Error al actualizar el estado")}},pe=async e=>{if(window.confirm("¿Está seguro de cancelar esta entrega?"))try{const t=await fetch(`/api/deliveries/${e}`,{method:"DELETE"});if(t.ok)X("Cancelado","Entrega cancelada correctamente"),te();else{const e=await t.json();Y("Error",e.error||"No se pudo cancelar la entrega")}}catch(t){if(console.error("Error deleting delivery:",t),t.message.includes("Failed to fetch")||t.message.includes("NetworkError"))try{E.A.delete(e),E.A.syncWithApiCache(),X("Cancelado","Entrega cancelada correctamente (modo offline)"),te()}catch(e){Y("Error","No se pudo cancelar la entrega localmente")}else Y("Error","Error al cancelar la entrega")}},be=e=>{if(e.driver_id){const t=de.find((t=>t.id===e.driver_id));ue[e.driver_id],J(t),q(!0)}else K("Sin repartidor","Esta entrega no tiene un repartidor asignado")},Ee=e=>{U(e),V(!0)},ve=e=>({pending:"Pendiente",assigned:"Asignado",in_transit:"En Tránsito",delivered:"Entregado",failed:"Fallido"}[e]||e),ye=[{id:"all",label:"Todas",icon:n.A,count:ge.length},{id:"today",label:"Hoy",icon:s.A,count:ce.total},{id:"routes",label:"Rutas",icon:i.A,count:Object.keys(ue).filter((e=>"unassigned"!==e)).length}];return r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3"},r.createElement("div",null,r.createElement("h1",{className:"text-lg font-bold text-gray-900 dark:text-white"},"Gestión de Entregas"),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1"},"Control y seguimiento de entregas a domicilio")),r.createElement("div",{className:"flex items-center gap-2"},r.createElement(h.A,{onClick:()=>{te(),le(),X("Actualizado","Datos actualizados correctamente")},variant:"outline",size:"sm",icon:d.A},"Actualizar"),r.createElement(h.A,{onClick:()=>{U(null),R(!0)},variant:"primary",icon:o.A},"Nueva Entrega"))),r.createElement("div",{className:"grid grid-cols-2 sm:grid-cols-5 gap-3"},r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-md shadow-sm p-3 border dark:border-gray-700"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-xs text-gray-600 dark:text-gray-400"},"Total Hoy"),r.createElement("p",{className:"text-lg font-bold mt-1"},ce.total)),r.createElement(n.A,{className:"w-6 h-6 text-gray-400"}))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-md shadow-sm p-3 border dark:border-gray-700"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-xs text-gray-600 dark:text-gray-400"},"Pendientes"),r.createElement("p",{className:"text-lg font-bold mt-1 text-yellow-600"},ce.pending)),r.createElement(m.A,{className:"w-6 h-6 text-yellow-600"}))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-md shadow-sm p-3 border dark:border-gray-700"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-xs text-gray-600 dark:text-gray-400"},"En Tránsito"),r.createElement("p",{className:"text-lg font-bold mt-1 text-blue-600"},ce.inTransit)),r.createElement(c.A,{className:"w-6 h-6 text-blue-600"}))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-md shadow-sm p-3 border dark:border-gray-700"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-xs text-gray-600 dark:text-gray-400"},"Entregadas"),r.createElement("p",{className:"text-lg font-bold mt-1 text-green-600"},ce.delivered)),r.createElement(g.A,{className:"w-6 h-6 text-green-600"}))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-md shadow-sm p-3 border dark:border-gray-700"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-xs text-gray-600 dark:text-gray-400"},"Fallidas"),r.createElement("p",{className:"text-lg font-bold mt-1 text-red-600"},ce.failed)),r.createElement(u.A,{className:"w-6 h-6 text-red-600"})))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-md shadow-sm border dark:border-gray-700"},r.createElement("div",{className:"border-b dark:border-gray-700"},r.createElement("div",{className:"flex overflow-x-auto"},ye.map((a=>{const l=a.icon;return r.createElement("button",{key:a.id,onClick:()=>t(a.id),className:(0,T.A)("flex items-center gap-1.5 px-4 py-2 border-b-2 transition-colors whitespace-nowrap text-sm",e===a.id?"border-venezia-600 text-venezia-600 dark:text-venezia-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200")},r.createElement(l,{className:"w-3.5 h-3.5"}),r.createElement("span",null,a.label),void 0!==a.count&&r.createElement(k.A,{size:"xs",variant:"default"},a.count))})))),r.createElement("div",{className:"p-3 border-b dark:border-gray-700"},r.createElement("div",{className:"flex flex-col sm:flex-row gap-2"},r.createElement("div",{className:"flex-1"},r.createElement(f.A,{type:"text",placeholder:"Buscar por cliente, teléfono o dirección...",value:a,onChange:e=>w(e.target.value),icon:x.A})),"routes"!==e&&r.createElement(r.Fragment,null,r.createElement(N.A,{value:A,onChange:e=>_(e.target.value),options:[{value:"all",label:"Todos los estados"},{value:"pending",label:"Pendiente"},{value:"assigned",label:"Asignado"},{value:"in_transit",label:"En Tránsito"},{value:"delivered",label:"Entregado"},{value:"failed",label:"Fallido"}],icon:p.A,className:"w-full sm:w-40"}),r.createElement(N.A,{value:C,onChange:e=>z(e.target.value),options:[{value:"all",label:"Todos los repartidores"},...de.map((e=>({value:e.id.toString(),label:e.name})))],icon:b.A,className:"w-full sm:w-40"}),r.createElement(N.A,{value:S,onChange:e=>j(e.target.value),options:[{value:"today",label:"Hoy"},{value:"tomorrow",label:"Mañana"},{value:"week",label:"Esta semana"},{value:"all",label:"Todas"}],icon:s.A,className:"w-full sm:w-32"})))),r.createElement("div",{className:"p-4"},r.createElement(M.A,{loading:me,error:ee,empty:0===ge.length&&!me,onRetry:te,emptyText:"No se encontraron entregas",emptyIcon:n.A}),!me&&!ee&&r.createElement(r.Fragment,null,("all"===e||"today"===e)&&r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-3"},ge.map((e=>r.createElement($,{key:e.id,delivery:e,onEdit:e=>{U(e),R(!0)},onDelete:pe,onStatusChange:xe,onViewDetails:Ee,onViewRoute:be})))),"routes"===e&&r.createElement("div",{className:"space-y-6"},Object.entries(ue).map((([e,t])=>{if("unassigned"===e)return null;const a=de.find((t=>t.id===parseInt(e)));return a?r.createElement("div",{key:e,className:"border dark:border-gray-700 rounded-lg p-4"},r.createElement("div",{className:"flex items-center justify-between mb-4"},r.createElement("div",{className:"flex items-center gap-3"},r.createElement("div",{className:"w-10 h-10 bg-venezia-100 dark:bg-venezia-900/20 rounded-full flex items-center justify-center"},r.createElement(b.A,{className:"w-5 h-5 text-venezia-600 dark:text-venezia-400"})),r.createElement("div",null,r.createElement("h3",{className:"font-medium text-gray-900 dark:text-white"},a.name),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},t.length," entregas • ",a.vehicle))),r.createElement(h.A,{onClick:()=>{J(a),q(!0)},variant:"outline",size:"sm",icon:i.A},"Ver Ruta")),r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},t.slice(0,3).map((e=>r.createElement("div",{key:e.id,className:"text-sm bg-gray-50 dark:bg-gray-700/50 rounded p-3"},r.createElement("p",{className:"font-medium text-gray-900 dark:text-white"},e.customer_name),r.createElement("p",{className:"text-gray-600 dark:text-gray-400"},e.address?.street," ",e.address?.number)))),t.length>3&&r.createElement("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center"},"+",t.length-3," más..."))):null})),ue.unassigned&&ue.unassigned.length>0&&r.createElement("div",{className:"border dark:border-gray-700 rounded-lg p-4 border-dashed"},r.createElement("h3",{className:"font-medium text-gray-900 dark:text-white mb-4"},"Sin Asignar (",ue.unassigned.length,")"),r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},ue.unassigned.map((e=>r.createElement("div",{key:e.id,className:"text-sm bg-gray-50 dark:bg-gray-700/50 rounded p-3"},r.createElement("p",{className:"font-medium text-gray-900 dark:text-white"},e.customer_name),r.createElement("p",{className:"text-gray-600 dark:text-gray-400"},e.address?.street," ",e.address?.number),r.createElement(h.A,{onClick:()=>{U(e),R(!0)},variant:"ghost",size:"xs",className:"mt-2"},"Asignar")))))))))),r.createElement(F,{isOpen:O,onClose:()=>{R(!1),U(null)},onSave:async e=>{try{const t=W?`/api/deliveries/${W.id}`:"/api/deliveries";console.log("🚚 Guardando entrega:",{url:t,method:W?"PUT":"POST",data:e});const a=await(0,l.A)({method:W?"PUT":"POST",url:t,data:e,headers:{"Content-Type":"application/json"}});if(console.log("✅ Respuesta del servidor:",a.data),!(a.status>=200&&a.status<300))throw new Error(`HTTP ${a.status}: ${a.statusText}`);X(W?"Entrega actualizada":"Entrega creada",`La entrega se ${W?"actualizó":"creó"} correctamente`),setTimeout((()=>{te()}),100),R(!1),U(null)}catch(t){if(console.error("Error saving delivery:",t),t.message.includes("504")||t.message.includes("Failed to fetch")||t.message.includes("NetworkError")){console.log("🚛 Modo offline: Guardando en almacenamiento local");try{let t;W?(t=E.A.update(W.id,e),X("Entrega actualizada","Los cambios se guardaron correctamente (modo offline)")):(t=E.A.create(e),X("Entrega creada",`Entrega #${t.id} creada correctamente (modo offline)`)),E.A.syncWithApiCache(),te(),R(!1),U(null)}catch(e){console.error("Error en modo mock:",e),Y("Error al guardar","No se pudo guardar la entrega localmente")}}else Y("Error al guardar entrega","Por favor, intente nuevamente")}},delivery:W,drivers:de,orders:oe.filter((e=>!e.delivery_id))}),r.createElement(I,{isOpen:L,onClose:()=>{q(!1),J(null)},deliveries:G&&ue[G.id]||[],driver:G}),r.createElement(H,{isOpen:B,onClose:()=>{V(!1),U(null)},delivery:W}))}}}]);