"use strict";(self.webpackChunkvenezia_frontend=self.webpackChunkvenezia_frontend||[]).push([[3428],{718:function(e,t,a){var n=a(96540);t.A=()=>{const e=(0,n.useRef)({navigationStart:0,domContentLoaded:0,loadComplete:0,firstContentfulPaint:0,largestContentfulPaint:0,routeChanges:[],componentMounts:[],apiCalls:[]}),t=(0,n.useCallback)((()=>{if("PerformanceObserver"in window)try{new PerformanceObserver((t=>{const a=t.getEntries();for(const t of a)"first-contentful-paint"===t.name&&(e.current.firstContentfulPaint=t.startTime,console.log(`🎨 FCP: ${Math.round(t.startTime)}ms`))})).observe({entryTypes:["paint"]}),new PerformanceObserver((t=>{const a=t.getEntries(),n=a[a.length-1];n&&(e.current.largestContentfulPaint=n.startTime,console.log(`🖼️ LCP: ${Math.round(n.startTime)}ms`))})).observe({entryTypes:["largest-contentful-paint"]});let t=0;new PerformanceObserver((e=>{for(const a of e.getEntries())a.hadRecentInput||(t+=a.value);console.log(`📐 CLS: ${t.toFixed(4)}`)})).observe({entryTypes:["layout-shift"]});const a=new PerformanceObserver((e=>{for(const t of e.getEntries()){const e=t.processingStart-t.startTime;console.log(`⚡ Input Delay: ${Math.round(e)}ms`)}}));PerformanceObserver.supportedEntryTypes.includes("first-input")&&a.observe({entryTypes:["first-input"]})}catch(e){console.warn("Performance monitoring not fully supported:",e)}}),[]),a=(0,n.useCallback)(((t,a=performance.now())=>{const n=performance.now()-a;return e.current.routeChanges.push({route:t,duration:n,timestamp:Date.now()}),console.log(`🚀 Route "${t}" loaded in ${Math.round(n)}ms`),n>1e3&&console.warn(`⚠️ Slow route loading: ${t} took ${Math.round(n)}ms`),n}),[]),o=(0,n.useCallback)(((t,a=performance.now())=>{const n=performance.now()-a;return e.current.componentMounts.push({component:t,duration:n,timestamp:Date.now()}),console.log(`🔧 Component "${t}" mounted in ${Math.round(n)}ms`),n}),[]),r=(0,n.useCallback)(((t,a,n,o=!0)=>{const r=n-a;e.current.apiCalls.push({endpoint:t,duration:r,success:o,timestamp:Date.now()});const s=o?"✅":"❌";return console.log(`${s} API "${t}" took ${Math.round(r)}ms`),r>3e3&&console.warn(`⚠️ Slow API call: ${t} took ${Math.round(r)}ms`),r}),[]),s=(0,n.useCallback)(((e,t="prefetch")=>{if(!e)return;const a=document.createElement("link");a.rel=t,a.href=e,"preload"===t&&(a.as="script"),document.head.appendChild(a),console.log(`🔗 ${t}: ${e}`)}),[]),c=(0,n.useCallback)(((e=.1)=>"IntersectionObserver"in window?new IntersectionObserver((e=>{e.forEach((e=>{if(e.isIntersecting){const t=e.target;if(t.dataset.src&&(t.src=t.dataset.src,t.removeAttribute("data-src")),t.dataset.component){const e=new CustomEvent("lazyLoad",{detail:{component:t.dataset.component}});t.dispatchEvent(e)}}}))}),{threshold:e}):null),[]),i=(0,n.useCallback)((()=>{if("memory"in performance){const e=performance.memory,t=Math.round(e.usedJSHeapSize/1048576),a=Math.round(e.totalJSHeapSize/1048576),n=Math.round(e.jsHeapSizeLimit/1048576);return console.log(`🧠 Memory: ${t}MB used, ${a}MB total, ${n}MB limit`),t/n>.8&&console.warn(`⚠️ High memory usage: ${t}MB (${Math.round(t/n*100)}%)`),{used:t,total:a,limit:n}}return null}),[]),l=(0,n.useCallback)((()=>{if("getEntriesByType"in performance){const e=performance.getEntriesByType("resource");let t=0;const a={};return e.forEach((e=>{if(e.name.includes(".js")||e.name.includes(".css")){const n=e.transferSize||e.encodedBodySize||0;t+=n;const o=e.name.split("/").pop();a[o]=Math.round(n/1024)}})),console.log("📦 Bundle Analysis:",a),console.log(`📊 Total bundle size: ${Math.round(t/1024)}KB`),{bundles:a,totalSize:Math.round(t/1024)}}return null}),[]),u=(0,n.useCallback)((()=>{const t={timestamp:(new Date).toISOString(),metrics:{...e.current},memory:i(),bundles:l(),userAgent:navigator.userAgent,connection:navigator.connection?{effectiveType:navigator.connection.effectiveType,downlink:navigator.connection.downlink,rtt:navigator.connection.rtt}:null};return console.log("📈 Performance Report:",t),t}),[i,l]),d=(0,n.useCallback)((e=>{"undefined"!=typeof window&&window.gtag&&window.gtag("event","performance_metric",{custom_map:{metric_1:"fcp",metric_2:"lcp"},fcp:e.firstContentfulPaint,lcp:e.largestContentfulPaint}),console.log("📊 Metrics sent to analytics:",e)}),[]);return(0,n.useEffect)((()=>{const a=performance.getEntriesByType("navigation")[0];a&&(e.current.navigationStart=a.fetchStart,e.current.domContentLoaded=a.domContentLoadedEventEnd-a.fetchStart,e.current.loadComplete=a.loadEventEnd-a.fetchStart),t();const n=setInterval(i,3e4);return()=>{clearInterval(n)}}),[t,i]),{measureRouteChange:a,measureComponentMount:o,measureApiCall:r,optimizeResource:s,createLazyLoader:c,measureMemoryUsage:i,analyzeBundleSize:l,generateReport:u,sendMetrics:d,getMetrics:()=>e.current}}},4952:function(e,t,a){var n=a(96540);t.A=()=>{const[e,t]=(0,n.useState)(!1),[a,o]=(0,n.useState)(!1),[r,s]=(0,n.useState)(""),[c,i]=(0,n.useState)(0),l=(0,n.useRef)(null),u=(0,n.useRef)(null),d={"abrir dashboard":()=>({type:"navigate",target:"/dashboard"}),"ir a ventas":()=>({type:"navigate",target:"/sales"}),"mostrar inventario":()=>({type:"navigate",target:"/inventory"}),"ver productos":()=>({type:"navigate",target:"/products"}),"ir a reportes":()=>({type:"navigate",target:"/reports"}),"abrir chat":()=>({type:"chat",action:"open"}),"cerrar chat":()=>({type:"chat",action:"close"}),"expandir chat":()=>({type:"chat",action:"expand"}),"minimizar chat":()=>({type:"chat",action:"minimize"}),"stock de vainilla":()=>({type:"query",text:"Stock de vainilla"}),"ventas de hoy":()=>({type:"query",text:"Ventas de hoy"}),"productos con stock bajo":()=>({type:"query",text:"Productos con stock bajo"}),"reporte semanal":()=>({type:"query",text:"Reporte semanal"}),"modo oscuro":()=>({type:"theme",action:"dark"}),"modo claro":()=>({type:"theme",action:"light"}),"tema automático":()=>({type:"action",action:"toggle_auto_theme"}),"activar tema automático":()=>({type:"action",action:"toggle_auto_theme"}),"silenciar notificaciones":()=>({type:"notifications",action:"mute"}),"activar notificaciones":()=>({type:"notifications",action:"unmute"})};(0,n.useEffect)((()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){o(!0);const e=new(window.SpeechRecognition||window.webkitSpeechRecognition);e.continuous=!1,e.interimResults=!1,e.lang="es-ES",e.maxAlternatives=3,e.onstart=()=>{t(!0),console.log("🎤 Escuchando comando de voz...");const e=new CustomEvent("voiceStart");window.dispatchEvent(e)},e.onresult=e=>{const t=e.results[0],a=t[0].transcript.toLowerCase().trim(),n=t[0].confidence;s(a),i(n),console.log(`🎯 Comando reconocido: "${a}" (${Math.round(100*n)}%)`);const o=p(a);g(o||{type:"query",text:a},a)},e.onerror=e=>{console.error("❌ Error en reconocimiento de voz:",e.error),t(!1),"not-allowed"===e.error&&alert("🎤 Permisos de micrófono denegados. Habilita el micrófono para usar comandos de voz.")},e.onend=()=>{t(!1);const e=new CustomEvent("voiceEnd");window.dispatchEvent(e)},l.current=e}}),[]);const p=(0,n.useCallback)((e=>{const t=Object.keys(d);if(d[e])return d[e]();for(const a of t)if(e.includes(a)||a.includes(e))return d[a]();return e.includes("stock")||e.includes("inventario")?e.includes("vainilla")?d["stock de vainilla"]():e.includes("bajo")?d["productos con stock bajo"]():{type:"navigate",target:"/inventory"}:e.includes("ventas")||e.includes("vender")?e.includes("hoy")?d["ventas de hoy"]():{type:"navigate",target:"/sales"}:e.includes("producto")||e.includes("helado")?{type:"navigate",target:"/products"}:e.includes("reporte")||e.includes("análisis")?{type:"navigate",target:"/reports"}:null}),[]),g=(0,n.useCallback)(((e,t)=>{const a=new CustomEvent("voiceCommand",{detail:{...e,originalText:t,confidence:c}});window.dispatchEvent(a)}),[c]),m=(0,n.useCallback)((()=>{if(l.current&&!e)try{l.current.start(),u.current=setTimeout((()=>{e&&f()}),1e4)}catch(e){console.error("Error al iniciar reconocimiento:",e)}}),[e]),f=(0,n.useCallback)((()=>{l.current&&e&&(l.current.stop(),t(!1)),u.current&&clearTimeout(u.current)}),[e]);return(0,n.useEffect)((()=>()=>{u.current&&clearTimeout(u.current)}),[]),{isSupported:a,isListening:e,transcript:r,confidence:c,startListening:m,stopListening:f,voiceCommands:Object.keys(d)}}},27272:function(e,t,a){var n=a(96540);t.A=(e,t)=>{const[a,o]=(0,n.useState)((()=>"true"===localStorage.getItem("venezia-auto-theme"))),r=()=>{const e=(new Date).getHours();return e>=19||e<7},s=()=>{if(!a)return;const n=r();if(n!==e){t(n);const e=new CustomEvent("themeAutoChange",{detail:{newTheme:n?"dark":"light",time:(new Date).toLocaleTimeString(),reason:"automatic"}});window.dispatchEvent(e)}};(0,n.useEffect)((()=>{if(!a)return;s();const e=setInterval(s,6e4);return()=>clearInterval(e)}),[a,e,t]),(0,n.useEffect)((()=>{localStorage.setItem("venezia-auto-theme",a.toString())}),[a]),(0,n.useEffect)((()=>{if(!a)return;const e=()=>{setTimeout(s,1e3)};return window.addEventListener("focus",e),window.addEventListener("visibilitychange",e),()=>{window.removeEventListener("focus",e),window.removeEventListener("visibilitychange",e)}}),[a]);const c=()=>{const e=(new Date).getHours();return e>=6&&e<12?"morning":e>=12&&e<18?"afternoon":e>=18&&e<22?"evening":"night"};return{autoMode:a,toggleAutoMode:()=>{const e=!a;return o(e),e&&s(),e},getShouldBeDark:r,getNextThemeChange:()=>{if(!a)return null;const e=new Date,t=e.getHours();let n,o;t>=7&&t<19?(n=19,o="dark"):(n=7,o="light");const r=new Date(e);return r.setHours(n,0,0,0),r<=e&&r.setDate(r.getDate()+1),{time:r,type:o,timeString:r.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})}},getCurrentPeriod:c,getPeriodIcon:()=>{switch(c()){case"morning":return"🌅";case"afternoon":return"☀️";case"evening":return"🌆";case"night":return"🌙";default:return"🕐"}},checkAndUpdateTheme:s}}},31960:function(e,t,a){var n=a(96540);t.A=()=>{const e={"ctrl+1":()=>({type:"navigate",target:"/",label:"Dashboard"}),"ctrl+2":()=>({type:"navigate",target:"/pos",label:"Punto de Venta"}),"ctrl+3":()=>({type:"navigate",target:"/sales",label:"Ventas"}),"ctrl+4":()=>({type:"navigate",target:"/inventory",label:"Inventario"}),"ctrl+5":()=>({type:"navigate",target:"/production",label:"Producción"}),"ctrl+6":()=>({type:"navigate",target:"/analytics",label:"Analíticas"}),"ctrl+7":()=>({type:"navigate",target:"/ai-assistant",label:"Asistente AI"}),"ctrl+shift+1":()=>({type:"navigate",target:"/ingredients",label:"Ingredientes"}),"ctrl+shift+2":()=>({type:"navigate",target:"/recipes",label:"Recetas"}),"ctrl+shift+3":()=>({type:"navigate",target:"/production-orders",label:"Órdenes de Producción"}),"ctrl+shift+4":()=>({type:"navigate",target:"/batch-assignment",label:"Asignar Lotes"}),"ctrl+shift+5":()=>({type:"navigate",target:"/transactions",label:"Transacciones"}),"ctrl+shift+6":()=>({type:"navigate",target:"/stores",label:"Tiendas"}),"ctrl+shift+7":()=>({type:"navigate",target:"/deliveries",label:"Entregas"}),"ctrl+shift+8":()=>({type:"navigate",target:"/providers",label:"Proveedores"}),"ctrl+shift+9":()=>({type:"navigate",target:"/web-users",label:"Usuarios Web"}),"ctrl+shift+0":()=>({type:"navigate",target:"/settings",label:"Configuración"}),"ctrl+space":()=>({type:"chat",action:"toggle",label:"Toggle Chat AI"}),"ctrl+shift+c":()=>({type:"chat",action:"open",label:"Abrir Chat"}),escape:()=>({type:"chat",action:"close",label:"Cerrar Chat"}),"ctrl+shift+x":()=>({type:"chat",action:"expand",label:"Expandir Chat"}),"ctrl+k":()=>({type:"search",action:"open",label:"Búsqueda rápida"}),"ctrl+slash":()=>({type:"help",action:"shortcuts",label:"Ver shortcuts"}),"ctrl+shift+v":()=>({type:"voice",action:"toggle",label:"Comando de voz"}),"ctrl+shift+d":()=>({type:"theme",action:"toggle",label:"Toggle tema"}),"ctrl+shift+a":()=>({type:"action",action:"toggle_auto_theme",label:"Toggle tema automático"}),"ctrl+n":()=>({type:"action",action:"new_sale",target:"/pos",label:"Nueva venta"}),"ctrl+shift+n":()=>({type:"action",action:"new_product",target:"/products",label:"Nuevo producto"}),"ctrl+alt+n":()=>({type:"action",action:"new_order",target:"/production-orders",label:"Nueva orden de producción"}),"ctrl+alt+i":()=>({type:"action",action:"new_ingredient",target:"/ingredients",label:"Nuevo ingrediente"}),"ctrl+alt+r":()=>({type:"action",action:"new_recipe",target:"/recipes",label:"Nueva receta"}),"ctrl+alt+t":()=>({type:"action",action:"new_transaction",target:"/transactions",label:"Nueva transacción"}),"ctrl+r":()=>({type:"action",action:"refresh_data",label:"Actualizar datos"}),"alt+r":()=>({type:"action",action:"refresh_data",label:"Actualizar datos"}),"ctrl+e":()=>({type:"action",action:"export_data",label:"Exportar datos"}),"ctrl+i":()=>({type:"action",action:"import_data",label:"Importar datos"}),"ctrl+f":()=>({type:"filter",action:"toggle_filters",label:"Toggle filtros"}),"ctrl+shift+f":()=>({type:"filter",action:"clear_filters",label:"Limpiar filtros"}),"ctrl+l":()=>({type:"filter",action:"low_stock",target:"/inventory?filter=low_stock",label:"Stock bajo"}),"ctrl+p":()=>({type:"filter",action:"pending_orders",target:"/production-orders?status=pending",label:"Órdenes pendientes"}),"ctrl+b":()=>({type:"ui",action:"toggle_sidebar",label:"Toggle sidebar"}),f11:()=>({type:"ui",action:"toggle_focus",label:"Modo focus"}),"ctrl+m":()=>({type:"ui",action:"toggle_mobile_view",label:"Vista móvil"}),"ctrl+g":()=>({type:"ui",action:"toggle_grid_view",label:"Vista grilla"}),"ctrl+t":()=>({type:"ui",action:"toggle_table_view",label:"Vista tabla"}),"ctrl+?":()=>({type:"help",action:"shortcuts",label:"Ver atajos de teclado"}),"ctrl+h":()=>({type:"help",action:"help",label:"Ayuda"}),"ctrl+shift+h":()=>({type:"help",action:"tutorial",label:"Tutorial"})},t=(0,n.useCallback)((e=>{const t=[];if((e.ctrlKey||e.metaKey)&&t.push("ctrl"),e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),!e.key)return null;const a={" ":"space",Escape:"escape","/":"slash",F11:"f11"}[e.key]||e.key.toLowerCase();return t.push(a),t.join("+")}),[]),a=(0,n.useCallback)((a=>{const n=document.activeElement,r=n&&("INPUT"===n.tagName||"TEXTAREA"===n.tagName||"true"===n.contentEditable),s=t(a);if(!s)return;const c=e[s];if(c){if(r&&!["escape","f11"].includes(s))return;a.preventDefault(),a.stopPropagation();const e=c();o(e.label);const t=new CustomEvent("keyboardShortcut",{detail:e});window.dispatchEvent(t),"undefined"!=typeof window&&window.gtag&&window.gtag("event","keyboard_shortcut_used",{shortcut:s,label:e.label,category:e.type})}}),[t]),o=(0,n.useCallback)((e=>{const t=document.createElement("div");if(t.textContent=`⌨️ ${e}`,t.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: rgba(0, 0, 0, 0.8);\n      color: white;\n      padding: 8px 16px;\n      border-radius: 8px;\n      font-size: 14px;\n      font-weight: 500;\n      z-index: 10000;\n      pointer-events: none;\n      animation: shortcutFadeIn 0.2s ease-out;\n    ",!document.getElementById("shortcut-styles")){const e=document.createElement("style");e.id="shortcut-styles",e.textContent="\n        @keyframes shortcutFadeIn {\n          from { opacity: 0; transform: translateY(-10px); }\n          to { opacity: 1; transform: translateY(0); }\n        }\n        @keyframes shortcutFadeOut {\n          from { opacity: 1; transform: translateY(0); }\n          to { opacity: 0; transform: translateY(-10px); }\n        }\n      ",document.head.appendChild(e)}document.body.appendChild(t),setTimeout((()=>{t.parentNode&&(t.style.animation="shortcutFadeOut 0.2s ease-in forwards",setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),200))}),2e3)}),[]),r=(0,n.useCallback)((()=>Object.entries(e).map((([e,t])=>{const a=t();return{combo:e.replace("ctrl","⌘").replace("shift","⇧").replace("alt","⌥"),label:a.label,category:a.type,target:a.target}})).reduce(((e,t)=>{const a=t.category;return e[a]||(e[a]=[]),e[a].push(t),e}),{})),[]);return(0,n.useEffect)((()=>(document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)})),[a]),{shortcuts:r(),showShortcutFeedback:o}}},34224:function(e,t,a){a.d(t,{ux:function(){return r}});var n=a(96540);const o=new class{constructor(){this.listeners=new Set,this.errorQueue=[],this.setupGlobalListeners()}setupGlobalListeners(){window.addEventListener("unhandledrejection",(e=>{console.error("Unhandled promise rejection:",e.reason),this.handleError({type:"unhandledrejection",error:e.reason,timestamp:Date.now()})})),window.addEventListener("error",(e=>{console.error("Global error:",e.error),this.handleError({type:"javascript",error:e.error,filename:e.filename,lineno:e.lineno,colno:e.colno,timestamp:Date.now()})}))}handleError(e){this.errorQueue.push(e),this.notifyListeners(e)}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notifyListeners(e){this.listeners.forEach((t=>{try{t(e)}catch(e){console.error("Error in error listener:",e)}}))}getErrorQueue(){return[...this.errorQueue]}clearErrorQueue(){this.errorQueue=[]}},r=()=>{const[e,t]=(0,n.useState)([]),[a,r]=(0,n.useState)(navigator.onLine);(0,n.useEffect)((()=>{const e=()=>r(!0),t=()=>r(!1);return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}}),[]),(0,n.useEffect)((()=>o.subscribe((e=>{const a={...e,id:e.id||`error-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};t((e=>[...e,a].slice(-10)))}))),[]);const c=(0,n.useCallback)(((e,n={})=>{const o={id:`error-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,error:e,context:n,timestamp:Date.now(),url:window.location.href,userAgent:navigator.userAgent,isOnline:a};return console.error("Error handled:",o),t((e=>[...e,o].slice(-10))),s(o),o.id}),[a]),i=(0,n.useCallback)((async(e,t={})=>{const{retries:a=3,delay:n=1e3,onRetry:o,onError:r}=t;for(let t=1;t<=a;t++)try{return await e()}catch(e){if(t===a){const n=c(e,{type:"async",attempts:t,maxRetries:a});throw r&&r(e,n),e}n&&t<a&&await new Promise((e=>setTimeout(e,n*t))),o&&o(t,e)}}),[c]),l=(0,n.useCallback)((e=>{t((t=>t.filter((t=>t.id!==e))))}),[]),u=(0,n.useCallback)((()=>{t([]),o.clearErrorQueue()}),[]),d=(0,n.useCallback)((()=>{const t=Date.now(),a=e.filter((e=>t-e.timestamp<36e5)),n=e.filter((e=>t-e.timestamp<864e5));return{total:e.length,recent:a.length,daily:n.length,types:e.reduce(((e,t)=>{const a=t.context?.type||"unknown";return e[a]=(e[a]||0)+1,e}),{})}}),[e]);return{errors:e,handleError:c,handleAsyncError:i,clearError:l,clearAllErrors:u,getErrorStats:d,isOnline:a,hasErrors:e.length>0}},s=async e=>{try{await fetch("/api/errors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(e){console.error("Failed to send error to monitoring service:",e)}}},36954:function(e,t,a){var n=a(96540),o=a(5338),r=a(84976),s=a(60799),c=a(72107),i=a(82932),l=a(30622),u=a(6986);(0,l.vY)(),(0,u.yr)();const d=document.getElementById("root");(0,o.H)(d).render(n.createElement(n.StrictMode,null,n.createElement(r.Kd,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0}},n.createElement(i.F,null,n.createElement(c.A,null),n.createElement(s.l$,{toastOptions:{duration:4e3,position:"top-right",style:{background:"#ffffff",color:"#1a1a1a",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.08)",borderRadius:"12px",border:"1px solid #e5e5e5",fontSize:"14px",fontWeight:"500"},success:{iconTheme:{primary:"#22c55e",secondary:"#ffffff"}},error:{iconTheme:{primary:"#ef4444",secondary:"#ffffff"}}},containerStyle:{top:20,right:20}})))))},42203:function(e,t,a){a.d(t,{d:function(){return r}});var n=a(96540);let o=0;const r=()=>{const[e,t]=(0,n.useState)([]),a=(0,n.useCallback)((e=>{const a=o++,n={id:a,...e,createdAt:Date.now()};return t((e=>[...e,n])),a}),[]),r=(0,n.useCallback)((e=>{t((t=>t.filter((t=>t.id!==e))))}),[]),s=(0,n.useCallback)((()=>{t([])}),[]),c=(0,n.useCallback)(((e,t,n={})=>a({type:"success",title:e,message:t,...n})),[a]),i=(0,n.useCallback)(((e,t,n={})=>a({type:"error",title:e,message:t,persistent:!0,...n})),[a]),l=(0,n.useCallback)(((e,t,n={})=>a({type:"warning",title:e,message:t,duration:7e3,...n})),[a]),u=(0,n.useCallback)(((e,t,n={})=>a({type:"info",title:e,message:t,...n})),[a]),d=(0,n.useCallback)(((e,t="Procesando...")=>a({type:"info",title:e,message:t,persistent:!0,duration:0})),[a]),p=(0,n.useCallback)(((e,t,n,o)=>a({type:"success",title:e,message:t,action:{label:n,onClick:o}})),[a]);return{toasts:e,addToast:a,removeToast:r,clearAllToasts:s,success:c,error:i,warning:l,info:u,loading:d,successWithAction:p}}},70700:function(e,t,a){a.d(t,{Wl:function(){return p}});var n=a(96540),o=a(71083),r=a(41896),s=a(80082),c=a(30862),i=a(45856);const l=new Map,u=new Map,d={"/api/products":{ttl:3e4},"/api/product_categories":{ttl:6e5},"/api/stores":{ttl:6e5},"/api/providers":{ttl:3e4},"/api/dashboard/overview":{ttl:3e4},"/api/stock_data":{ttl:3e4},"/api/web_users":{ttl:12e4},"/api/flavors":{ttl:3e5},"/api/deliveries":{ttl:3e4},"/api/drivers":{ttl:12e4},"/api/sales":{ttl:3e4}},p=(e,t=null,a={})=>{const[p,g]=(0,n.useState)(null),[m,f]=(0,n.useState)(!0),[h,y]=(0,n.useState)(null),v=(0,n.useRef)(null),{enabled:b=!0,refetchOnMount:w=!1,staleTime:k=0,onSuccess:S,onError:C}=a,E=((e,t)=>{const a=t?Object.keys(t).sort().reduce(((e,a)=>(e[a]=t[a],e)),{}):{};return`${e}?${new URLSearchParams(a).toString()}`})(e,t),_=d[e]||{ttl:6e4},A=(0,n.useCallback)((async(a=!1)=>{if(!b)return;if(v.current&&v.current.abort(),!a){const e=l.get(E);if(n=e,i=_.ttl,n&&Date.now()-n.timestamp<i)return g(e.data),f(!1),y(null),S?.(e.data),e.data}var n,i;if(u.has(E))try{const e=await u.get(E);return g(e),f(!1),y(null),S?.(e),e}catch(e){throw y(e),f(!1),C?.(e),e}v.current=new AbortController,f(!0),y(null);const d=o.A.get(e,{params:t,signal:v.current.signal}).then((e=>{const t=e.data;return l.set(E,{data:t,timestamp:Date.now()}),g(t),f(!1),S?.(t),t})).catch((async a=>{if(o.A.isCancel(a)||"CanceledError"===a.name||"ERR_CANCELED"===a.code)return null;try{const a=await(async(e,t)=>{switch(e){case"/api/dashboard/overview":return s.A.getDashboardOverview();case"/api/deliveries":return c.A.getAll();case"/api/sales":return s.A.getSales(t);case"/api/production_orders":return s.A.getProductionOrders();case"/api/production_batches":return s.A.getProductionBatches();case"/api/stock_data":case"/api/inventory":return s.A.getInventory();case"/api/analytics/sales":return s.A.getAnalytics("sales",t);case"/api/analytics/products":return s.A.getAnalytics("products",t);case"/api/analytics/customers":return s.A.getAnalytics("customers",t);case"/api/analytics/export":return s.A.getAnalyticsExport(t);case"/api/reports/sales":return s.A.getReports("sales",t);case"/api/reports/inventory":return s.A.getReports("inventory",t);default:return s.A.getMockData(e)}})(e,t);if(null!==a)return l.set(E,{data:a,timestamp:Date.now()}),g(a),f(!1),S?.(a),a}catch(e){console.warn("Mock data also failed:",e)}(0,r.vV)(a,{url:e,params:t,context:"useApiCache"});const n={message:"ECONNREFUSED"===a.code?"No se pudo conectar con el servidor. Usando datos de demostración.":a.response?.data?.error||a.message||"Error al cargar datos",originalError:a,code:a.code,status:a.response?.status};throw y(n),f(!1),C?.(n),n})).finally((()=>{u.delete(E)}));return u.set(E,d),d}),[e,t,b,E,_.ttl,S,C]),x=(0,n.useCallback)((e=>{if(e)for(const t of l.keys())t.includes(e)&&l.delete(t);else l.delete(E)}),[E]),T=(0,n.useCallback)((()=>A(!0)),[A]),M=(0,n.useCallback)((e=>{g(e),l.set(E,{data:e,timestamp:Date.now()})}),[E]);return(0,n.useEffect)((()=>{let e=!0;return b&&A(w).catch((t=>{e&&!o.A.isCancel(t)&&"CanceledError"!==t.name&&console.error("Error fetching data:",t)})),()=>{e=!1,v.current&&v.current.abort()}}),[A,b,w]),(0,n.useEffect)((()=>{const t=i.A.on(i.q.CACHE_INVALIDATE,(t=>{t&&t.endpoints?t.endpoints.forEach((t=>{e.includes(t)&&(x(),b&&A(!0))})):t&&t.pattern&&e.includes(t.pattern)&&(x(),b&&A(!0))})),a=i.A.on(i.q.AI_ACTION_COMPLETED,(t=>{const a={provider_created:"/api/providers",product_created:"/api/products",stock_updated:"/api/stock_data"}[t?.action];a&&e.includes(a)&&(x(),b&&A(!0))}));return()=>{t(),a()}}),[e,b,A,x]),{data:p,loading:m,error:h,refetch:T,mutate:M,invalidateCache:x}};setInterval((()=>{const e=Date.now();for(const[t,a]of l.entries()){const n=t.split("?")[0],o=d[n]||{ttl:6e4};e-a.timestamp>o.ttl&&l.delete(t)}}),3e5)},77579:function(e,t,a){a.d(t,{SA:function(){return u},oP:function(){return d}});var n=a(96540);const o="venezia_ai_chat";var r=a(71083),s=a(53120),c=a(45856),i=a(50646);const l=(0,n.createContext)(null),u=({children:e})=>{const{messages:t,chatState:a,isLoading:u,setIsLoading:d,addMessage:p,clearHistory:g,updateChatState:m,getStats:f,saveAction:h}=(()=>{const[e,t]=(0,n.useState)([]),[a,r]=(0,n.useState)("closed"),[s,c]=(0,n.useState)(!1),i=(0,n.useRef)(e),l=(0,n.useRef)(a);(0,n.useEffect)((()=>{i.current=e}),[e]),(0,n.useEffect)((()=>{l.current=a}),[a]);const u={id:"welcome_"+Date.now(),type:"ai",content:'👋 ¡Hola! Soy **VenezIA**, tu asistente inteligente.\n\n**¿Cómo puedo ayudarte?**\n• 📊 Consultar ventas y reportes\n• 📦 Gestionar inventario y stock\n• 🍨 Crear productos y sabores\n• 👥 Administrar proveedores\n• 💰 Análisis financieros\n\n**Ejemplos rápidos:**\n`"Stock de vainilla"`\n`"Ventas de esta semana"`\n`"Crear helado chocolate $450"`',timestamp:new Date,persistent:!0};(0,n.useEffect)((()=>{try{const e=localStorage.getItem(o);if(e){const{messages:a,chatState:n}=JSON.parse(e),o=a.map((e=>({...e,timestamp:new Date(e.timestamp)})));o.some((e=>e.persistent))&&0!==o.length?t(o):t([u,...o]),r("closed")}else t([u])}catch(e){console.error("Error cargando chat desde localStorage:",e),t([u])}}),[]);const d=(0,n.useCallback)((()=>{const e=i.current,t=l.current;if(0!==e.length)try{const a={messages:e.slice(-50),chatState:t,lastUpdated:(new Date).toISOString()};localStorage.setItem(o,JSON.stringify(a))}catch(a){console.error("Error guardando chat en localStorage:",a);try{const a={messages:e.filter((e=>e.persistent)).slice(-5),chatState:t,lastUpdated:(new Date).toISOString()};localStorage.setItem(o,JSON.stringify(a))}catch(e){console.error("Error en cleanup de localStorage:",e)}}}),[]);(0,n.useEffect)((()=>{if(e.length>0){const e=setTimeout((()=>{d()}),2e3);return()=>clearTimeout(e)}}),[e.length,d]);const p=(0,n.useCallback)((e=>{const a={...e,id:e.id||Date.now()+Math.random(),timestamp:e.timestamp||new Date};return t((e=>[...e,a])),a}),[]),g=(0,n.useCallback)((()=>{e.length>1&&!window.confirm("¿Estás seguro de que quieres limpiar todo el historial del chat?")||(t([u]),localStorage.removeItem(o))}),[e.length]),m=(0,n.useCallback)((e=>{l.current!==e&&r(e)}),[]),f=(0,n.useCallback)((()=>{const t=e.filter((e=>"user"===e.type)).length,a=e.filter((e=>"ai"===e.type&&!e.persistent)).length,n=e.length;return{userMessages:t,aiMessages:a,totalMessages:n,hasHistory:n>1}}),[e]);return{messages:e,chatState:a,isLoading:s,setIsLoading:c,addMessage:p,clearHistory:g,updateChatState:m,getStats:f}})(),{inputMessage:y,setInputMessage:v,clearInput:b}=(()=>{const[e,t]=(0,n.useState)(""),a=(0,n.useCallback)((()=>{t("")}),[]);return{inputMessage:e,setInputMessage:(0,n.useCallback)((e=>{t(e)}),[]),clearInput:a}})(),{isListening:w,startVoiceCommand:k,voiceSupported:S}=(e=>{const[t,a]=(0,n.useState)(!1),[o,r]=(0,n.useState)(null),s="undefined"!=typeof window&&("webkitSpeechRecognition"in window||"SpeechRecognition"in window);(0,n.useEffect)((()=>{if(!s)return;const t=new(window.SpeechRecognition||window.webkitSpeechRecognition);return t.lang="es-AR",t.interimResults=!1,t.maxAlternatives=1,t.continuous=!1,t.onstart=()=>{a(!0)},t.onresult=t=>{const a=t.results[0][0].transcript,n=t.results[0][0].confidence;e&&e(a),window.dispatchEvent(new CustomEvent("voiceTranscript",{detail:{transcript:a,confidence:n}}))},t.onerror=e=>{console.error("Error en reconocimiento de voz:",e.error),a(!1),window.dispatchEvent(new CustomEvent("voiceError",{detail:{error:e.error}}))},t.onend=()=>{a(!1)},r(t),()=>{t&&t.abort()}}),[s,e]);const c=(0,n.useCallback)((()=>{if(s&&o)if(t)o.stop();else try{o.start()}catch(e){console.error("Error al iniciar reconocimiento:",e)}else console.warn("Reconocimiento de voz no soportado")}),[s,o,t]),i=(0,n.useCallback)((()=>{o&&t&&o.stop()}),[o,t]);return{isListening:t,startVoiceCommand:c,stopVoiceCommand:i,voiceSupported:s}})(v),{connectionStatus:C}=((e=3e4)=>{const[t,a]=(0,n.useState)("checking"),[o,s]=(0,n.useState)(null),[c,i]=(0,n.useState)(null);return(0,n.useEffect)((()=>{let t,n=!0;const o=async()=>{if(n)try{await r.A.get("/api/deliveries",{timeout:5e3,validateStatus:e=>e<500}),n&&(a("connected"),s(new Date),i(null))}catch(e){n&&(a("disconnected"),s(new Date),i(e.message))}};o(),e>0&&(t=setInterval(o,e));const c=()=>{n&&o()},l=()=>{n&&(a("disconnected"),i("Sin conexión a internet"))};return window.addEventListener("online",c),window.addEventListener("offline",l),()=>{n=!1,t&&clearInterval(t),window.removeEventListener("online",c),window.removeEventListener("offline",l)}}),[e]),{connectionStatus:t,lastChecked:o,error:c,isConnected:"connected"===t,isDisconnected:"disconnected"===t,isChecking:"checking"===t}})(),[E,_]=n.useState((()=>localStorage.getItem("ai_model")||"smart_fallback")),[A,x]=n.useState((()=>{const e=i.default.getServiceStatus();return{gemini:{quota_used:e.dailyRequests,quota_limit:e.remainingRequests+e.dailyRequests,available:e.geminiAvailable},mock_ai:{quota_used:0,quota_limit:null,available:!0},smart_fallback:{quota_used:0,quota_limit:null,available:!0}}})),[T,M]=n.useState(null),I=(0,n.useCallback)((async e=>{if(!e?.trim())return;const a=e.trim();p({type:"user",content:a}),b(),d(!0);try{const e=(0,s.Cb)(a,t);if(e)return p({type:"ai",content:e,fromCache:!0,source:"cache"}),void d(!1);const n=await(async()=>{try{console.log("🔄 Obteniendo datos reales del backend...");const e=await fetch("/api/superbot/business-context",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).catch((e=>({ok:!1,error:e})));if(e.ok){const t=await e.json();if(t.success)return console.log("✅ Contexto completo obtenido desde SuperBot:",t.data),t.data}const[t,a,n]=await Promise.all([fetch("/api/dashboard/overview").catch((e=>({ok:!1,error:e}))),fetch("/api/products").catch((e=>({ok:!1,error:e}))),fetch("/api/stock/low?threshold=10").catch((e=>({ok:!1,error:e})))]);let o=null,r=[],s=[];if(t.ok){const e=await t.json();o=e.success?e.data:null}if(a.ok){const e=await a.json();r=Array.isArray(e)?e:[]}if(n.ok){const e=await n.json();s=Array.isArray(e)?e:[]}const c={sales:{today:{total:o?.ventas_hoy||0,transactions:o?.ordenes_pendientes||0,monthlyRevenue:o?.ingresos_mes||0}},inventory:{products:r.map((e=>({id:e.id,name:e.name,stock:e.stock||0,price:e.price||0,category:e.category||"Helado",context:e.context||"general"}))),totalProducts:o?.total_products||r.length,totalStock:o?.total_stock||r.reduce(((e,t)=>e+(t.stock||0)),0)},analytics:{lowStockCount:o?.stock_bajo||s.length,lowStockProducts:s.map((e=>({id:e.id,name:e.name,stock:e.stock||0,minimum:e.minimum_stock||10,needed:Math.max(0,(e.minimum_stock||10)-(e.stock||0))})))},lastUpdated:(new Date).toISOString(),source:"real_backend"};return console.log("✅ Datos reales obtenidos:",c),c}catch(e){return console.error("❌ Error obteniendo datos reales:",e),{sales:{today:{total:0}},inventory:{products:[],totalProducts:0,totalStock:0},analytics:{lowStockCount:0,lowStockProducts:[]},error:"No se pudo conectar con el backend. Verifica que el servidor esté ejecutándose en puerto 5002.",source:"error",lastUpdated:(new Date).toISOString()}}})(),o={history:t.slice(-10).map((e=>({type:e.type,content:e.content}))),currentModel:E,userPreferences:{mode:localStorage.getItem("ai-default-mode")||"guided"},businessData:n,executeAction:async(e,t)=>{const a=await(async(e,t,a=null)=>{try{console.log("🚀 SuperBot ejecutando acción real:",e,t);const n=await fetch("/api/superbot/execute-action",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({action:e,params:t,messageId:a})});if(n.ok){const e=await n.json();return console.log("✅ Acción SuperBot completada:",e),e}return{success:!1,message:`❌ Error del servidor: ${(await n.json().catch((()=>({message:"Error desconocido"})))).message||"No se pudo completar la acción"}`}}catch(a){return console.error("❌ Error ejecutando acción SuperBot:",a),await(async(e,t)=>{try{switch(console.log("🔄 Usando fallback para acción:",e,t),e){case"add_stock":const a=await fetch("/api/executive/add-stock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:t.productId,quantity:t.quantity,unit:t.unit||"unidades"})});if(a.ok){const e=await a.json();return{success:!0,message:`✅ Stock actualizado: ${t.quantity} ${t.unit||"unidades"} agregadas`,data:e}}break;case"create_product":const n=await fetch("/api/executive/create-product",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.name,price:t.price,context:t.context||"general",category:t.category||"Helado",initial_stock:t.initialStock||0})});if(n.ok){const e=await n.json();return{success:!0,message:`✅ Producto creado: ${t.name} - $${t.price}`,data:e}}break;case"update_price":const o=await fetch("/api/executive/update-price",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:t.productId,new_price:t.newPrice})});if(o.ok){const e=await o.json();return{success:!0,message:`✅ Precio actualizado a $${t.newPrice}`,data:e}}break;default:return{success:!1,message:`❌ Acción no reconocida: ${e}`}}return{success:!1,message:`❌ Error ejecutando acción: ${e}`}}catch(e){return console.error("❌ Error en fallback:",e),{success:!1,message:`❌ Error de conexión: ${e.message}`}}})(e,t)}})(e,t);return h&&a.success&&await h({type:e,data:t,result:a.data,success:a.success}),a}},r=await i.default.processMessage(a,o);r.message&&(0,s.yv)(a,t,r.message),"gemini"===r.source&&x((e=>({...e,gemini:{...e.gemini,quota_used:e.gemini.quota_limit-(r.remainingRequests||0)}})));const l={provider_created:/✅.*(?:agregué|creé).*proveedor/i,product_created:/✅.*(?:agregué|creé).*producto/i,stock_updated:/✅.*(?:agregué|actualicé).*(?:stock|kg)/i};for(const[e,t]of Object.entries(l))if(t.test(r.message)){c.A.emit(c.q.AI_ACTION_COMPLETED,{action:e,response:r.message,canExecute:r.canExecuteActions});break}p({type:"ai",content:r.message,source:r.source,fallbackLevel:r.fallbackLevel,canExecuteActions:r.canExecuteActions,suggestions:r.suggestions}),M(r.source)}catch(e){console.error("Error al enviar mensaje:",e),p({type:"ai",content:"🤖 **Sistema en Modo Básico**\n\nHubo un problema técnico. Mientras tanto, usa el **Modo Guiado** (botón arriba) donde puedo ayudarte paso a paso.",source:"error",fallbackLevel:0}),M("fallback")}finally{d(!1)}}),[t,p,b,d,E]),L=(0,n.useMemo)((()=>[{id:"sales",icon:"📊",text:"📊 ¿Cómo van las ventas hoy?"},{id:"stock",icon:"📦",text:"📦 ¿Qué productos necesito reponer?"},{id:"flavors",icon:"🍦",text:"🍦 ¿Cuáles son mis sabores más vendidos?"},{id:"add_stock",icon:"➕",text:"➕ Agregar 10 kg de chocolate"},{id:"new_flavor",icon:"🆕",text:"🆕 Crear helado de pistacho $5000"},{id:"change_prices",icon:"💰",text:"💰 Cambiar precio del helado de vainilla $4800"},{id:"low_stock",icon:"⚠️",text:"⚠️ Productos con stock bajo"},{id:"register_sale",icon:"🛒",text:"🛒 Registrar venta de 3 helados de fresa"},{id:"production",icon:"🏭",text:"🏭 Hacer 20 helados de chocolate"},{id:"help",icon:"❓",text:"❓ ¿Qué comandos puedo usar?"}]),[]),P=(0,n.useCallback)((e=>{I(e.text)}),[I]),$=(0,n.useCallback)((()=>i.default.getServiceStatus()),[]),D=(0,n.useCallback)((e=>{const t=i.default.getServiceStatus();return"gemini"===e&&(!t.geminiAvailable||t.remainingRequests<=0)?(_("smart_fallback"),localStorage.setItem("ai_model","smart_fallback"),!1):(_(e),localStorage.setItem("ai_model",e),x({gemini:{quota_used:t.dailyRequests,quota_limit:t.remainingRequests+t.dailyRequests,available:t.geminiAvailable},mock_ai:{quota_used:0,quota_limit:null,available:!0},smart_fallback:{quota_used:0,quota_limit:null,available:!0}}),!0)}),[]),R=(0,n.useMemo)((()=>({messages:t,chatState:a,isLoading:u,inputMessage:y,isListening:w,connectionStatus:C,voiceSupported:S,selectedModel:E,modelStatus:A,currentAISource:T,sendMessage:I,setInputMessage:v,updateChatState:m,clearHistory:g,handleQuickAction:P,startVoiceCommand:k,changeModel:D,getServiceStatus:$,quickActions:L,getStats:f})),[t,a,u,y,w,C,S,E,A,T,I,v,m,g,P,k,D,$,L,f]);return n.createElement(l.Provider,{value:R},e)},d=()=>{const e=(0,n.useContext)(l);if(!e)throw new Error("useAIChat debe ser usado dentro de un AIChatProvider");return e}},83240:function(e,t,a){a.d(t,{A:function(){return o}});var n=a(55467);const o=()=>{const{user:e,isAuthenticated:t,isLoading:a,checkAuth:o,logout:r}=(0,n.n)();return{user:e,isAuthenticated:t,isLoading:a,checkAuth:o,logout:r}}}}]);