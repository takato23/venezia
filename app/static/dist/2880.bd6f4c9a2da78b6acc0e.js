"use strict";(self.webpackChunkvenezia_frontend=self.webpackChunkvenezia_frontend||[]).push([[2880],{2880:function(e,t,a){a.r(t);var r=a(96540),l=a(47767),s=a(17133),n=a(3160),c=a(93893),d=a(98188),m=a(32708),o=a(80964),i=a(27235),g=a(89667),u=a(44471),x=a(70700),p=a(42203),E=a(93823),y=a(72284),b=a(11562),h=a(71428),N=a(28219),v=a(67773),f=a(3802);const k=({batch:e,onEdit:t,onDelete:a,onView:l,onAssign:o})=>{return r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 space-y-4 hover:shadow-md transition-shadow"},r.createElement("div",{className:"flex items-start justify-between"},r.createElement("div",{className:"flex items-center gap-3"},r.createElement("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg"},r.createElement(s.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})),r.createElement("div",null,r.createElement("h3",{className:"font-semibold text-gray-900 dark:text-white"},"Lote #",e.batch_number||e.id),r.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400"},e.product_name||"Producto desconocido"))),r.createElement(N.A,{variant:(e=>{switch(e){case"pending":return"warning";case"assigned":return"info";case"in_progress":return"primary";case"completed":return"success";case"cancelled":return"danger";default:return"default"}})(e.status)},(e=>{switch(e){case"pending":return"Pendiente";case"assigned":return"Asignado";case"in_progress":return"En Proceso";case"completed":return"Completado";case"cancelled":return"Cancelado";default:return e}})(e.status))),r.createElement("div",{className:"grid grid-cols-2 gap-4"},r.createElement("div",null,r.createElement("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide"},"Cantidad"),r.createElement("p",{className:"text-sm font-medium text-gray-900 dark:text-white"},e.quantity," ",e.unit||"unidades")),r.createElement("div",null,r.createElement("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide"},"Fecha Programada"),r.createElement("p",{className:"text-sm font-medium text-gray-900 dark:text-white"},(i=e.scheduled_date)?new Date(i).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"Sin fecha")),r.createElement("div",null,r.createElement("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide"},"Asignado a"),r.createElement("p",{className:"text-sm font-medium text-gray-900 dark:text-white"},e.assigned_user_name||"Sin asignar")),r.createElement("div",null,r.createElement("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide"},"Progreso"),r.createElement("div",{className:"flex items-center gap-2"},r.createElement("div",{className:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2"},r.createElement("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${e.progress||0}%`}})),r.createElement("span",{className:"text-sm font-medium text-gray-900 dark:text-white"},e.progress||0,"%")))),e.notes&&r.createElement("div",null,r.createElement("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-1"},"Notas"),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-300"},e.notes)),r.createElement("div",{className:"flex items-center gap-2 pt-4 border-t border-gray-200 dark:border-gray-700"},r.createElement(y.A,{variant:"outline",size:"sm",onClick:()=>l(e),className:"flex-1"},r.createElement(n.A,{className:"h-4 w-4 mr-1"}),"Ver"),"pending"===e.status&&r.createElement(y.A,{size:"sm",onClick:()=>o(e),className:"flex-1"},r.createElement(c.A,{className:"h-4 w-4 mr-1"}),"Asignar"),r.createElement(y.A,{variant:"outline",size:"sm",onClick:()=>t(e)},r.createElement(d.A,{className:"h-4 w-4"})),r.createElement(y.A,{variant:"outline",size:"sm",onClick:()=>a(e),className:"text-red-600 hover:text-red-700 dark:text-red-400"},r.createElement(m.A,{className:"h-4 w-4"}))));var i};t.default=()=>{(0,l.zy)();const{success:e,error:t,warning:a}=(0,p.d)(),[n,d]=(0,r.useState)(""),[m,w]=(0,r.useState)("all"),[A,_]=(0,r.useState)("all"),[C,P]=(0,r.useState)("scheduled_date"),[L,S]=(0,r.useState)("grid"),[j,z]=(0,r.useState)(!1),[D,T]=(0,r.useState)(null),[$,q]=(0,r.useState)(!1),{data:O,loading:V,refetch:W}=(0,x.Wl)("/api/production_batches"),{data:M,loading:B}=(0,x.Wl)("/api/users"),{data:F,loading:G}=(0,x.Wl)("/api/production_orders"),I=Array.isArray(O)?O:[],J=Array.isArray(M)?M:[],U=(Array.isArray(F),(0,r.useMemo)((()=>{let e=I.filter((e=>{const t=e.product_name?.toLowerCase().includes(n.toLowerCase())||e.batch_number?.toLowerCase().includes(n.toLowerCase())||e.assigned_user_name?.toLowerCase().includes(n.toLowerCase()),a="all"===m||e.status===m,r="all"===A||e.assigned_user_id===parseInt(A);return t&&a&&r}));return e.sort(((e,t)=>{switch(C){case"scheduled_date":return new Date(e.scheduled_date||0)-new Date(t.scheduled_date||0);case"priority":return(t.priority||0)-(e.priority||0);case"progress":return(t.progress||0)-(e.progress||0);case"product_name":return e.product_name?.localeCompare(t.product_name)||0;default:return 0}})),e}),[I,n,m,A,C])),H=(0,r.useMemo)((()=>({total:I.length,pending:I.filter((e=>"pending"===e.status)).length,assigned:I.filter((e=>"assigned"===e.status)).length,inProgress:I.filter((e=>"in_progress"===e.status)).length,completed:I.filter((e=>"completed"===e.status)).length})),[I]),K=e=>{T(e),z(!0)},Q=e=>{T(e),q(!0)},R=e=>{console.log("Edit batch:",e)},X=async a=>{if(confirm(`¿Estás seguro de que deseas eliminar el lote #${a.batch_number}?`))try{if(!(await fetch(`/api/production_batches/${a.id}`,{method:"DELETE"})).ok)throw new Error("Error al eliminar el lote");e("Lote eliminado",`Lote #${a.batch_number} eliminado exitosamente`),W()}catch(e){t("Error",e.message||"Error al eliminar el lote")}};return V||B||G?r.createElement("div",{className:"flex items-center justify-center min-h-96"},r.createElement(E.A,{size:"lg"})):r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},r.createElement("div",null,r.createElement("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white"},"Asignar Lotes"),r.createElement("p",{className:"text-gray-600 dark:text-gray-400"},"Gestiona la asignación de lotes de producción")),r.createElement("div",{className:"flex items-center gap-3"},r.createElement(y.A,{variant:"outline",className:"flex items-center gap-2"},r.createElement(o.A,{className:"h-4 w-4"}),"Configurar"))),r.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4"},r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Total Lotes"),r.createElement("p",{className:"text-2xl font-bold text-gray-900 dark:text-white"},H.total)),r.createElement(s.A,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"}))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Pendientes"),r.createElement("p",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400"},H.pending)),r.createElement(i.A,{className:"h-8 w-8 text-orange-600 dark:text-orange-400"}))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Asignados"),r.createElement("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400"},H.assigned)),r.createElement(c.A,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"}))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"En Proceso"),r.createElement("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400"},H.inProgress)),r.createElement(g.A,{className:"h-8 w-8 text-purple-600 dark:text-purple-400"}))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Completados"),r.createElement("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400"},H.completed)),r.createElement(u.A,{className:"h-8 w-8 text-green-600 dark:text-green-400"})))),r.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},r.createElement("div",null,r.createElement(b.A,{placeholder:"Buscar lotes...",value:n,onChange:e=>d(e.target.value),className:"w-full"})),r.createElement(h.A,{value:m,onChange:w},r.createElement("option",{value:"all"},"Todos los estados"),r.createElement("option",{value:"pending"},"Pendientes"),r.createElement("option",{value:"assigned"},"Asignados"),r.createElement("option",{value:"in_progress"},"En Proceso"),r.createElement("option",{value:"completed"},"Completados"),r.createElement("option",{value:"cancelled"},"Cancelados")),r.createElement(h.A,{value:A,onChange:_},r.createElement("option",{value:"all"},"Todos los usuarios"),J.map((e=>r.createElement("option",{key:e.id,value:e.id},e.name)))),r.createElement(h.A,{value:C,onChange:P},r.createElement("option",{value:"scheduled_date"},"Por fecha programada"),r.createElement("option",{value:"priority"},"Por prioridad"),r.createElement("option",{value:"progress"},"Por progreso"),r.createElement("option",{value:"product_name"},"Por producto"))),r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},U.map((e=>r.createElement(k,{key:e.id,batch:e,onEdit:R,onDelete:X,onView:Q,onAssign:K})))),0===U.length&&r.createElement("div",{className:"text-center py-12"},r.createElement(s.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),r.createElement("p",{className:"text-gray-500 dark:text-gray-400"},"No se encontraron lotes de producción")),D&&r.createElement(f.A,{isOpen:j,onClose:()=>{z(!1),T(null)},batch:D,users:J,onSave:async a=>{try{if(!(await fetch(`/api/production_batches/${D.id}/assign`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok)throw new Error("Error al asignar el lote");e("Lote asignado","El lote ha sido asignado exitosamente"),z(!1),T(null),W()}catch(e){t("Error",e.message||"Error al asignar el lote")}}}),r.createElement(v.A,{isOpen:$,onClose:()=>{q(!1),T(null)},title:"Detalles del Lote",size:"lg"},D&&r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"grid grid-cols-2 gap-4"},r.createElement("div",null,r.createElement("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Número de Lote"),r.createElement("p",{className:"text-lg text-gray-900 dark:text-white"},"#",D.batch_number)),r.createElement("div",null,r.createElement("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Estado"),r.createElement(N.A,{variant:"completed"===D.status?"success":"warning"},"completed"===D.status?"Completado":"En Proceso")),r.createElement("div",null,r.createElement("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Producto"),r.createElement("p",{className:"text-lg text-gray-900 dark:text-white"},D.product_name)),r.createElement("div",null,r.createElement("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Cantidad"),r.createElement("p",{className:"text-lg text-gray-900 dark:text-white"},D.quantity," ",D.unit)),r.createElement("div",null,r.createElement("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Asignado a"),r.createElement("p",{className:"text-lg text-gray-900 dark:text-white"},D.assigned_user_name||"Sin asignar")),r.createElement("div",null,r.createElement("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Progreso"),r.createElement("div",{className:"flex items-center gap-2"},r.createElement("div",{className:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-3"},r.createElement("div",{className:"bg-blue-600 h-3 rounded-full",style:{width:`${D.progress||0}%`}})),r.createElement("span",{className:"text-lg text-gray-900 dark:text-white"},D.progress||0,"%")))),D.notes&&r.createElement("div",null,r.createElement("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Notas"),r.createElement("p",{className:"text-gray-900 dark:text-white"},D.notes)),r.createElement("div",{className:"flex justify-end gap-3"},r.createElement(y.A,{variant:"outline",onClick:()=>{q(!1),T(null)}},"Cerrar"),"pending"===D.status&&r.createElement(y.A,{onClick:()=>{q(!1),K(D)}},"Asignar Lote")))))}}}]);