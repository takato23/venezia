"use strict";(self.webpackChunkvenezia_frontend=self.webpackChunkvenezia_frontend||[]).push([[3355],{63355:function(e,t,a){a.r(t);var r=a(96540),l=a(15977),s=a(48309),n=a(86589),c=a(29696),m=a(76316),o=a(42021),i=a(98445),d=a(44471),u=a(27235),p=a(50180),g=a(3160),x=a(89369),y=a(80827),E=a(70700),N=a(42203),h=a(93823),f=a(72284),b=a(11562),w=a(71428),v=a(28219),k=a(67773),_=a(24596);t.default=()=>{const{success:e,error:t}=(0,N.d)(),[a,A]=(0,r.useState)("today"),[C,S]=(0,r.useState)("all"),[T,$]=(0,r.useState)(""),[L,D]=(0,r.useState)(null),[j,z]=(0,r.useState)(!1),{data:R,loading:P,refetch:I}=(0,E.Wl)("/api/sales",null,{staleTime:3e4}),{data:V,loading:G}=(0,E.Wl)("/api/sales/today",null,{staleTime:3e4}),O=R?.sales||[],F=R?.summary||{},H=V||{},M=(0,r.useMemo)((()=>{let e=[...O];if("all"!==a){const t=(new Date).toISOString().split("T")[0],r=new Date(Date.now()-864e5).toISOString().split("T")[0],l=new Date(Date.now()-6048e5).toISOString().split("T")[0];e=e.filter((e=>{const s=e.date.split("T")[0];switch(a){case"today":return s===t;case"yesterday":return s===r;case"week":return s>=l;default:return!0}}))}return"all"!==C&&(e=e.filter((e=>e.status===C))),T&&(e=e.filter((e=>e.receipt_number?.toLowerCase().includes(T.toLowerCase())||e.customer?.name?.toLowerCase().includes(T.toLowerCase())||e.items?.some((e=>e.product_name?.toLowerCase().includes(T.toLowerCase())))))),e}),[O,a,C,T]);return P||G?r.createElement("div",{className:"flex items-center justify-center min-h-96"},r.createElement(h.A,{size:"lg"})):r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},r.createElement("div",null,r.createElement("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white"},"Historial de Ventas"),r.createElement("p",{className:"text-gray-600 dark:text-gray-400"},"Gestiona y revisa todas las transacciones de tu heladería")),r.createElement("div",{className:"flex gap-2"},r.createElement(f.A,{variant:"outline",size:"sm",onClick:async()=>{try{await I(),e("Datos actualizados")}catch(e){t("Error al actualizar datos")}},className:"flex items-center gap-2"},r.createElement(l.A,{size:16}),"Actualizar"),r.createElement(f.A,{variant:"outline",size:"sm",onClick:async()=>{try{const t={fecha_exportacion:(new Date).toLocaleString(),periodo:"all"===a?"Todas las fechas":a,total_ventas:F.total_sales||0,total_transacciones:F.total_transactions||0,ticket_promedio:F.average_ticket||0,ventas:M.map((e=>({numero_recibo:e.receipt_number,fecha:new Date(e.date).toLocaleString(),cliente:e.customer?.name||"Sin nombre",telefono:e.customer?.phone||"",productos:e.items?.map((e=>`${e.product_name} x${e.quantity}`)).join(", "),subtotal:e.subtotal,descuento:e.discount_amount,total:e.total,metodo_pago:e.payment_method,estado:e.status})))},r=["Recibo","Fecha","Cliente","Teléfono","Productos","Subtotal","Descuento","Total","Método Pago","Estado"],l=[`Reporte de Ventas - ${t.fecha_exportacion}`,`Período: ${t.periodo}`,`Total Ventas: $${t.total_ventas}`,`Total Transacciones: ${t.total_transacciones}`,`Ticket Promedio: $${t.ticket_promedio}`,"",r.join(","),...t.ventas.map((e=>[e.numero_recibo,`"${e.fecha}"`,`"${e.cliente}"`,e.telefono,`"${e.productos}"`,e.subtotal,e.descuento,e.total,e.metodo_pago,e.estado].join(",")))].join("\n"),s=new Blob([l],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a"),c=URL.createObjectURL(s);n.setAttribute("href",c),n.setAttribute("download",`ventas_${(new Date).toISOString().split("T")[0]}.csv`),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),e("Exportación completada","El archivo CSV ha sido descargado")}catch(e){console.error("Error exporting:",e),t("Error al exportar","No se pudo generar el archivo de exportación")}},className:"flex items-center gap-2"},r.createElement(s.A,{size:16}),"Exportar"))),r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4"},r.createElement("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Ventas Hoy"),r.createElement("p",{className:"text-2xl font-bold text-gray-900 dark:text-white"},"$",H.total_sales?.toLocaleString()||"0")),r.createElement("div",{className:"w-12 h-12 bg-green-100 dark:bg-green-900/20 rounded-lg flex items-center justify-center"},r.createElement(n.A,{className:"w-6 h-6 text-green-600 dark:text-green-400"})))),r.createElement("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Transacciones"),r.createElement("p",{className:"text-2xl font-bold text-gray-900 dark:text-white"},H.total_transactions||0)),r.createElement("div",{className:"w-12 h-12 bg-blue-100 dark:bg-blue-900/20 rounded-lg flex items-center justify-center"},r.createElement(c.A,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})))),r.createElement("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Ticket Promedio"),r.createElement("p",{className:"text-2xl font-bold text-gray-900 dark:text-white"},"$",H.average_ticket?.toLocaleString()||"0")),r.createElement("div",{className:"w-12 h-12 bg-purple-100 dark:bg-purple-900/20 rounded-lg flex items-center justify-center"},r.createElement(m.A,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})))),r.createElement("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Ventas Totales"),r.createElement("p",{className:"text-2xl font-bold text-gray-900 dark:text-white"},"$",F.total_sales?.toLocaleString()||"0")),r.createElement("div",{className:"w-12 h-12 bg-orange-100 dark:bg-orange-900/20 rounded-lg flex items-center justify-center"},r.createElement(o.A,{className:"w-6 h-6 text-orange-600 dark:text-orange-400"}))))),r.createElement("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"},r.createElement("div",{className:"flex flex-col md:flex-row gap-4"},r.createElement("div",{className:"flex-1"},r.createElement(b.A,{placeholder:"Buscar por recibo, cliente o producto...",value:T,onChange:e=>$(e.target.value),className:"w-full",icon:i.A})),r.createElement(w.A,{value:a,onChange:e=>A(e.target.value),className:"w-full md:w-48"},r.createElement("option",{value:"all"},"Todas las fechas"),r.createElement("option",{value:"today"},"Hoy"),r.createElement("option",{value:"yesterday"},"Ayer"),r.createElement("option",{value:"week"},"Última semana")),r.createElement(w.A,{value:C,onChange:e=>S(e.target.value),className:"w-full md:w-48"},r.createElement("option",{value:"all"},"Todos los estados"),r.createElement("option",{value:"completed"},"Completadas"),r.createElement("option",{value:"pending"},"Pendientes"),r.createElement("option",{value:"cancelled"},"Canceladas")))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"},r.createElement("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700"},r.createElement("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white"},"Transacciones (",M.length,")")),r.createElement("div",{className:"overflow-x-auto"},r.createElement("table",{className:"w-full"},r.createElement("thead",{className:"bg-gray-50 dark:bg-gray-900"},r.createElement("tr",null,r.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Recibo"),r.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Cliente"),r.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Fecha"),r.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Items"),r.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Total"),r.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Estado"),r.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Acciones"))),r.createElement("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700"},0===M.length?r.createElement("tr",null,r.createElement("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-500 dark:text-gray-400"},"No se encontraron ventas con los filtros aplicados")):M.map((e=>r.createElement("tr",{key:e.id,className:"hover:bg-gray-50 dark:hover:bg-gray-700"},r.createElement("td",{className:"px-4 py-4 whitespace-nowrap"},r.createElement("div",{className:"flex items-center"},r.createElement(o.A,{className:"w-4 h-4 text-gray-400 mr-2"}),r.createElement("span",{className:"text-sm font-medium text-gray-900 dark:text-white"},e.receipt_number))),r.createElement("td",{className:"px-4 py-4 whitespace-nowrap"},r.createElement("div",{className:"text-sm text-gray-900 dark:text-white"},e.customer?.name||"Cliente sin nombre"),e.customer?.phone&&r.createElement("div",{className:"text-sm text-gray-500 dark:text-gray-400"},e.customer.phone)),r.createElement("td",{className:"px-4 py-4 whitespace-nowrap"},r.createElement("div",{className:"text-sm text-gray-900 dark:text-white"},new Date(e.date).toLocaleDateString()),r.createElement("div",{className:"text-sm text-gray-500 dark:text-gray-400"},new Date(e.date).toLocaleTimeString())),r.createElement("td",{className:"px-4 py-4 whitespace-nowrap"},r.createElement("div",{className:"text-sm text-gray-900 dark:text-white"},e.items?.length||0," productos")),r.createElement("td",{className:"px-4 py-4 whitespace-nowrap"},r.createElement("div",{className:"text-sm font-medium text-gray-900 dark:text-white"},"$",e.total?.toLocaleString()),e.discount_amount>0&&r.createElement("div",{className:"text-sm text-green-600 dark:text-green-400"},"Desc: $",e.discount_amount?.toLocaleString())),r.createElement("td",{className:"px-4 py-4 whitespace-nowrap"},r.createElement(v.A,{variant:"completed"===e.status?"success":"pending"===e.status?"warning":"danger"},"completed"===e.status&&r.createElement(d.A,{className:"w-3 h-3 mr-1"}),"pending"===e.status&&r.createElement(u.A,{className:"w-3 h-3 mr-1"}),"cancelled"===e.status&&r.createElement(p.A,{className:"w-3 h-3 mr-1"}),"completed"===e.status?"Completada":"pending"===e.status?"Pendiente":"Cancelada")),r.createElement("td",{className:"px-4 py-4 whitespace-nowrap"},r.createElement("div",{className:"flex items-center gap-2"},r.createElement(f.A,{variant:"outline",size:"sm",onClick:()=>(e=>{D(e),z(!0)})(e),className:"flex items-center gap-1",title:"Ver detalles"},r.createElement(g.A,{size:14})),r.createElement(f.A,{variant:"outline",size:"sm",onClick:()=>{const t={...e,items:e.items||[],customer_name:e.customer?.name||"Cliente General",customer_phone:e.customer?.phone||"",customer_email:e.customer?.email||""};_.A.downloadReceipt(t)},className:"flex items-center gap-1",title:"Descargar recibo"},r.createElement(o.A,{size:14})),r.createElement(f.A,{variant:"outline",size:"sm",onClick:()=>{const t={...e,items:e.items||[],customer_name:e.customer?.name||"Cliente General",customer_phone:e.customer?.phone||"",customer_email:e.customer?.email||""};_.A.printReceipt(t)},className:"flex items-center gap-1",title:"Imprimir recibo"},r.createElement(x.A,{size:14}))))))))))),r.createElement(k.A,{isOpen:j,onClose:()=>z(!1),title:`Detalle de Venta - ${L?.receipt_number}`,maxWidth:"4xl"},L&&r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},r.createElement("div",{className:"space-y-2"},r.createElement("h4",{className:"font-medium text-gray-900 dark:text-white"},"Información de la Venta"),r.createElement("div",{className:"text-sm space-y-1"},r.createElement("p",null,r.createElement("span",{className:"font-medium"},"Recibo:")," ",L.receipt_number),r.createElement("p",null,r.createElement("span",{className:"font-medium"},"Fecha:")," ",new Date(L.date).toLocaleString()),r.createElement("p",null,r.createElement("span",{className:"font-medium"},"Método de Pago:")," ",L.payment_method),r.createElement("p",null,r.createElement("span",{className:"font-medium"},"Estado:")," ",L.status))),r.createElement("div",{className:"space-y-2"},r.createElement("h4",{className:"font-medium text-gray-900 dark:text-white"},"Información del Cliente"),r.createElement("div",{className:"text-sm space-y-1"},r.createElement("p",null,r.createElement("span",{className:"font-medium"},"Nombre:")," ",L.customer?.name||"N/A"),r.createElement("p",null,r.createElement("span",{className:"font-medium"},"Teléfono:")," ",L.customer?.phone||"N/A"),r.createElement("p",null,r.createElement("span",{className:"font-medium"},"Email:")," ",L.customer?.email||"N/A")))),r.createElement("div",null,r.createElement("h4",{className:"font-medium text-gray-900 dark:text-white mb-3"},"Productos Vendidos"),r.createElement("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden"},r.createElement("table",{className:"w-full"},r.createElement("thead",{className:"bg-gray-50 dark:bg-gray-900"},r.createElement("tr",null,r.createElement("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400"},"Producto"),r.createElement("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400"},"Cantidad"),r.createElement("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400"},"Precio Unit."),r.createElement("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400"},"Total"))),r.createElement("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700"},L.items?.map(((e,t)=>r.createElement("tr",{key:t},r.createElement("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-white"},e.product_name),r.createElement("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-white"},e.quantity),r.createElement("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-white"},"$",e.unit_price?.toLocaleString()),r.createElement("td",{className:"px-4 py-2 text-sm font-medium text-gray-900 dark:text-white"},"$",e.total_price?.toLocaleString())))))))),r.createElement("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-lg"},r.createElement("h4",{className:"font-medium text-gray-900 dark:text-white mb-3"},"Resumen Financiero"),r.createElement("div",{className:"space-y-2 text-sm"},r.createElement("div",{className:"flex justify-between"},r.createElement("span",null,"Subtotal:"),r.createElement("span",null,"$",L.subtotal?.toLocaleString())),L.discount_amount>0&&r.createElement("div",{className:"flex justify-between text-green-600 dark:text-green-400"},r.createElement("span",null,"Descuento (",L.discount_percentage,"%):"),r.createElement("span",null,"-$",L.discount_amount?.toLocaleString())),r.createElement("div",{className:"flex justify-between font-medium text-lg pt-2 border-t border-gray-200 dark:border-gray-700"},r.createElement("span",null,"Total:"),r.createElement("span",null,"$",L.total?.toLocaleString())))),r.createElement("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700"},r.createElement("h4",{className:"font-medium text-gray-900 dark:text-white mb-3"},"Documentos"),r.createElement("div",{className:"flex gap-3"},r.createElement(f.A,{variant:"outline",onClick:()=>{const e={...L,items:L.items||[],customer_name:L.customer?.name||"Cliente General",customer_phone:L.customer?.phone||"",customer_email:L.customer?.email||""};_.A.downloadReceipt(e)},className:"flex items-center gap-2"},r.createElement(o.A,{className:"h-4 w-4"}),"Descargar Recibo"),r.createElement(f.A,{variant:"outline",onClick:()=>{const e={...L,items:L.items||[],customer_name:L.customer?.name||"Cliente General",customer_phone:L.customer?.phone||"",customer_email:L.customer?.email||""};_.A.downloadInvoice(e)},className:"flex items-center gap-2"},r.createElement(y.A,{className:"h-4 w-4"}),"Descargar Factura"),r.createElement(f.A,{variant:"outline",onClick:()=>{const e={...L,items:L.items||[],customer_name:L.customer?.name||"Cliente General",customer_phone:L.customer?.phone||"",customer_email:L.customer?.email||""};_.A.printReceipt(e)},className:"flex items-center gap-2"},r.createElement(x.A,{className:"h-4 w-4"}),"Imprimir"))))))}}}]);