"use strict";(self.webpackChunkvenezia_frontend=self.webpackChunkvenezia_frontend||[]).push([[6889],{36889:function(e,t,a){a.r(t),a.d(t,{default:function(){return be}});var r=a(96540),l=a(17133),n=a(48110),s=a(86589),c=a(43197),i=a(20085),o=a(78793),m=a(80964),d=a(30684),u=a(44471),p=a(50211),g=a(41181),x=a(27798),E=a(63415),y=a(98188),v=a(48852),b=a(67773),N=a(72284),h=a(11562),f=a(71428),w=a(93823),k=a(7693),A=a(28219),C=a(42203),S=a(27235),z=a(81966),P=a(50180),D=a(37946),j=a(15977),O=a(29696),T=a(27775),$=a(89369),I=a(47504),F=a(48686),L=a(19869),M=a(76069),U=a(3160),R=a(20053);const q=({order:e,onStatusChange:t,onViewDetails:a,onSendMessage:l,onPrint:n,getElapsedTime:s,getStatusColor:c,getStatusIcon:i,getStatusLabel:o})=>{const m=i(e.status);return r.createElement("div",{className:(0,R.A)("bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-4","pending"===e.status&&new Date(e.created_at)<new Date(Date.now()-9e5)&&"ring-2 ring-red-500")},r.createElement("div",{className:"flex items-start justify-between mb-3"},r.createElement("div",null,r.createElement("div",{className:"flex items-center gap-2"},r.createElement("h3",{className:"font-medium text-gray-900 dark:text-white"},"Orden #",e.orderNumber||e.id),r.createElement(A.A,{variant:c(e.status),size:"sm"},r.createElement(m,{className:"w-3 h-3 mr-1"}),o(e.status))),r.createElement("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1"},"Hace ",s(e.created_at))),r.createElement("div",{className:"flex gap-1"},r.createElement(N.A,{variant:"ghost",size:"xs",onClick:()=>n(e),icon:$.A}),r.createElement(N.A,{variant:"ghost",size:"xs",onClick:()=>l(e),icon:I.A}))),r.createElement("div",{className:"space-y-2 mb-3"},r.createElement("div",{className:"flex items-center gap-2 text-sm"},r.createElement(F.A,{className:"w-4 h-4 text-gray-400"}),r.createElement("span",{className:"text-gray-900 dark:text-white"},e.customer?.name)),e.customer?.phone&&r.createElement("div",{className:"flex items-center gap-2 text-sm"},r.createElement(L.A,{className:"w-4 h-4 text-gray-400"}),r.createElement("span",{className:"text-gray-600 dark:text-gray-400"},e.customer.phone)),e.deliveryAddress&&r.createElement("div",{className:"flex items-start gap-2 text-sm"},r.createElement(M.A,{className:"w-4 h-4 text-gray-400 mt-0.5"}),r.createElement("span",{className:"text-gray-600 dark:text-gray-400"},e.deliveryAddress))),r.createElement("div",{className:"border-t dark:border-gray-700 pt-3 mb-3"},r.createElement("div",{className:"space-y-1 text-sm"},e.items?.slice(0,3).map(((e,t)=>r.createElement("div",{key:t,className:"flex justify-between"},r.createElement("span",{className:"text-gray-600 dark:text-gray-400"},e.quantity,"x ",e.productName),r.createElement("span",{className:"text-gray-900 dark:text-white"},"$",e.total?.toLocaleString())))),e.items?.length>3&&r.createElement("p",{className:"text-gray-500 dark:text-gray-400 text-xs"},"+",e.items.length-3," más..."))),r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400"},"Total"),r.createElement("p",{className:"text-lg font-bold text-gray-900 dark:text-white"},"$",e.total?.toLocaleString())),r.createElement("div",{className:"flex gap-2"},r.createElement(N.A,{variant:"outline",size:"sm",onClick:a,icon:U.A},"Ver"),"pending"===e.status&&r.createElement(N.A,{variant:"primary",size:"sm",onClick:()=>t(e.id,"confirmed")},"Confirmar"),"confirmed"===e.status&&r.createElement(N.A,{variant:"primary",size:"sm",onClick:()=>t(e.id,"preparing")},"Preparar"),"preparing"===e.status&&r.createElement(N.A,{variant:"primary",size:"sm",onClick:()=>t(e.id,"ready")},"Listo"))))},_=({order:e,isOpen:t,onClose:a,onStatusChange:l,onPrint:n,getStatusColor:s,getStatusLabel:c})=>e?r.createElement(b.A,{isOpen:t,onClose:a,title:`Orden #${e.orderNumber||e.id}`,size:"lg"},r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Estado actual"),r.createElement(A.A,{variant:s(e.status),size:"lg"},c(e.status))),r.createElement("div",{className:"text-right"},r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Creada"),r.createElement("p",{className:"font-medium"},new Date(e.created_at).toLocaleString()))),r.createElement("div",null,r.createElement("h3",{className:"font-medium text-gray-900 dark:text-white mb-3"},"Información del Cliente"),r.createElement("div",{className:"grid grid-cols-2 gap-4 text-sm"},r.createElement("div",null,r.createElement("p",{className:"text-gray-600 dark:text-gray-400"},"Nombre"),r.createElement("p",{className:"font-medium"},e.customer?.name)),r.createElement("div",null,r.createElement("p",{className:"text-gray-600 dark:text-gray-400"},"Teléfono"),r.createElement("p",{className:"font-medium"},e.customer?.phone||"N/A")),r.createElement("div",null,r.createElement("p",{className:"text-gray-600 dark:text-gray-400"},"Email"),r.createElement("p",{className:"font-medium"},e.customer?.email||"N/A")),r.createElement("div",null,r.createElement("p",{className:"text-gray-600 dark:text-gray-400"},"Método de pago"),r.createElement("p",{className:"font-medium"},e.paymentMethod||"Efectivo"))),e.deliveryAddress&&r.createElement("div",{className:"mt-3"},r.createElement("p",{className:"text-gray-600 dark:text-gray-400 text-sm"},"Dirección de entrega"),r.createElement("p",{className:"font-medium"},e.deliveryAddress))),r.createElement("div",null,r.createElement("h3",{className:"font-medium text-gray-900 dark:text-white mb-3"},"Productos"),r.createElement("div",{className:"border dark:border-gray-700 rounded-lg overflow-hidden"},r.createElement("table",{className:"w-full"},r.createElement("thead",{className:"bg-gray-50 dark:bg-gray-900"},r.createElement("tr",null,r.createElement("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400"},"Producto"),r.createElement("th",{className:"px-4 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-400"},"Cant."),r.createElement("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-400"},"Precio"),r.createElement("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-400"},"Total"))),r.createElement("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700"},e.items?.map(((e,t)=>r.createElement("tr",{key:t},r.createElement("td",{className:"px-4 py-2 text-sm"},e.productName),r.createElement("td",{className:"px-4 py-2 text-sm text-center"},e.quantity),r.createElement("td",{className:"px-4 py-2 text-sm text-right"},"$",e.price?.toLocaleString()),r.createElement("td",{className:"px-4 py-2 text-sm text-right font-medium"},"$",e.total?.toLocaleString()))))),r.createElement("tfoot",{className:"bg-gray-50 dark:bg-gray-900"},r.createElement("tr",null,r.createElement("td",{colSpan:"3",className:"px-4 py-2 text-right font-medium"},"Total"),r.createElement("td",{className:"px-4 py-2 text-right font-bold text-lg"},"$",e.total?.toLocaleString())))))),e.notes&&r.createElement("div",null,r.createElement("h3",{className:"font-medium text-gray-900 dark:text-white mb-2"},"Notas"),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400 p-3 bg-gray-50 dark:bg-gray-700/50 rounded"},e.notes)),r.createElement("div",{className:"flex justify-between pt-4 border-t dark:border-gray-700"},r.createElement(N.A,{variant:"outline",onClick:()=>n(e),icon:$.A},"Imprimir"),r.createElement("div",{className:"flex gap-2"},"delivered"!==e.status&&"cancelled"!==e.status&&r.createElement(r.Fragment,null,r.createElement(N.A,{variant:"danger",onClick:()=>l(e.id,"cancelled")},"Cancelar orden"),r.createElement(N.A,{variant:"primary",onClick:()=>{const t={pending:"confirmed",confirmed:"preparing",preparing:"ready",ready:"delivering",delivering:"delivered"}[e.status];t&&l(e.id,t)}},"Siguiente estado")))))):null;var H=({orders:e=[],onUpdateOrder:t,onRefresh:a})=>{const{success:n,error:s,info:c}=(0,C.d)(),[i,o]=(0,r.useState)(null),[m,d]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1),[x,E]=(0,r.useState)(""),[y,v]=(0,r.useState)("all"),[f,w]=(0,r.useState)(!0);(0,r.useEffect)((()=>{if(!f)return;const e=setInterval((()=>{a()}),3e4);return()=>clearInterval(e)}),[f,a]),(0,r.useEffect)((()=>{const t=e.filter((e=>"pending"===e.status&&new Date(e.created_at)>new Date(Date.now()-6e4)));t.length>0&&(c("Nueva orden",`${t.length} nueva(s) orden(es) recibida(s)`),k())}),[e]);const k=()=>{try{new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGI0fPTgjMGHm7A7+OZURE").play()}catch(e){console.log("Could not play notification sound")}},A=[{value:"pending",label:"Pendiente",color:"yellow",icon:S.A},{value:"confirmed",label:"Confirmada",color:"blue",icon:u.A},{value:"preparing",label:"Preparando",color:"orange",icon:l.A},{value:"ready",label:"Lista",color:"green",icon:u.A},{value:"delivering",label:"En camino",color:"purple",icon:z.A},{value:"delivered",label:"Entregada",color:"green",icon:u.A},{value:"cancelled",label:"Cancelada",color:"red",icon:P.A}],$=e.filter((e=>"all"===y||e.status===y)),I=async(e,a)=>{try{await t(e,{status:a}),n("Estado actualizado",`La orden ahora está ${F(a)}`),["confirmed","ready","delivering"].includes(a)&&U(e,a)}catch(e){s("Error","No se pudo actualizar el estado")}},F=e=>{const t=A.find((t=>t.value===e));return t?.label||e},L=e=>{const t=A.find((t=>t.value===e));return t?.color||"gray"},M=e=>{const t=A.find((t=>t.value===e));return t?.icon||D.A},U=async(e,t)=>{try{await fetch("/api/shop/orders/notify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e,status:t})})}catch(e){console.error("Error sending notification:",e)}},R=e=>{window.print()},H=e=>{const t=Date.now()-new Date(e).getTime(),a=Math.floor(t/6e4);return a<60?`${a} min`:`${Math.floor(a/60)}h ${a%60}min`};return r.createElement("div",{className:"space-y-4"},r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-4"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",{className:"flex items-center gap-4"},r.createElement("div",{className:"flex gap-2"},r.createElement(N.A,{variant:"all"===y?"primary":"outline",size:"sm",onClick:()=>v("all")},"Todas (",e.length,")"),A.map((t=>{const a=e.filter((e=>e.status===t.value)).length;return 0===a?null:r.createElement(N.A,{key:t.value,variant:y===t.value?"primary":"outline",size:"sm",onClick:()=>v(t.value)},t.label," (",a,")")})))),r.createElement("div",{className:"flex items-center gap-2"},r.createElement(N.A,{variant:"outline",size:"sm",onClick:a,icon:j.A},"Actualizar"),r.createElement("label",{className:"flex items-center gap-2 text-sm"},r.createElement("input",{type:"checkbox",checked:f,onChange:e=>w(e.target.checked),className:"rounded border-gray-300 dark:border-gray-600"}),r.createElement("span",{className:"text-gray-600 dark:text-gray-400"},"Auto-actualizar"))))),$.filter((e=>"pending"===e.status&&new Date(e.created_at)<new Date(Date.now()-9e5))).length>0&&r.createElement("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4"},r.createElement("div",{className:"flex items-center gap-2 text-red-700 dark:text-red-300"},r.createElement(D.A,{className:"w-5 h-5"}),r.createElement("span",{className:"font-medium"},$.filter((e=>"pending"===e.status&&new Date(e.created_at)<new Date(Date.now()-9e5))).length," órdenes pendientes por más de 15 minutos"))),r.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4"},$.map((e=>r.createElement(q,{key:e.id,order:e,onStatusChange:I,onViewDetails:()=>{o(e),d(!0)},onSendMessage:()=>{o(e),g(!0)},onPrint:()=>R(),getElapsedTime:H,getStatusColor:L,getStatusIcon:M,getStatusLabel:F})))),0===$.length&&r.createElement("div",{className:"text-center py-12"},r.createElement(O.A,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.createElement("p",{className:"text-gray-500 dark:text-gray-400"},"No hay órdenes ","all"!==y?F(y).toLowerCase()+"s":"")),r.createElement(_,{order:i,isOpen:m,onClose:()=>d(!1),onStatusChange:I,onPrint:R,getStatusColor:L,getStatusLabel:F}),r.createElement(b.A,{isOpen:p,onClose:()=>g(!1),title:"Enviar mensaje al cliente"},r.createElement("div",{className:"space-y-4"},r.createElement("div",{className:"text-sm text-gray-600 dark:text-gray-400"},r.createElement("p",null,"Cliente: ",i?.customer?.name),r.createElement("p",null,"Teléfono: ",i?.customer?.phone)),r.createElement(h.A,{label:"Mensaje",value:x,onChange:e=>E(e.target.value),multiline:!0,rows:4,placeholder:"Escribe tu mensaje aquí..."}),r.createElement("div",{className:"flex justify-end gap-2"},r.createElement(N.A,{variant:"outline",onClick:()=>g(!1)},"Cancelar"),r.createElement(N.A,{variant:"primary",onClick:async()=>{if(x.trim()&&i)try{await fetch("/api/shop/orders/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:i.id,message:x})}),n("Mensaje enviado","El cliente recibirá el mensaje por WhatsApp/Email"),E(""),g(!1)}catch(e){s("Error","No se pudo enviar el mensaje")}},icon:T.A,disabled:!x.trim()},"Enviar")))))},V=a(47792),B=a(76316),G=a(93893),J=a(71429);const Q=({title:e,value:t,change:a,icon:l,color:n})=>{const s=a>=0,c=s?B.A:J.A;return r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6"},r.createElement("div",{className:"flex items-center justify-between mb-4"},r.createElement("div",{className:(0,R.A)("p-3 rounded-lg",{green:"bg-green-100 dark:bg-green-900/20 text-green-600 dark:text-green-400",blue:"bg-blue-100 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400",purple:"bg-purple-100 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400",orange:"bg-orange-100 dark:bg-orange-900/20 text-orange-600 dark:text-orange-400"}[n])},r.createElement(l,{className:"w-6 h-6"})),0!==a&&r.createElement("div",{className:(0,R.A)("flex items-center gap-1 text-sm font-medium",s?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400")},r.createElement(c,{className:"w-4 h-4"}),r.createElement("span",null,Math.abs(a),"%"))),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},e),r.createElement("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1"},t))};var W=({orders:e=[],products:t=[],customers:a=[]})=>{const[l,n]=(0,r.useState)("week"),[c,i]=(0,r.useState)("overview"),o=(0,r.useMemo)((()=>{const t=new Date;let a=new Date;switch(l){case"today":a.setHours(0,0,0,0);break;case"week":a.setDate(t.getDate()-7);break;case"month":a.setMonth(t.getMonth()-1);break;case"year":a.setFullYear(t.getFullYear()-1)}return{orders:e.filter((e=>new Date(e.created_at)>=a))}}),[e,l]),m=(0,r.useMemo)((()=>{const{orders:e}=o,t=e.filter((e=>"delivered"===e.status||"completed"===e.status)).reduce(((e,t)=>e+(t.total||0)),0),a=e.length,r=e.filter((e=>"delivered"===e.status||"completed"===e.status)).length,l=a>0?t/r:0,n=a>0?r/a*100:0,s={};e.forEach((e=>{e.items?.forEach((e=>{s[e.productId]||(s[e.productId]={name:e.productName,quantity:0,revenue:0,orders:0}),s[e.productId].quantity+=e.quantity,s[e.productId].revenue+=e.total||0,s[e.productId].orders+=1}))}));const c=Object.entries(s).map((([e,t])=>({id:e,...t}))).sort(((e,t)=>t.revenue-e.revenue)).slice(0,10),i={};e.forEach((e=>{const t=e.customer?.id||e.customer?.email;t&&(i[t]||(i[t]={name:e.customer.name,orders:0,totalSpent:0,lastOrder:e.created_at}),i[t].orders+=1,i[t].totalSpent+=e.total||0,new Date(e.created_at)>new Date(i[t].lastOrder)&&(i[t].lastOrder=e.created_at))}));const m=Object.entries(i).map((([e,t])=>({id:e,...t}))).sort(((e,t)=>t.totalSpent-e.totalSpent)).slice(0,10),d={},u=Array(24).fill(0);e.forEach((e=>{const t=new Date(e.created_at),a=t.toISOString().split("T")[0],r=t.getHours();d[a]||(d[a]={orders:0,revenue:0}),d[a].orders+=1,d[a].revenue+=e.total||0,u[r]+=e.total||0}));const p=e.filter((e=>"abandoned"===e.status)).length;return{totalRevenue:t,totalOrders:a,completedOrders:r,averageOrderValue:l,conversionRate:n,abandonmentRate:a>0?p/a*100:0,topProducts:c,topCustomers:m,salesByDay:d,salesByHour:u}}),[o]),d=(0,r.useMemo)((()=>({revenue:{current:m.totalRevenue,previous:.8*m.totalRevenue,change:25},orders:{current:m.totalOrders,previous:Math.floor(.9*m.totalOrders),change:11},avgOrder:{current:m.averageOrderValue,previous:.95*m.averageOrderValue,change:5}})),[m]);return r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",{className:"flex items-center gap-4"},r.createElement(f.A,{value:l,onChange:e=>n(e.target.value),className:"w-40"},r.createElement("option",{value:"today"},"Hoy"),r.createElement("option",{value:"week"},"Última semana"),r.createElement("option",{value:"month"},"Último mes"),r.createElement("option",{value:"year"},"Último año")),r.createElement("div",{className:"flex gap-2"},r.createElement("button",{onClick:()=>i("overview"),className:(0,R.A)("px-3 py-1 rounded-lg text-sm font-medium transition-colors","overview"===c?"bg-venezia-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400")},"General"),r.createElement("button",{onClick:()=>i("products"),className:(0,R.A)("px-3 py-1 rounded-lg text-sm font-medium transition-colors","products"===c?"bg-venezia-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400")},"Productos"),r.createElement("button",{onClick:()=>i("customers"),className:(0,R.A)("px-3 py-1 rounded-lg text-sm font-medium transition-colors","customers"===c?"bg-venezia-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400")},"Clientes")))),"overview"===c&&r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},r.createElement(Q,{title:"Ingresos Totales",value:`$${m.totalRevenue.toLocaleString()}`,change:d.revenue.change,icon:s.A,color:"green"}),r.createElement(Q,{title:"Órdenes Totales",value:m.totalOrders,change:d.orders.change,icon:O.A,color:"blue"}),r.createElement(Q,{title:"Ticket Promedio",value:`$${Math.round(m.averageOrderValue).toLocaleString()}`,change:d.avgOrder.change,icon:p.A,color:"purple"}),r.createElement(Q,{title:"Tasa de Conversión",value:`${m.conversionRate.toFixed(1)}%`,change:0,icon:V.A,color:"orange"})),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6"},r.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4"},"Ventas por Día"),r.createElement("div",{className:"h-64 flex items-end gap-2"},Object.entries(m.salesByDay).slice(-7).map((([e,t])=>{const a=Math.max(...Object.values(m.salesByDay).map((e=>e.revenue))),l=a>0?t.revenue/a*100:0;return r.createElement("div",{key:e,className:"flex-1 flex flex-col items-center"},r.createElement("div",{className:"w-full bg-venezia-500 rounded-t hover:bg-venezia-600 transition-colors relative group",style:{height:`${l}%`}},r.createElement("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap"},"$",t.revenue.toLocaleString())),r.createElement("span",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2"},new Date(e).toLocaleDateString("es",{weekday:"short"})))})))),r.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6"},r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6"},r.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4"},"Horarios de Mayor Venta"),r.createElement("div",{className:"space-y-3"},m.salesByHour.map(((e,t)=>({hour:t,revenue:e}))).sort(((e,t)=>t.revenue-e.revenue)).slice(0,5).map((({hour:e,revenue:t})=>r.createElement("div",{key:e,className:"flex items-center justify-between"},r.createElement("div",{className:"flex items-center gap-3"},r.createElement(S.A,{className:"w-4 h-4 text-gray-400"}),r.createElement("span",{className:"text-sm font-medium"},e,":00 - ",e+1,":00")),r.createElement("div",{className:"flex items-center gap-2"},r.createElement("div",{className:"w-32 bg-gray-200 dark:bg-gray-700 rounded-full h-2"},r.createElement("div",{className:"bg-venezia-500 h-2 rounded-full",style:{width:t/Math.max(...m.salesByHour)*100+"%"}})),r.createElement("span",{className:"text-sm text-gray-600 dark:text-gray-400 w-20 text-right"},"$",t.toLocaleString()))))))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6"},r.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4"},"Rendimiento de Conversión"),r.createElement("div",{className:"space-y-4"},r.createElement("div",null,r.createElement("div",{className:"flex justify-between mb-1"},r.createElement("span",{className:"text-sm text-gray-600 dark:text-gray-400"},"Tasa de conversión"),r.createElement("span",{className:"text-sm font-medium"},m.conversionRate.toFixed(1),"%")),r.createElement("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3"},r.createElement("div",{className:"bg-green-500 h-3 rounded-full",style:{width:`${m.conversionRate}%`}}))),r.createElement("div",null,r.createElement("div",{className:"flex justify-between mb-1"},r.createElement("span",{className:"text-sm text-gray-600 dark:text-gray-400"},"Tasa de abandono"),r.createElement("span",{className:"text-sm font-medium"},m.abandonmentRate.toFixed(1),"%")),r.createElement("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3"},r.createElement("div",{className:"bg-red-500 h-3 rounded-full",style:{width:`${m.abandonmentRate}%`}}))))))),"products"===c&&r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700"},r.createElement("div",{className:"p-6 border-b dark:border-gray-700"},r.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white"},"Productos Más Vendidos")),r.createElement("div",{className:"overflow-x-auto"},r.createElement("table",{className:"w-full"},r.createElement("thead",{className:"bg-gray-50 dark:bg-gray-900"},r.createElement("tr",null,r.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Producto"),r.createElement("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Cantidad"),r.createElement("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Órdenes"),r.createElement("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Ingresos"),r.createElement("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Tendencia"))),r.createElement("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700"},m.topProducts.map(((e,t)=>r.createElement("tr",{key:e.id,className:"hover:bg-gray-50 dark:hover:bg-gray-700/50"},r.createElement("td",{className:"px-6 py-4"},r.createElement("div",{className:"flex items-center gap-3"},r.createElement("span",{className:"text-sm font-medium text-gray-900 dark:text-white"},t+1,". ",e.name))),r.createElement("td",{className:"px-6 py-4 text-center text-sm"},e.quantity),r.createElement("td",{className:"px-6 py-4 text-center text-sm"},e.orders),r.createElement("td",{className:"px-6 py-4 text-right text-sm font-medium"},"$",e.revenue.toLocaleString()),r.createElement("td",{className:"px-6 py-4 text-center"},r.createElement(B.A,{className:"w-4 h-4 text-green-500 mx-auto"})))))))))),"customers"===c&&r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700"},r.createElement("div",{className:"p-6 border-b dark:border-gray-700"},r.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white"},"Mejores Clientes")),r.createElement("div",{className:"overflow-x-auto"},r.createElement("table",{className:"w-full"},r.createElement("thead",{className:"bg-gray-50 dark:bg-gray-900"},r.createElement("tr",null,r.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Cliente"),r.createElement("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Órdenes"),r.createElement("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Total Gastado"),r.createElement("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Última Orden"),r.createElement("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Estado"))),r.createElement("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700"},m.topCustomers.map(((e,t)=>{const a=Math.floor((Date.now()-new Date(e.lastOrder).getTime())/864e5);return r.createElement("tr",{key:e.id,className:"hover:bg-gray-50 dark:hover:bg-gray-700/50"},r.createElement("td",{className:"px-6 py-4"},r.createElement("div",{className:"flex items-center gap-3"},r.createElement("div",{className:"w-8 h-8 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center"},r.createElement(G.A,{className:"w-4 h-4 text-gray-500"})),r.createElement("span",{className:"text-sm font-medium text-gray-900 dark:text-white"},e.name))),r.createElement("td",{className:"px-6 py-4 text-center text-sm"},e.orders),r.createElement("td",{className:"px-6 py-4 text-right text-sm font-medium"},"$",e.totalSpent.toLocaleString()),r.createElement("td",{className:"px-6 py-4 text-center text-sm text-gray-600 dark:text-gray-400"},"Hace ",a," días"),r.createElement("td",{className:"px-6 py-4 text-center"},r.createElement(A.A,{variant:a<30?"success":a<60?"warning":"danger",size:"sm"},a<30?"Activo":a<60?"En riesgo":"Inactivo")))}))))))))},Z=a(3768),Y=a(21767),X=a(80697),K=a(35404),ee=a(32708);const te=({coupon:e,onEdit:t,onDelete:a,onToggle:l,onDuplicate:i,onViewStats:m})=>{const d=[{value:"percentage",label:"Porcentaje",icon:Z.A},{value:"fixed",label:"Monto fijo",icon:s.A},{value:"freeShipping",label:"Envío gratis",icon:z.A},{value:"buyOneGetOne",label:"2x1",icon:Y.A},{value:"productDiscount",label:"Descuento en producto",icon:n.A}],p=d.find((t=>t.value===e.type))?.icon||c.A,g=new Date(e.expiryDate)<new Date;return r.createElement("div",{className:(0,R.A)("bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6",!e.isActive&&"opacity-60",g&&"border-red-300 dark:border-red-800")},r.createElement("div",{className:"flex items-start justify-between mb-4"},r.createElement("div",{className:"flex items-center gap-3"},r.createElement("div",{className:(0,R.A)("p-2 rounded-lg",e.isActive&&!g?"bg-venezia-100 dark:bg-venezia-900/20 text-venezia-600 dark:text-venezia-400":"bg-gray-100 dark:bg-gray-700 text-gray-500")},r.createElement(p,{className:"w-5 h-5"})),r.createElement("div",null,r.createElement("h4",{className:"font-medium text-gray-900 dark:text-white"},e.code),r.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400"},e.description))),r.createElement("div",{className:"flex items-center gap-1"},e.isActive&&!g?r.createElement(A.A,{variant:"success",size:"xs"},"Activo"):g?r.createElement(A.A,{variant:"danger",size:"xs"},"Expirado"):r.createElement(A.A,{variant:"default",size:"xs"},"Inactivo"))),r.createElement("div",{className:"space-y-2 mb-4"},r.createElement("div",{className:"flex items-center justify-between text-sm"},r.createElement("span",{className:"text-gray-600 dark:text-gray-400"},"Descuento:"),r.createElement("span",{className:"font-medium"},"percentage"===e.type&&`${e.value}%`,"fixed"===e.type&&`$${e.value}`,"freeShipping"===e.type&&"Envío gratis","buyOneGetOne"===e.type&&"2x1")),e.minimumAmount>0&&r.createElement("div",{className:"flex items-center justify-between text-sm"},r.createElement("span",{className:"text-gray-600 dark:text-gray-400"},"Mínimo:"),r.createElement("span",{className:"font-medium"},"$",e.minimumAmount)),r.createElement("div",{className:"flex items-center justify-between text-sm"},r.createElement("span",{className:"text-gray-600 dark:text-gray-400"},"Usos:"),r.createElement("span",{className:"font-medium"},e.usageCount," / ",e.maxUses||"∞")),r.createElement("div",{className:"flex items-center justify-between text-sm"},r.createElement("span",{className:"text-gray-600 dark:text-gray-400"},"Expira:"),r.createElement("span",{className:(0,R.A)("font-medium",g&&"text-red-600 dark:text-red-400")},new Date(e.expiryDate).toLocaleDateString()))),r.createElement("div",{className:"flex items-center gap-2"},r.createElement(N.A,{variant:"ghost",size:"xs",onClick:m,icon:o.A}),r.createElement(N.A,{variant:"ghost",size:"xs",onClick:t,icon:y.A}),r.createElement(N.A,{variant:"ghost",size:"xs",onClick:i,icon:K.A}),r.createElement(N.A,{variant:"ghost",size:"xs",onClick:l,icon:e.isActive?P.A:u.A}),r.createElement(N.A,{variant:"ghost",size:"xs",onClick:a,icon:ee.A,className:"text-red-600 hover:text-red-700"})))},ae=({coupon:e,onSave:t,onCancel:a,loading:l})=>{const[n,s]=(0,r.useState)({code:e?.code||"",description:e?.description||"",type:e?.type||"percentage",value:e?.value||10,minimumAmount:e?.minimumAmount||0,maxUses:e?.maxUses||null,maxUsesPerCustomer:e?.maxUsesPerCustomer||1,expiryDate:e?.expiryDate||new Date(Date.now()+2592e6).toISOString().split("T")[0],isActive:e?.isActive??!0,applicableProducts:e?.applicableProducts||[],applicableCategories:e?.applicableCategories||[],customerTiers:e?.customerTiers||[]}),[c,i]=(0,r.useState)({}),o=(e,t)=>{s((a=>({...a,[e]:t}))),c[e]&&i((t=>({...t,[e]:""})))};return r.createElement("form",{onSubmit:e=>{e.preventDefault(),(()=>{const e={};return n.code.trim()?/^[A-Z0-9_-]+$/.test(n.code)||(e.code="Solo mayúsculas, números, guiones y guión bajo"):e.code="El código es requerido",n.description.trim()||(e.description="La descripción es requerida"),"percentage"===n.type&&(n.value<=0||n.value>100)&&(e.value="El porcentaje debe estar entre 1 y 100"),"fixed"===n.type&&n.value<=0&&(e.value="El monto debe ser mayor a 0"),new Date(n.expiryDate)<new Date&&(e.expiryDate="La fecha debe ser futura"),i(e),0===Object.keys(e).length})()&&t(n)},className:"space-y-4"},r.createElement("div",{className:"grid grid-cols-2 gap-4"},r.createElement(h.A,{label:"Código del cupón",value:n.code,onChange:e=>o("code",e.target.value.toUpperCase()),error:c.code,placeholder:"VERANO2024",required:!0}),r.createElement(f.A,{label:"Tipo de descuento",value:n.type,onChange:e=>o("type",e.target.value),options:couponTypes})),r.createElement(h.A,{label:"Descripción",value:n.description,onChange:e=>o("description",e.target.value),error:c.description,placeholder:"Descuento de verano del 20%",required:!0}),r.createElement("div",{className:"grid grid-cols-2 gap-4"},("percentage"===n.type||"fixed"===n.type)&&r.createElement(h.A,{label:"percentage"===n.type?"Porcentaje":"Monto",type:"number",value:n.value,onChange:e=>o("value",parseFloat(e.target.value)),error:c.value,min:"0",max:"percentage"===n.type?"100":void 0,step:"percentage"===n.type?"1":"0.01",required:!0}),r.createElement(h.A,{label:"Compra mínima",type:"number",value:n.minimumAmount,onChange:e=>o("minimumAmount",parseFloat(e.target.value)||0),min:"0",step:"0.01",placeholder:"0 = Sin mínimo"})),r.createElement("div",{className:"grid grid-cols-3 gap-4"},r.createElement(h.A,{label:"Usos máximos",type:"number",value:n.maxUses||"",onChange:e=>o("maxUses",parseInt(e.target.value)||null),min:"1",placeholder:"Ilimitado"}),r.createElement(h.A,{label:"Por cliente",type:"number",value:n.maxUsesPerCustomer,onChange:e=>o("maxUsesPerCustomer",parseInt(e.target.value)||1),min:"1"}),r.createElement(h.A,{label:"Fecha de expiración",type:"date",value:n.expiryDate,onChange:e=>o("expiryDate",e.target.value),error:c.expiryDate,min:(new Date).toISOString().split("T")[0],required:!0})),r.createElement("div",{className:"flex items-center gap-4"},r.createElement("label",{className:"flex items-center gap-2"},r.createElement("input",{type:"checkbox",checked:n.isActive,onChange:e=>o("isActive",e.target.checked),className:"rounded border-gray-300 dark:border-gray-600"}),r.createElement("span",{className:"text-sm text-gray-700 dark:text-gray-300"},"Activar cupón inmediatamente"))),r.createElement("div",{className:"flex justify-end gap-2 pt-4 border-t dark:border-gray-700"},r.createElement(N.A,{type:"button",variant:"outline",onClick:a},"Cancelar"),r.createElement(N.A,{type:"submit",variant:"primary",loading:l},e?.id?"Actualizar":"Crear"," Cupón")))},re=({stats:e})=>r.createElement("div",{className:"space-y-4"},r.createElement("div",{className:"grid grid-cols-2 gap-4"},r.createElement("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},r.createElement("p",{className:"text-2xl font-bold text-gray-900 dark:text-white"},e.totalUses),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Usos totales")),r.createElement("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},r.createElement("p",{className:"text-2xl font-bold text-gray-900 dark:text-white"},"$",e.totalDiscount.toFixed(2)),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Descuento total"))),r.createElement("div",{className:"text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg"},r.createElement("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400"},"$",e.generatedRevenue.toFixed(2)),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Ingresos generados")),r.createElement("div",null,r.createElement("h4",{className:"font-medium text-gray-900 dark:text-white mb-2"},"Últimos usos"),r.createElement("div",{className:"space-y-2"},e.recentUses?.map(((e,t)=>r.createElement("div",{key:t,className:"flex items-center justify-between text-sm"},r.createElement("span",{className:"text-gray-600 dark:text-gray-400"},e.customerName),r.createElement("span",{className:"text-gray-900 dark:text-white"},"$",e.orderTotal," (",new Date(e.usedAt).toLocaleDateString(),")")))))));var le=({onCouponChange:e})=>{const{success:t,error:a,warning:l,info:i}=(0,C.d)(),[o,m]=(0,r.useState)([]),[d,u]=(0,r.useState)(!1),[p,g]=(0,r.useState)(null),[x,E]=(0,r.useState)(!1),[y,v]=(0,r.useState)(null),[w,k]=(0,r.useState)(!1),[A,S]=(0,r.useState)("all"),[P,D]=(0,r.useState)("");Z.A,s.A,z.A,Y.A,n.A,(0,r.useEffect)((()=>{j()}),[]);const j=async()=>{try{const e=await fetch("/api/shop/coupons");if(e.ok){const t=await e.json();m(t.coupons||[])}}catch(e){a("Error","No se pudieron cargar los cupones")}},O=o.filter((e=>{const t=e.code.toLowerCase().includes(P.toLowerCase())||e.description?.toLowerCase().includes(P.toLowerCase()),a="all"===A||"active"===A&&e.isActive||"inactive"===A&&!e.isActive||"expired"===A&&new Date(e.expiryDate)<new Date;return t&&a}));return r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6"},r.createElement("div",{className:"flex items-center justify-between mb-4"},r.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white"},"Gestión de Cupones y Promociones"),r.createElement(N.A,{variant:"primary",icon:X.A,onClick:()=>{g(null),u(!0)}},"Nuevo Cupón")),r.createElement("div",{className:"flex flex-col sm:flex-row gap-4"},r.createElement("div",{className:"flex-1"},r.createElement(h.A,{placeholder:"Buscar por código o descripción...",value:P,onChange:e=>D(e.target.value),icon:c.A})),r.createElement(f.A,{value:A,onChange:e=>S(e.target.value),className:"w-full sm:w-48"},r.createElement("option",{value:"all"},"Todos"),r.createElement("option",{value:"active"},"Activos"),r.createElement("option",{value:"inactive"},"Inactivos"),r.createElement("option",{value:"expired"},"Expirados")))),r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},O.map((e=>r.createElement(te,{key:e.id,coupon:e,onEdit:()=>{g(e),u(!0)},onDelete:()=>(async e=>{if(window.confirm("¿Está seguro de eliminar este cupón?"))try{(await fetch(`/api/shop/coupons/${e}`,{method:"DELETE"})).ok&&(t("Cupón eliminado","El cupón se eliminó correctamente"),j())}catch(e){a("Error","No se pudo eliminar el cupón")}})(e.id),onToggle:()=>(async e=>{try{(await fetch(`/api/shop/coupons/${e.id}/toggle`,{method:"PUT"})).ok&&(i(e.isActive?"Cupón desactivado":"Cupón activado",`El cupón ${e.code} ahora está ${e.isActive?"inactivo":"activo"}`),j())}catch(e){a("Error","No se pudo cambiar el estado del cupón")}})(e),onDuplicate:()=>(e=>{const t={...e,id:null,code:`${e.code}_COPY`,usageCount:0,isActive:!1};g(t),u(!0)})(e),onViewStats:()=>(async e=>{try{const t=await fetch(`/api/shop/coupons/${e}/stats`);if(t.ok){const e=await t.json();v(e),E(!0)}}catch(e){a("Error","No se pudieron cargar las estadísticas")}})(e.id)})))),0===O.length&&r.createElement("div",{className:"text-center py-12 bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700"},r.createElement(c.A,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.createElement("p",{className:"text-gray-500 dark:text-gray-400"},P||"all"!==A?"No se encontraron cupones con los filtros aplicados":"No hay cupones creados aún")),r.createElement(b.A,{isOpen:d,onClose:()=>{u(!1),g(null)},title:p?.id?"Editar Cupón":"Nuevo Cupón",size:"lg"},r.createElement(ae,{coupon:p,onSave:async r=>{k(!0);try{const a=p?`/api/shop/coupons/${p.id}`:"/api/shop/coupons",l=await fetch(a,{method:p?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!l.ok){const e=await l.json();throw new Error(e.error||"Error al guardar el cupón")}t(p?"Cupón actualizado":"Cupón creado",`El cupón ${r.code} se ${p?"actualizó":"creó"} correctamente`),j(),u(!1),g(null),e&&e()}catch(e){a("Error",e.message)}finally{k(!1)}},onCancel:()=>{u(!1),g(null)},loading:w})),r.createElement(b.A,{isOpen:x,onClose:()=>E(!1),title:"Estadísticas del Cupón"},y&&r.createElement(re,{stats:y})))},ne=a(32307);const se=({product:e,onSave:t,onCancel:a,calculateDynamicPrice:l})=>{const[n,c]=(0,r.useState)(e.webPrice||e.price),[i,o]=(0,r.useState)(""),m=l(e),d=n-m.basePrice,u=(d/m.basePrice*100).toFixed(1);return r.createElement("div",{className:"space-y-4"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Producto"),r.createElement("p",{className:"font-medium"},e.name)),r.createElement("div",{className:"grid grid-cols-2 gap-4"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Precio actual"),r.createElement("p",{className:"text-lg font-medium"},"$",m.basePrice.toFixed(2))),r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Precio con descuentos"),r.createElement("p",{className:"text-lg font-medium text-green-600 dark:text-green-400"},"$",m.finalPrice.toFixed(2)))),r.createElement(h.A,{label:"Nuevo precio base",type:"number",step:"0.01",value:n,onChange:e=>c(parseFloat(e.target.value)),icon:s.A}),0!==d&&r.createElement("div",{className:(0,R.A)("p-3 rounded-lg",d>0?"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300":"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300")},r.createElement("div",{className:"flex items-center gap-2"},d>0?r.createElement(B.A,{className:"w-4 h-4"}):r.createElement(J.A,{className:"w-4 h-4"}),r.createElement("span",{className:"text-sm font-medium"},d>0?"Aumento":"Reducción"," de ",Math.abs(u),"%"))),r.createElement(h.A,{label:"Motivo del cambio",value:i,onChange:e=>o(e.target.value),placeholder:"Ej: Ajuste por costos, promoción especial..."}),r.createElement("div",{className:"flex justify-end gap-2 pt-4"},r.createElement(N.A,{variant:"outline",onClick:a},"Cancelar"),r.createElement(N.A,{variant:"primary",onClick:()=>t(e.id,n,i),icon:v.A},"Guardar precio")))};var ce=({products:e=[],onUpdatePricing:t,customerTiers:a=["regular","silver","gold","platinum"]})=>{const{success:l,error:n,warning:s,info:c}=(0,C.d)(),[o,m]=(0,r.useState)(null),[d,u]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1),[x,E]=(0,r.useState)([]),[v,h]=(0,r.useState)({enabled:!1,rules:[]}),f=[{id:"summer",name:"Verano",months:[12,1,2],multiplier:1.2},{id:"winter",name:"Invierno",months:[6,7,8],multiplier:.9},{id:"spring",name:"Primavera",months:[9,10,11],multiplier:1},{id:"fall",name:"Otoño",months:[3,4,5],multiplier:1}],w=[{id:"lunch",name:"Almuerzo",hours:[12,13,14],multiplier:1.1},{id:"afternoon",name:"Tarde",hours:[16,17,18,19],multiplier:1.15},{id:"night",name:"Noche",hours:[20,21,22],multiplier:1.05}],k=[{minQty:5,discount:5},{minQty:10,discount:10},{minQty:20,discount:15},{minQty:50,discount:20}],z=(e,t=1,a="regular",r=new Date)=>{let l=e.webPrice||e.price,n=l,s=[];const c=r.getMonth()+1,i=f.find((e=>e.months.includes(c)));i&&v.enabled&&(n*=i.multiplier,s.push({type:"season",name:`Temporada ${i.name}`,adjustment:`${(100*(i.multiplier-1)).toFixed(0)}%`}));const o=r.getHours(),m=w.find((e=>e.hours.includes(o)));m&&v.enabled&&(n*=m.multiplier,s.push({type:"peakHour",name:`Horario ${m.name}`,adjustment:`+${(100*(m.multiplier-1)).toFixed(0)}%`}));const d=k.filter((e=>t>=e.minQty)).sort(((e,t)=>t.discount-e.discount))[0];d&&(n-=n*(d.discount/100),s.push({type:"volume",name:`Descuento por volumen (${t} unidades)`,adjustment:`-${d.discount}%`}));const u={regular:0,silver:5,gold:10,platinum:15}[a]||0;return u>0&&(n*=1-u/100,s.push({type:"customerTier",name:`Cliente ${a}`,adjustment:`-${u}%`})),{basePrice:l,finalPrice:Math.round(100*n)/100,discount:l-n,discountPercentage:((l-n)/l*100).toFixed(1),appliedRules:s}};return r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6"},r.createElement("div",{className:"flex items-center justify-between mb-4"},r.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white"},"Gestión de Precios"),r.createElement("div",{className:"flex items-center gap-4"},r.createElement("label",{className:"flex items-center gap-2"},r.createElement("input",{type:"checkbox",checked:v.enabled,onChange:async()=>{try{const e=!v.enabled;h((t=>({...t,enabled:e}))),await fetch("/api/shop/config/dynamic-pricing",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:e})}),e?c("Precios dinámicos activados","Los precios se ajustarán automáticamente"):c("Precios dinámicos desactivados","Se usarán precios fijos")}catch(e){n("Error","No se pudo cambiar la configuración")}},className:"rounded border-gray-300 dark:border-gray-600"}),r.createElement("span",{className:"text-sm text-gray-700 dark:text-gray-300"},"Precios dinámicos")))),v.enabled&&r.createElement("div",{className:"flex flex-wrap gap-2"},r.createElement(A.A,{variant:"info",size:"sm"},r.createElement(ne.A,{className:"w-3 h-3 mr-1"}),"Ajuste por temporada activo"),r.createElement(A.A,{variant:"info",size:"sm"},r.createElement(S.A,{className:"w-3 h-3 mr-1"}),"Ajuste por horario activo"),r.createElement(A.A,{variant:"info",size:"sm"},r.createElement(G.A,{className:"w-3 h-3 mr-1"}),"Descuentos por cliente activos"))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700"},r.createElement("div",{className:"p-6 border-b dark:border-gray-700"},r.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white"},"Precios por Producto")),r.createElement("div",{className:"overflow-x-auto"},r.createElement("table",{className:"w-full"},r.createElement("thead",{className:"bg-gray-50 dark:bg-gray-900"},r.createElement("tr",null,r.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Producto"),r.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Precio Base"),r.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Precio Actual"),r.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Descuentos Activos"),r.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Última Actualización"),r.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Acciones"))),r.createElement("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700"},e.map((e=>{const t=z(e),a=t.finalPrice<t.basePrice;return r.createElement("tr",{key:e.id,className:"hover:bg-gray-50 dark:hover:bg-gray-700/50"},r.createElement("td",{className:"px-6 py-4"},r.createElement("div",null,r.createElement("p",{className:"text-sm font-medium text-gray-900 dark:text-white"},e.name),r.createElement("p",{className:"text-xs text-gray-500 dark:text-gray-400"},"SKU: ",e.sku))),r.createElement("td",{className:"px-6 py-4 text-sm font-medium"},"$",t.basePrice.toFixed(2)),r.createElement("td",{className:"px-6 py-4"},r.createElement("div",{className:"flex items-center gap-2"},r.createElement("span",{className:(0,R.A)("text-sm font-medium",a?"text-green-600 dark:text-green-400":"text-gray-900 dark:text-white")},"$",t.finalPrice.toFixed(2)),a&&r.createElement(A.A,{variant:"success",size:"xs"},"-",t.discountPercentage,"%"))),r.createElement("td",{className:"px-6 py-4"},r.createElement("div",{className:"flex flex-wrap gap-1"},t.appliedRules.slice(0,2).map(((e,t)=>r.createElement(A.A,{key:t,variant:"default",size:"xs"},e.adjustment))),t.appliedRules.length>2&&r.createElement(A.A,{variant:"default",size:"xs"},"+",t.appliedRules.length-2))),r.createElement("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-400"},e.priceUpdatedAt?new Date(e.priceUpdatedAt).toLocaleDateString():"Nunca"),r.createElement("td",{className:"px-6 py-4"},r.createElement("div",{className:"flex items-center gap-2"},r.createElement(N.A,{variant:"ghost",size:"xs",onClick:()=>{m(e),u(!0)},icon:y.A}),r.createElement(N.A,{variant:"ghost",size:"xs",onClick:()=>(async e=>{try{const t=await fetch(`/api/shop/products/${e}/price-history`);if(t.ok){const e=await t.json();E(e.history||[]),g(!0)}}catch(e){n("Error","No se pudo cargar el historial")}})(e.id),icon:i.A}))))})))))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6"},r.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4"},"Descuentos por Volumen"),r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4"},k.map(((e,t)=>r.createElement("div",{key:t,className:"p-4 border dark:border-gray-700 rounded-lg text-center"},r.createElement("div",{className:"text-2xl font-bold text-venezia-600 dark:text-venezia-400"},e.discount,"%"),r.createElement("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1"},e.minQty,"+ unidades")))))),r.createElement(b.A,{isOpen:d,onClose:()=>u(!1),title:"Actualizar Precio"},o&&r.createElement(se,{product:o,onSave:async(e,a,r="")=>{try{const n={productId:e,previousPrice:o.webPrice,newPrice:a,changedAt:(new Date).toISOString(),changedBy:"current_user",reason:r};if(!(await fetch("/api/shop/products/price-history",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).ok)throw new Error("Error al actualizar precio");await t(e,{webPrice:a}),l("Precio actualizado",`Nuevo precio: $${a}`),u(!1)}catch(e){n("Error","No se pudo actualizar el precio")}},onCancel:()=>u(!1),calculateDynamicPrice:z})),r.createElement(b.A,{isOpen:p,onClose:()=>g(!1),title:"Historial de Precios"},r.createElement("div",{className:"space-y-3"},x.map(((e,t)=>r.createElement("div",{key:t,className:"p-3 border dark:border-gray-700 rounded-lg"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm font-medium"},"$",e.previousPrice," → $",e.newPrice),r.createElement("p",{className:"text-xs text-gray-500 dark:text-gray-400"},new Date(e.changedAt).toLocaleString())),r.createElement(A.A,{variant:e.newPrice>e.previousPrice?"danger":"success",size:"sm"},e.newPrice>e.previousPrice?r.createElement(B.A,{className:"w-3 h-3 mr-1"}):r.createElement(J.A,{className:"w-3 h-3 mr-1"}),Math.abs((e.newPrice-e.previousPrice)/e.previousPrice*100).toFixed(1),"%")),e.reason&&r.createElement("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1"},"Motivo: ",e.reason)))))))},ie=a(42021),oe=a(98445),me=a(80827),de=a(8414),ue=a(48309),pe=a(91385),ge=a(65680),xe=a(60367),Ee=a(54687),ye=({orderId:e,onClose:t})=>{const{info:a,success:s,error:c}=(0,C.d)(),[i,o]=(0,r.useState)(null),[m,d]=(0,r.useState)(!0),[p,x]=(0,r.useState)(null),[E,y]=(0,r.useState)(null),[v,b]=(0,r.useState)(!1),[h,f]=(0,r.useState)(0),[w,k]=(0,r.useState)(""),A=[{id:"pending",label:"Pedido Recibido",icon:n.A,description:"Tu pedido ha sido recibido",color:"gray"},{id:"confirmed",label:"Confirmado",icon:u.A,description:"Estamos preparando tu pedido",color:"blue"},{id:"preparing",label:"En Preparación",icon:pe.A,description:"Nuestro chef está preparando tu pedido",color:"orange"},{id:"ready",label:"Listo",icon:l.A,description:"Tu pedido está listo",color:"green"},{id:"delivering",label:"En Camino",icon:z.A,description:"Tu pedido está en camino",color:"blue"},{id:"delivered",label:"Entregado",icon:u.A,description:"Tu pedido ha sido entregado",color:"green"}];(0,r.useEffect)((()=>{S();const e=setInterval((()=>{S()}),1e4);return()=>clearInterval(e)}),[e]);const S=async()=>{try{const t=await fetch(`/api/shop/orders/${e}/tracking`);if(t.ok){const e=await t.json();o(e.order),P(e.order),"delivered"!==e.order.status||e.order.rating||b(!0)}}catch(e){c("Error","No se pudo cargar la información del pedido")}finally{d(!1)}},P=e=>{const t={pending:5,confirmed:25,preparing:15,ready:10,delivering:15};let a=0;for(let r=A.findIndex((t=>t.id===e.status));r<A.length-1;r++)a+=t[A[r].id]||0;x(a)},j=e=>{window.location.href="call"===e?`tel:${i.deliveryPhone}`:`https://wa.me/${i.deliveryPhone}`};if(m)return r.createElement("div",{className:"flex items-center justify-center h-64"},r.createElement("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-venezia-500 border-t-transparent"}));if(!i)return r.createElement("div",{className:"text-center py-12"},r.createElement(D.A,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),r.createElement("p",{className:"text-gray-600 dark:text-gray-400"},"No se encontró la orden"));const O=A.findIndex((e=>e.id===i.status));return r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"text-center"},r.createElement("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2"},"Orden #",i.id),r.createElement("p",{className:"text-gray-600 dark:text-gray-400"},new Date(i.createdAt).toLocaleString())),p&&"delivered"!==i.status&&r.createElement("div",{className:"bg-venezia-50 dark:bg-venezia-900/20 rounded-lg p-6 text-center"},r.createElement(ge.A,{className:"w-8 h-8 text-venezia-600 dark:text-venezia-400 mx-auto mb-2"}),r.createElement("p",{className:"text-lg font-semibold text-venezia-900 dark:text-venezia-100"},"Tiempo estimado: ",p," minutos"),r.createElement("p",{className:"text-sm text-venezia-600 dark:text-venezia-400 mt-1"},"Tu pedido llegará aproximadamente a las ",new Date(Date.now()+6e4*p).toLocaleTimeString("es",{hour:"2-digit",minute:"2-digit"}))),r.createElement("div",{className:"relative"},A.map(((e,t)=>{const a=t<=O,l=t===O,n=e.icon;return r.createElement("div",{key:e.id,className:"flex items-start mb-8 last:mb-0"},t<A.length-1&&r.createElement("div",{className:(0,R.A)("absolute left-6 top-12 w-0.5 h-16",a?"bg-venezia-500":"bg-gray-300 dark:bg-gray-600")}),r.createElement("div",{className:(0,R.A)("relative z-10 flex items-center justify-center w-12 h-12 rounded-full",a?"bg-venezia-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-500")},r.createElement(n,{className:"w-6 h-6"}),l&&r.createElement("div",{className:"absolute -inset-1 rounded-full border-2 border-venezia-500 animate-pulse"})),r.createElement("div",{className:"ml-4 flex-1"},r.createElement("h4",{className:(0,R.A)("font-semibold",a?"text-gray-900 dark:text-white":"text-gray-500 dark:text-gray-400")},e.label),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1"},e.description),l&&"preparing"===e.id&&r.createElement("div",{className:"mt-2"},r.createElement("div",{className:"flex items-center gap-2 text-sm text-orange-600 dark:text-orange-400"},r.createElement("div",{className:"animate-pulse"},r.createElement("div",{className:"h-2 w-2 bg-orange-500 rounded-full"})),"En proceso..."))))}))),"delivering"===i.status&&r.createElement("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6"},r.createElement("div",{className:"flex items-center justify-between mb-4"},r.createElement("div",null,r.createElement("h4",{className:"font-semibold text-blue-900 dark:text-blue-100"},"Tu pedido está en camino"),r.createElement("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1"},"Repartidor: ",i.deliveryPerson)),r.createElement(z.A,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})),r.createElement("div",{className:"flex gap-3"},r.createElement(N.A,{variant:"outline",size:"sm",onClick:()=>(async()=>{try{const t=await fetch(`/api/shop/orders/${e}/location`);if(t.ok){const e=await t.json();y(e.location),a("Ubicación actualizada","La ubicación del repartidor se ha actualizado")}}catch(e){c("Error","No se pudo obtener la ubicación")}})(),icon:xe.A},"Ver ubicación"),r.createElement(N.A,{variant:"outline",size:"sm",onClick:()=>j("call"),icon:L.A},"Llamar"),r.createElement(N.A,{variant:"outline",size:"sm",onClick:()=>j("whatsapp"),icon:Ee.A},"WhatsApp"))),E&&r.createElement("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg p-4"},r.createElement("div",{className:"flex items-center gap-2 mb-2"},r.createElement(M.A,{className:"w-5 h-5 text-red-500"}),r.createElement("span",{className:"text-sm font-medium"},"Ubicación del repartidor")),r.createElement("div",{className:"h-48 bg-gray-200 dark:bg-gray-700 rounded flex items-center justify-center"},r.createElement("p",{className:"text-gray-500 dark:text-gray-400"},"Mapa en tiempo real"))),v&&r.createElement("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-6"},r.createElement("h4",{className:"font-semibold text-gray-900 dark:text-white mb-4"},"¿Cómo fue tu experiencia?"),r.createElement("div",{className:"flex justify-center gap-2 mb-4"},[1,2,3,4,5].map((e=>r.createElement("button",{key:e,onClick:()=>f(e),className:"focus:outline-none"},r.createElement(g.A,{className:(0,R.A)("w-8 h-8 transition-colors",e<=h?"text-yellow-500 fill-current":"text-gray-300 dark:text-gray-600")}))))),r.createElement("textarea",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg  bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-venezia-500",rows:"3",placeholder:"Cuéntanos más sobre tu experiencia (opcional)",value:w,onChange:e=>k(e.target.value)}),r.createElement("div",{className:"flex justify-end gap-3 mt-4"},r.createElement(N.A,{variant:"outline",onClick:()=>b(!1)},"Más tarde"),r.createElement(N.A,{variant:"primary",onClick:async()=>{try{(await fetch(`/api/shop/orders/${e}/rating`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rating:h,comment:w})})).ok&&(s("Gracias por tu calificación","Tu opinión nos ayuda a mejorar"),b(!1))}catch(e){c("Error","No se pudo enviar la calificación")}},disabled:0===h},"Enviar calificación"))),r.createElement("div",{className:"border-t dark:border-gray-700 pt-6"},r.createElement("h4",{className:"font-semibold text-gray-900 dark:text-white mb-3"},"Resumen del pedido"),r.createElement("div",{className:"space-y-2"},i.items?.map(((e,t)=>r.createElement("div",{key:t,className:"flex justify-between text-sm"},r.createElement("span",{className:"text-gray-600 dark:text-gray-400"},e.quantity,"x ",e.productName),r.createElement("span",{className:"font-medium"},"$",(e.price*e.quantity).toFixed(2))))),r.createElement("div",{className:"border-t dark:border-gray-700 pt-2 mt-2"},r.createElement("div",{className:"flex justify-between font-semibold"},r.createElement("span",null,"Total"),r.createElement("span",null,"$",i.total?.toFixed(2)))))))},ve=({customerId:e})=>{const{success:t,error:a,info:s}=(0,C.d)(),[c,i]=(0,r.useState)([]),[o,m]=(0,r.useState)(!0),[d,u]=(0,r.useState)(null),[p,x]=(0,r.useState)(!1),[E,y]=(0,r.useState)(!1),[v,w]=(0,r.useState)(""),[k,z]=(0,r.useState)("all"),[P,D]=(0,r.useState)("all"),[j,O]=(0,r.useState)("date_desc"),[T,$]=(0,r.useState)({totalOrders:0,totalSpent:0,averageOrder:0,favoriteProduct:null,lastOrderDays:0});(0,r.useEffect)((()=>{I()}),[e]);const I=async()=>{try{const t=await fetch(`/api/shop/customers/${e}/orders`);if(t.ok){const e=await t.json();i(e.orders||[]),F(e.orders||[])}}catch(e){a("Error","No se pudo cargar el historial de pedidos")}finally{m(!1)}},F=e=>{if(0===e.length)return;const t=e.filter((e=>"delivered"===e.status||"completed"===e.status)),a=t.reduce(((e,t)=>e+(t.total||0)),0),r=a/(t.length||1),l={};e.forEach((e=>{e.items?.forEach((e=>{l[e.productName]=(l[e.productName]||0)+e.quantity}))}));const n=Object.entries(l).sort((([,e],[,t])=>t-e))[0]?.[0]||null,s=e.sort(((e,t)=>new Date(t.createdAt)-new Date(e.createdAt)))[0],c=s?Math.floor((Date.now()-new Date(s.createdAt))/864e5):null;$({totalOrders:e.length,totalSpent:a,averageOrder:r,favoriteProduct:n,lastOrderDays:c})},L=c.filter((e=>{const t=!v||e.id.toString().includes(v)||e.items?.some((e=>e.productName.toLowerCase().includes(v.toLowerCase()))),a="all"===k||e.status===k;let r=!0;if("all"!==P){const t=new Date(e.createdAt),a=new Date;switch(P){case"today":r=t.toDateString()===a.toDateString();break;case"week":r=t>=new Date(a.setDate(a.getDate()-7));break;case"month":r=t>=new Date(a.setMonth(a.getMonth()-1))}}return t&&a&&r})).sort(((e,t)=>{switch(j){case"date_desc":return new Date(t.createdAt)-new Date(e.createdAt);case"date_asc":return new Date(e.createdAt)-new Date(t.createdAt);case"amount_desc":return(t.total||0)-(e.total||0);case"amount_asc":return(e.total||0)-(t.total||0);default:return 0}})),M={pending:"yellow",confirmed:"blue",preparing:"orange",ready:"green",delivering:"blue",delivered:"green",cancelled:"red"},U={pending:"Pendiente",confirmed:"Confirmado",preparing:"Preparando",ready:"Listo",delivering:"En camino",delivered:"Entregado",cancelled:"Cancelado"};return o?r.createElement("div",{className:"flex items-center justify-center h-64"},r.createElement("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-venezia-500 border-t-transparent"})):r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4"},r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-4"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Total de Pedidos"),r.createElement("p",{className:"text-2xl font-bold text-gray-900 dark:text-white"},T.totalOrders)),r.createElement(n.A,{className:"w-8 h-8 text-gray-400"}))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-4"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Total Gastado"),r.createElement("p",{className:"text-2xl font-bold text-gray-900 dark:text-white"},"$",T.totalSpent.toFixed(2))),r.createElement(B.A,{className:"w-8 h-8 text-green-500"}))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-4"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Pedido Promedio"),r.createElement("p",{className:"text-2xl font-bold text-gray-900 dark:text-white"},"$",T.averageOrder.toFixed(2))),r.createElement(ie.A,{className:"w-8 h-8 text-blue-500"}))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-4"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Producto Favorito"),r.createElement("p",{className:"text-sm font-semibold text-gray-900 dark:text-white truncate"},T.favoriteProduct||"N/A")),r.createElement(g.A,{className:"w-8 h-8 text-yellow-500"})))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-4"},r.createElement("div",{className:"flex flex-col lg:flex-row gap-4"},r.createElement("div",{className:"flex-1"},r.createElement(h.A,{placeholder:"Buscar por número de orden o producto...",value:v,onChange:e=>w(e.target.value),icon:oe.A})),r.createElement(f.A,{value:k,onChange:e=>z(e.target.value),className:"w-full lg:w-48"},r.createElement("option",{value:"all"},"Todos los estados"),r.createElement("option",{value:"delivered"},"Entregados"),r.createElement("option",{value:"pending"},"Pendientes"),r.createElement("option",{value:"cancelled"},"Cancelados")),r.createElement(f.A,{value:P,onChange:e=>D(e.target.value),className:"w-full lg:w-48"},r.createElement("option",{value:"all"},"Todas las fechas"),r.createElement("option",{value:"today"},"Hoy"),r.createElement("option",{value:"week"},"Última semana"),r.createElement("option",{value:"month"},"Último mes")),r.createElement(f.A,{value:j,onChange:e=>O(e.target.value),className:"w-full lg:w-48"},r.createElement("option",{value:"date_desc"},"Más recientes"),r.createElement("option",{value:"date_asc"},"Más antiguos"),r.createElement("option",{value:"amount_desc"},"Mayor monto"),r.createElement("option",{value:"amount_asc"},"Menor monto")))),0===L.length?r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-12 text-center"},r.createElement(n.A,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),r.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2"},"No se encontraron pedidos"),r.createElement("p",{className:"text-gray-500 dark:text-gray-400"},v||"all"!==k||"all"!==P?"Intenta ajustar los filtros":"Aún no has realizado ningún pedido")):r.createElement("div",{className:"space-y-4"},L.map((e=>r.createElement("div",{key:e.id,className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6"},r.createElement("div",{className:"flex items-start justify-between mb-4"},r.createElement("div",null,r.createElement("div",{className:"flex items-center gap-3 mb-2"},r.createElement("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white"},"Orden #",e.id),r.createElement(A.A,{variant:M[e.status]||"default",size:"sm"},U[e.status]||e.status)),r.createElement("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400"},r.createElement("span",{className:"flex items-center gap-1"},r.createElement(ne.A,{className:"w-4 h-4"}),new Date(e.createdAt).toLocaleDateString()),r.createElement("span",{className:"flex items-center gap-1"},r.createElement(S.A,{className:"w-4 h-4"}),new Date(e.createdAt).toLocaleTimeString()))),r.createElement("p",{className:"text-xl font-bold text-gray-900 dark:text-white"},"$",e.total?.toFixed(2))),r.createElement("div",{className:"border-t dark:border-gray-700 pt-4 mb-4"},r.createElement("div",{className:"space-y-2"},e.items?.slice(0,3).map(((e,t)=>r.createElement("div",{key:t,className:"flex justify-between text-sm"},r.createElement("span",{className:"text-gray-600 dark:text-gray-400"},e.quantity,"x ",e.productName),r.createElement("span",{className:"font-medium"},"$",(e.price*e.quantity).toFixed(2))))),e.items?.length>3&&r.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400"},"+",e.items.length-3," productos más"))),e.rating&&r.createElement("div",{className:"flex items-center gap-2 mb-4"},r.createElement("div",{className:"flex"},[1,2,3,4,5].map((t=>r.createElement(g.A,{key:t,className:(0,R.A)("w-4 h-4",t<=e.rating?"text-yellow-500 fill-current":"text-gray-300 dark:text-gray-600")})))),e.ratingComment&&r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400 italic"},'"',e.ratingComment,'"')),r.createElement("div",{className:"flex flex-wrap gap-2"},r.createElement(N.A,{variant:"outline",size:"sm",onClick:()=>{u(e),y(!0)},icon:me.A},"Ver detalles"),("pending"===e.status||"confirmed"===e.status||"preparing"===e.status||"delivering"===e.status)&&r.createElement(N.A,{variant:"outline",size:"sm",onClick:()=>{u(e),x(!0)},icon:l.A},"Seguir pedido"),"delivered"===e.status&&r.createElement(r.Fragment,null,r.createElement(N.A,{variant:"outline",size:"sm",onClick:()=>(async e=>{try{const a=await fetch("/api/shop/orders/repeat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e.id,items:e.items})});a.ok&&(await a.json(),t("Pedido agregado al carrito","Los productos se agregaron a tu carrito"),window.location.pathname.includes("webshop")&&(window.location.href="/webshop/cart"))}catch(e){a("Error","No se pudo repetir el pedido")}})(e),icon:de.A},"Repetir pedido"),r.createElement(N.A,{variant:"outline",size:"sm",onClick:()=>(async e=>{try{const t=await fetch(`/api/shop/orders/${e}/invoice`);if(t.ok){const a=await t.blob(),r=window.URL.createObjectURL(a),l=document.createElement("a");l.href=r,l.download=`factura-${e}.pdf`,l.click(),window.URL.revokeObjectURL(r),s("Factura descargada","La factura se descargó correctamente")}}catch(e){a("Error","No se pudo descargar la factura")}})(e.id),icon:ue.A},"Factura"))))))),r.createElement(b.A,{isOpen:p,onClose:()=>{x(!1),u(null)},title:"Seguimiento de Pedido",size:"lg"},d&&r.createElement(ye,{orderId:d.id,onClose:()=>x(!1)})),r.createElement(b.A,{isOpen:E,onClose:()=>{y(!1),u(null)},title:`Detalles de Orden #${d?.id}`},d&&r.createElement("div",{className:"space-y-4"},r.createElement("div",{className:"grid grid-cols-2 gap-4"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Estado"),r.createElement(A.A,{variant:M[d.status]||"default"},U[d.status]||d.status)),r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Fecha"),r.createElement("p",{className:"font-medium"},new Date(d.createdAt).toLocaleString()))),r.createElement("div",{className:"border-t dark:border-gray-700 pt-4"},r.createElement("h4",{className:"font-medium mb-2"},"Productos"),r.createElement("div",{className:"space-y-2"},d.items?.map(((e,t)=>r.createElement("div",{key:t,className:"flex justify-between text-sm"},r.createElement("span",null,e.quantity,"x ",e.productName),r.createElement("span",{className:"font-medium"},"$",(e.price*e.quantity).toFixed(2))))))),r.createElement("div",{className:"border-t dark:border-gray-700 pt-4"},r.createElement("div",{className:"flex justify-between"},r.createElement("span",{className:"font-medium"},"Total"),r.createElement("span",{className:"text-lg font-bold"},"$",d.total?.toFixed(2)))),d.deliveryAddress&&r.createElement("div",{className:"border-t dark:border-gray-700 pt-4"},r.createElement("h4",{className:"font-medium mb-2"},"Dirección de entrega"),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},d.deliveryAddress)))))},be=()=>{const{success:e,error:t,warning:a}=(0,C.d)(),[A,S]=(0,r.useState)("products"),[z,P]=(0,r.useState)(!0),[D,j]=(0,r.useState)([]),[O,T]=(0,r.useState)([]),[$,I]=(0,r.useState)({}),[F,L]=(0,r.useState)([]),[M,U]=(0,r.useState)(!1),[R,q]=(0,r.useState)(!1),[_,V]=(0,r.useState)(!1),[B,G]=(0,r.useState)(null),[J,Q]=(0,r.useState)(null),[Z,Y]=(0,r.useState)({productId:"",webPrice:"",webDescription:"",webImages:[],isActive:!0,isFeatured:!1}),[X,K]=(0,r.useState)(!1),[ee,te]=(0,r.useState)({}),[ae,re]=(0,r.useState)(!1),{syncStatus:ne,stockAlerts:se,syncInventory:ie,getAvailableStock:oe,checkStockLevels:me}=((e=[],t=[])=>{const{warning:a,info:l,error:n}=(0,C.d)(),[s,c]=(0,r.useState)("idle"),[i,o]=(0,r.useState)(null),[m,d]=(0,r.useState)([]),[u,p]=(0,r.useState)({}),g=(0,r.useCallback)((()=>{const r=[];return t.forEach((t=>{const a=e.find((e=>e.id===t.productId));if(!a)return;const l=a.stock-(u[a.id]||0);l<=0?r.push({productId:a.id,productName:a.name,level:"outOfStock",message:`${a.name} está agotado`,availableStock:0}):l<=5?r.push({productId:a.id,productName:a.name,level:"critical",message:`${a.name} tiene stock crítico (${l} unidades)`,availableStock:l}):l<=10&&r.push({productId:a.id,productName:a.name,level:"low",message:`${a.name} tiene stock bajo (${l} unidades)`,availableStock:l})})),d(r),r.forEach((e=>{"outOfStock"===e.level?n("Stock Agotado",e.message):"critical"===e.level&&a("Stock Crítico",e.message)})),r}),[t,e,u,n,a]),x=(0,r.useCallback)((async()=>{c("syncing");try{const a=[];for(const r of t){const t=e.find((e=>e.id===r.productId));if(!t)continue;const l=t.stock-(u[t.id]||0);r.availableStock!==l&&a.push({productId:r.id,availableStock:l,autoDisable:l<=0})}if(a.length>0){if(!(await fetch("/api/shop/products/sync-stock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({updates:a})})).ok)throw new Error("Error al sincronizar inventario");l("Inventario Sincronizado",`${a.length} productos actualizados`),o(new Date)}g(),c("success")}catch(e){n("Error de Sincronización","No se pudo sincronizar el inventario"),c("error")}}),[t,e,u,g,l,n]),E=(0,r.useCallback)(((e,t)=>{const a={...u};t.forEach((t=>{a[t.productId]||(a[t.productId]={}),a[t.productId][e]=t.quantity})),p(a),fetch("/api/shop/stock/reserve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e,items:t})})}),[u]),y=(0,r.useCallback)((e=>{const t={...u};Object.keys(t).forEach((a=>{t[a][e]&&delete t[a][e]})),p(t),fetch("/api/shop/stock/release",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e})})}),[u]);(0,r.useEffect)((()=>{const e=setInterval((()=>{x()}),3e5);return x(),()=>clearInterval(e)}),[x]);const v=(0,r.useCallback)((t=>{const a=e.find((e=>e.id===t));if(!a)return 0;const r=Object.values(u[t]||{}).reduce(((e,t)=>e+t),0);return Math.max(0,a.stock-r)}),[e,u]),b=(0,r.useCallback)(((e,t=[])=>{const a=v(e);if(0===a)return{days:0,date:new Date};const r=t.slice(-7),l=r.length>0?r.reduce(((e,t)=>e+t.quantity),0)/r.length:0;if(0===l)return{days:1/0,date:null};const n=Math.floor(a/l),s=new Date;return s.setDate(s.getDate()+n),{days:n,date:s}}),[v]);return{syncStatus:s,lastSync:i,stockAlerts:m,syncInventory:x,reserveStock:E,releaseStock:y,getAvailableStock:v,predictStockout:b,checkStockLevels:g,reservedStock:u}})(F,D);(0,r.useEffect)((()=>{de()}),[]);const de=async()=>{try{P(!0);const[e,t,a,r]=await Promise.all([fetch("/api/shop/products"),fetch("/api/shop/orders"),fetch("/api/shop/config"),fetch("/api/products")]),l=e.ok?await e.json():{products:[]},n=t.ok?await t.json():{orders:[]},s=a.ok?await a.json():{config:{}},c=r.ok?await r.json():[];j(Array.isArray(l.products)?l.products:[]),T(Array.isArray(n.orders)?n.orders:[]),I(s.config||{}),te(s.config||{}),L(Array.isArray(c)?c:[])}catch(e){t("Error al cargar datos","No se pudieron cargar los datos de la tienda"),j([]),T([]),I({}),te({}),L([])}finally{P(!1)}},ue=async(a,r)=>{try{if(!(await fetch(`/api/shop/orders/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok)throw new Error("Error al actualizar");e("Estado actualizado","La orden ha sido actualizada correctamente"),de()}catch(e){t("Error","No se pudo actualizar el estado de la orden")}},pe=(e,t)=>{te((a=>({...a,[e]:t}))),re(!0)},ge={totalProducts:D.length,activeProducts:D.filter((e=>e.isActive)).length,pendingOrders:O.filter((e=>"pending"===e.status)).length,totalRevenue:O.filter((e=>"completed"===e.status)).reduce(((e,t)=>e+(t.total||0)),0)},xe=[{id:"products",label:"Productos Web",icon:l.A},{id:"orders",label:"Órdenes Online",icon:n.A},{id:"pricing",label:"Precios",icon:s.A},{id:"coupons",label:"Cupones",icon:c.A},{id:"history",label:"Historial",icon:i.A},{id:"analytics",label:"Analytics",icon:o.A},{id:"config",label:"Configuración",icon:m.A}];return z?r.createElement("div",{className:"flex items-center justify-center h-64"},r.createElement(w.A,{size:"lg"})):r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("h1",{className:"text-3xl font-bold text-venezia-900"},"Tienda Online"),r.createElement("p",{className:"text-venezia-600 mt-1"},"E-commerce y gestión web")),r.createElement("div",{className:"flex space-x-3"},r.createElement(N.A,{variant:"outline",onClick:()=>window.open("/webshop","_blank"),className:"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100"},r.createElement(d.A,{className:"h-5 w-5 mr-2"}),"Ver Tienda Web"),r.createElement(N.A,{onClick:()=>U(!0)},r.createElement(l.A,{className:"h-5 w-5 mr-2"}),"Agregar Producto"))),se.length>0&&r.createElement("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4"},r.createElement("h3",{className:"font-medium text-yellow-900 dark:text-yellow-100 mb-2"},"Alertas de Inventario"),r.createElement("div",{className:"space-y-1"},se.slice(0,3).map(((e,t)=>r.createElement("p",{key:t,className:"text-sm text-yellow-700 dark:text-yellow-300"},"• ",e.message))),se.length>3&&r.createElement("p",{className:"text-sm text-yellow-600 dark:text-yellow-400"},"+",se.length-3," alertas más"))),r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6"},r.createElement("div",{className:"card p-6"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm font-medium text-venezia-600"},"Productos Totales"),r.createElement("p",{className:"text-2xl font-bold text-venezia-900"},ge.totalProducts)),r.createElement(l.A,{className:"h-8 w-8 text-venezia-600"}))),r.createElement("div",{className:"card p-6"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm font-medium text-venezia-600"},"Productos Activos"),r.createElement("p",{className:"text-2xl font-bold text-green-600"},ge.activeProducts)),r.createElement(u.A,{className:"h-8 w-8 text-green-600"}))),r.createElement("div",{className:"card p-6"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm font-medium text-venezia-600"},"Órdenes Pendientes"),r.createElement("p",{className:"text-2xl font-bold text-yellow-600"},ge.pendingOrders)),r.createElement(n.A,{className:"h-8 w-8 text-yellow-600"}))),r.createElement("div",{className:"card p-6"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm font-medium text-venezia-600"},"Ingresos Web"),r.createElement("p",{className:"text-2xl font-bold text-blue-600"},"$",ge.totalRevenue.toFixed(2))),r.createElement(p.A,{className:"h-8 w-8 text-blue-600"})))),r.createElement("div",{className:"border-b border-venezia-200"},r.createElement("nav",{className:"-mb-px flex space-x-8"},xe.map((e=>{const t=e.icon;return r.createElement("button",{key:e.id,onClick:()=>S(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+(A===e.id?"border-venezia-500 text-venezia-600":"border-transparent text-venezia-500 hover:text-venezia-700 hover:border-venezia-300")},r.createElement(t,{className:"h-5 w-5"}),r.createElement("span",null,e.label))})))),"products"===A&&r.createElement("div",{className:"card"},r.createElement("div",{className:"px-6 py-4 border-b border-venezia-200"},r.createElement("h3",{className:"text-lg font-semibold text-venezia-900"},"Productos en Tienda Web")),r.createElement("div",{className:"overflow-x-auto"},r.createElement("table",{className:"min-w-full divide-y divide-venezia-200"},r.createElement("thead",{className:"bg-venezia-50"},r.createElement("tr",null,r.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-venezia-500 uppercase"},"Producto"),r.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-venezia-500 uppercase"},"Precio Web"),r.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-venezia-500 uppercase"},"Estado"),r.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-venezia-500 uppercase"},"Destacado"),r.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-venezia-500 uppercase"},"Acciones"))),r.createElement("tbody",{className:"bg-white divide-y divide-venezia-200"},0===D.length?r.createElement("tr",null,r.createElement("td",{colSpan:"5",className:"px-6 py-12 text-center"},r.createElement("div",{className:"flex flex-col items-center"},r.createElement(l.A,{className:"h-12 w-12 text-gray-400 dark:text-gray-500 mb-4"}),r.createElement("h3",{className:"text-lg font-medium text-gray-900 mb-2"},"No hay productos en la tienda web"),r.createElement("p",{className:"text-gray-500 dark:text-gray-400 mb-4"},"Comienza agregando productos desde tu inventario"),r.createElement(N.A,{onClick:()=>U(!0),variant:"primary"},r.createElement(l.A,{className:"h-4 w-4 mr-2"}),"Agregar Primer Producto")))):D.map((a=>r.createElement("tr",{key:a.id,className:"hover:bg-venezia-50"},r.createElement("td",{className:"px-6 py-4 whitespace-nowrap"},r.createElement("div",{className:"flex items-center"},r.createElement("div",{className:"flex-shrink-0"},r.createElement(k.A,{productName:a.product?.name||a.name,size:"default"})),r.createElement("div",{className:"ml-4"},r.createElement("div",{className:"text-sm font-medium text-venezia-900"},a.product?.name||a.name),r.createElement("div",{className:"text-sm text-venezia-500"},a.product?.category||a.category)))),r.createElement("td",{className:"px-6 py-4 whitespace-nowrap"},r.createElement("div",{className:"text-sm text-venezia-900"},"$",a.webPrice?.toFixed(2)||a.price?.toFixed(2))),r.createElement("td",{className:"px-6 py-4 whitespace-nowrap"},r.createElement("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(a.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800")},a.isActive?"Activo":"Inactivo")),r.createElement("td",{className:"px-6 py-4 whitespace-nowrap"},a.isFeatured&&r.createElement(g.A,{className:"h-5 w-5 text-yellow-500 fill-current"})),r.createElement("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium"},r.createElement("div",{className:"flex space-x-2"},r.createElement(N.A,{variant:"ghost",size:"sm",onClick:()=>(async(a,r)=>{try{(await fetch(`/api/shop/products/${a}/toggle`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!r})})).ok?(e("Estado actualizado",`Producto ${r?"desactivado":"activado"} en la tienda web`),de()):t("Error","No se pudo actualizar el estado del producto")}catch(e){t("Error","No se pudo actualizar el estado del producto")}})(a.id,a.isActive)},a.isActive?r.createElement(x.A,{className:"h-4 w-4 text-green-600"}):r.createElement(E.A,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})),r.createElement(N.A,{variant:"ghost",size:"sm",onClick:()=>{G(a),Y({productId:a.productId,webPrice:a.webPrice||a.price,webDescription:a.webDescription||"",webImages:a.webImages||[],isActive:a.isActive,isFeatured:a.isFeatured||!1}),U(!0)}},r.createElement(y.A,{className:"h-4 w-4"}))))))))))),"orders"===A&&r.createElement(H,{orders:O,onUpdateOrder:ue,onRefresh:de}),"pricing"===A&&r.createElement(ce,{products:D,onUpdatePricing:async(e,t)=>{await fetch(`/api/shop/products/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),de()}}),"coupons"===A&&r.createElement(le,{onCouponChange:de}),"history"===A&&r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6"},r.createElement("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"Historial de Órdenes"),r.createElement(ve,{customerId:"shop"})),"config"===A&&r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"card p-6"},r.createElement("div",{className:"flex justify-between items-center mb-4"},r.createElement("h3",{className:"text-lg font-semibold text-venezia-900"},"Configuración de Tienda"),r.createElement("div",{className:"flex items-center space-x-3"},ae&&r.createElement("div",{className:"flex items-center text-sm text-orange-600"},r.createElement("div",{className:"h-2 w-2 bg-orange-500 rounded-full mr-2"}),"Cambios sin guardar"),ae&&r.createElement(N.A,{onClick:async()=>{try{(await fetch("/api/shop/config",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(ee)})).ok?(e("Configuración guardada","La configuración de la tienda se actualizó correctamente"),I(ee),re(!1)):t("Error","No se pudo guardar la configuración")}catch(e){t("Error","Error al guardar la configuración")}},variant:"primary",size:"sm"},r.createElement(v.A,{className:"h-4 w-4 mr-2"}),"Guardar Cambios"))),r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6"},r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-venezia-700 mb-2"},"Nombre de la Tienda"),r.createElement(h.A,{value:ee.storeName||"",onChange:e=>pe("storeName",e.target.value),placeholder:"Venezia Gelato"})),r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-venezia-700 mb-2"},"Email de Contacto"),r.createElement(h.A,{value:ee.storeEmail||"",onChange:e=>pe("storeEmail",e.target.value),placeholder:"info@veneziagelato.com"})),r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-venezia-700 mb-2"},"Teléfono"),r.createElement(h.A,{value:ee.storePhone||"",onChange:e=>pe("storePhone",e.target.value),placeholder:"+54 11 1234-5678"})),r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-venezia-700 mb-2"},"Dirección"),r.createElement(h.A,{value:ee.storeAddress||"",onChange:e=>pe("storeAddress",e.target.value),placeholder:"Av. Corrientes 1234, CABA"})))),r.createElement("div",{className:"card p-6"},r.createElement("h3",{className:"text-lg font-semibold text-venezia-900 mb-4"},"Configuración de Delivery"),r.createElement("div",{className:"space-y-4"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"font-medium text-venezia-900"},"Delivery Habilitado"),r.createElement("p",{className:"text-sm text-venezia-500"},"Permitir entregas a domicilio")),r.createElement("button",{onClick:()=>pe("deliveryEnabled",!ee.deliveryEnabled),className:"p-1"},ee.deliveryEnabled?r.createElement(x.A,{className:"h-6 w-6 text-green-600"}):r.createElement(E.A,{className:"h-6 w-6 text-gray-400 dark:text-gray-500"}))),r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6"},r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-venezia-700 mb-2"},"Costo de Delivery"),r.createElement(h.A,{type:"number",value:ee.deliveryFee||"",onChange:e=>pe("deliveryFee",e.target.value),placeholder:"200"})),r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-venezia-700 mb-2"},"Pedido Mínimo"),r.createElement(h.A,{type:"number",value:ee.minimumOrderAmount||"",onChange:e=>pe("minimumOrderAmount",e.target.value),placeholder:"1500"})))))),"analytics"===A&&r.createElement(W,{orders:O,products:D,customers:[]}),r.createElement(b.A,{isOpen:M,onClose:()=>{U(!1),G(null),Y({productId:"",webPrice:"",webDescription:"",webImages:[],isActive:!0,isFeatured:!1})},title:B?"Editar Producto Web":"Agregar Producto a Tienda Web"},r.createElement("div",{className:"space-y-4"},r.createElement(f.A,{label:"Producto",value:Z.productId,onChange:e=>Y({...Z,productId:e.target.value}),required:!0,disabled:!!B},r.createElement("option",{value:""},"Seleccionar producto..."),F.map((e=>r.createElement("option",{key:e.id,value:e.id},e.name)))),r.createElement(h.A,{label:"Precio Web",type:"number",value:Z.webPrice,onChange:e=>Y({...Z,webPrice:e.target.value}),placeholder:"0.00",min:"0",step:"0.01",required:!0}),r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-venezia-700 mb-2"},"Descripción Web"),r.createElement("textarea",{className:"w-full px-3 py-2 border border-venezia-300 rounded-md focus:outline-none focus:ring-2 focus:ring-venezia-500",rows:"3",value:Z.webDescription,onChange:e=>Y({...Z,webDescription:e.target.value}),placeholder:"Descripción especial para la tienda web..."})),r.createElement("div",{className:"flex items-center space-x-6"},r.createElement("div",{className:"flex items-center"},r.createElement("input",{type:"checkbox",id:"isActive",checked:Z.isActive,onChange:e=>Y({...Z,isActive:e.target.checked}),className:"h-4 w-4 text-venezia-600 focus:ring-venezia-500 border-venezia-300 rounded"}),r.createElement("label",{htmlFor:"isActive",className:"ml-2 block text-sm text-venezia-900"},"Producto Activo")),r.createElement("div",{className:"flex items-center"},r.createElement("input",{type:"checkbox",id:"isFeatured",checked:Z.isFeatured,onChange:e=>Y({...Z,isFeatured:e.target.checked}),className:"h-4 w-4 text-venezia-600 focus:ring-venezia-500 border-venezia-300 rounded"}),r.createElement("label",{htmlFor:"isFeatured",className:"ml-2 block text-sm text-venezia-900"},"Producto Destacado"))),r.createElement("div",{className:"flex justify-end space-x-3 pt-4"},r.createElement(N.A,{variant:"outline",onClick:()=>{U(!1),G(null)}},"Cancelar"),r.createElement(N.A,{onClick:async()=>{if(!X){K(!0);try{const a=B?"PUT":"POST",r=B?`/api/shop/products/${B.id}`:"/api/shop/products",l=await fetch(r,{method:a,headers:{"Content-Type":"application/json"},body:JSON.stringify(Z)});if(l.ok)e("Producto guardado",B?"Producto actualizado correctamente":"Producto agregado a la tienda web"),U(!1),de(),Y({productId:"",webPrice:"",webDescription:"",webImages:[],isActive:!0,isFeatured:!1}),G(null);else{const e=await l.json();t("Error al guardar",e.error||"No se pudo guardar el producto")}}catch(e){t("Error de conexión","No se pudo conectar con el servidor")}finally{K(!1)}}},disabled:X},X?r.createElement(r.Fragment,null,r.createElement(w.A,{size:"sm",className:"mr-2"}),"Guardando..."):(B?"Actualizar":"Agregar")+" Producto")))),r.createElement(b.A,{isOpen:_,onClose:()=>{V(!1),Q(null)},title:"Detalles de Orden"},J&&r.createElement("div",{className:"space-y-4"},r.createElement("div",{className:"grid grid-cols-2 gap-4"},r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-venezia-700"},"Orden #"),r.createElement("p",{className:"mt-1 text-sm text-venezia-900"},J.id)),r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-venezia-700"},"Estado Actual"),r.createElement(f.A,{value:J.status,onChange:e=>ue(J.id,e.target.value),className:"mt-1"},[{value:"pending",label:"Pendiente",color:"yellow"},{value:"confirmed",label:"Confirmada",color:"blue"},{value:"preparing",label:"Preparando",color:"orange"},{value:"ready",label:"Lista",color:"green"},{value:"delivered",label:"Entregada",color:"green"},{value:"cancelled",label:"Cancelada",color:"red"}].map((e=>r.createElement("option",{key:e.value,value:e.value},e.label)))))),r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-venezia-700"},"Cliente"),r.createElement("p",{className:"mt-1 text-sm text-venezia-900"},J.customerName),r.createElement("p",{className:"text-sm text-venezia-500"},J.customerEmail)),r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-venezia-700"},"Total"),r.createElement("p",{className:"mt-1 text-lg font-semibold text-venezia-900"},"$",J.total?.toFixed(2))),r.createElement("div",{className:"flex justify-end space-x-3 pt-4"},r.createElement(N.A,{variant:"outline",onClick:()=>V(!1)},"Cerrar")))))}}}]);