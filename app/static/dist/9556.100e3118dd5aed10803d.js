"use strict";(self.webpackChunkvenezia_frontend=self.webpackChunkvenezia_frontend||[]).push([[9556],{49556:function(e,t,a){a.r(t);var r=a(96540),n=a(47767),l=a(76316),s=a(71429),c=a(98645),m=a(17133),i=a(3160),d=a(48309),o=a(80697),u=a(27235),g=a(418),x=a(20085),E=a(70700),y=a(42203),p=a(93823),v=a(72284),N=a(11562),b=a(71428),f=a(28219),k=a(67773),w=a(20053);const h=({transaction:e,onView:t})=>{const{date:a,time:n}=(e=>{const t=new Date(e);return{date:t.toLocaleDateString("es-ES"),time:t.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})}})(e.created_at);return r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 space-y-4 hover:shadow-md transition-shadow"},r.createElement("div",{className:"flex items-start justify-between"},r.createElement("div",{className:"flex items-center gap-3"},r.createElement("div",{className:"p-2 bg-gray-100 dark:bg-gray-700 rounded-lg"},(e=>{switch(e){case"in":return r.createElement(l.A,{className:"h-5 w-5 text-green-600"});case"out":return r.createElement(s.A,{className:"h-5 w-5 text-red-600"});case"adjustment":return r.createElement(c.A,{className:"h-5 w-5 text-blue-600"});default:return r.createElement(m.A,{className:"h-5 w-5 text-gray-600"})}})(e.type)),r.createElement("div",null,r.createElement("h3",{className:"font-semibold text-gray-900 dark:text-white"},e.ingredient_name||"Ingrediente desconocido"),r.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400"},"ID: ",e.id))),r.createElement(f.A,{variant:(e=>{switch(e){case"completed":return"success";case"pending":return"warning";case"cancelled":return"danger";default:return"default"}})(e.status)},"completed"===e.status?"Completada":"pending"===e.status?"Pendiente":"Cancelada")),r.createElement("div",{className:"grid grid-cols-2 gap-4"},r.createElement("div",null,r.createElement("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide"},"Tipo"),r.createElement("p",{className:"text-sm font-medium text-gray-900 dark:text-white"},"in"===e.type?"Entrada":"out"===e.type?"Salida":"Ajuste")),r.createElement("div",null,r.createElement("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide"},"Cantidad"),r.createElement("p",{className:(0,w.A)("text-sm font-medium","in"===e.type?"text-green-600":"out"===e.type?"text-red-600":"text-blue-600")},"out"===e.type?"-":"+",e.quantity," ",e.unit)),r.createElement("div",null,r.createElement("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide"},"Costo Total"),r.createElement("p",{className:"text-sm font-medium text-gray-900 dark:text-white"},"$",(e.unit_cost*e.quantity).toFixed(2))),r.createElement("div",null,r.createElement("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide"},"Fecha"),r.createElement("p",{className:"text-sm font-medium text-gray-900 dark:text-white"},a),r.createElement("p",{className:"text-xs text-gray-500 dark:text-gray-400"},n))),e.notes&&r.createElement("div",null,r.createElement("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-1"},"Notas"),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-300"},e.notes)),r.createElement("div",{className:"flex items-center gap-2 pt-4 border-t border-gray-200 dark:border-gray-700"},r.createElement(v.A,{variant:"outline",size:"sm",onClick:()=>t(e),className:"flex-1"},r.createElement(i.A,{className:"h-4 w-4 mr-1"}),"Ver Detalles")))},C=({isOpen:e,onClose:t,onSave:a})=>{const[n,l]=(0,r.useState)({ingredient_id:"",type:"in",quantity:"",unit_cost:"",notes:"",reference:""}),{data:s}=(0,E.Wl)("/api/ingredients"),c=Array.isArray(s)?s:[];return(0,r.useEffect)((()=>{e||l({ingredient_id:"",type:"in",quantity:"",unit_cost:"",notes:"",reference:""})}),[e]),r.createElement(k.A,{isOpen:e,onClose:t,title:"Nueva Transacción",size:"lg"},r.createElement("form",{onSubmit:e=>{e.preventDefault(),a(n)},className:"space-y-6"},r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},r.createElement("div",{className:"md:col-span-2"},r.createElement("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Ingrediente"),r.createElement(b.A,{value:n.ingredient_id,onChange:e=>l((t=>({...t,ingredient_id:e}))),required:!0},r.createElement("option",{value:""},"Seleccionar ingrediente..."),c.map((e=>r.createElement("option",{key:e.id,value:e.id},e.name," - ",e.unit))))),r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Tipo de Transacción"),r.createElement(b.A,{value:n.type,onChange:e=>l((t=>({...t,type:e}))),required:!0},r.createElement("option",{value:"in"},"Entrada"),r.createElement("option",{value:"out"},"Salida"),r.createElement("option",{value:"adjustment"},"Ajuste"))),r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Cantidad"),r.createElement(N.A,{type:"number",step:"0.01",value:n.quantity,onChange:e=>l((t=>({...t,quantity:e.target.value}))),required:!0,placeholder:"0.00"})),r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Costo Unitario"),r.createElement(N.A,{type:"number",step:"0.01",value:n.unit_cost,onChange:e=>l((t=>({...t,unit_cost:e.target.value}))),required:!0,placeholder:"0.00"})),r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Referencia"),r.createElement(N.A,{value:n.reference,onChange:e=>l((t=>({...t,reference:e.target.value}))),placeholder:"Factura #123, Orden #456, etc."}))),r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Notas"),r.createElement("textarea",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",rows:3,value:n.notes,onChange:e=>l((t=>({...t,notes:e.target.value}))),placeholder:"Información adicional sobre la transacción..."})),n.quantity&&n.unit_cost&&r.createElement("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4"},r.createElement("h4",{className:"font-medium text-gray-900 dark:text-white mb-2"},"Resumen"),r.createElement("div",{className:"flex justify-between"},r.createElement("span",null,"Costo Total:"),r.createElement("span",{className:"font-semibold"},"$",(parseFloat(n.quantity)*parseFloat(n.unit_cost)).toFixed(2)))),r.createElement("div",{className:"flex gap-3 pt-4"},r.createElement(v.A,{type:"button",variant:"outline",onClick:t,className:"flex-1"},"Cancelar"),r.createElement(v.A,{type:"submit",className:"flex-1"},"Crear Transacción"))))};t.default=()=>{(0,n.zy)();const{success:e,error:t,warning:a}=(0,y.d)(),[c,m]=(0,r.useState)(""),[i,w]=(0,r.useState)("all"),[_,A]=(0,r.useState)("all"),[S,T]=(0,r.useState)("all"),[q,D]=(0,r.useState)("date_desc"),[j,F]=(0,r.useState)(!1),[L,O]=(0,r.useState)(null),[I,M]=(0,r.useState)(!1),{data:z,loading:P,refetch:H}=(0,E.Wl)("/api/transactions"),$=z||[],V=(0,r.useMemo)((()=>{let e=$.filter((e=>{const t=e.ingredient_name?.toLowerCase().includes(c.toLowerCase())||e.notes?.toLowerCase().includes(c.toLowerCase())||e.reference?.toLowerCase().includes(c.toLowerCase()),a="all"===i||e.type===i,r="all"===_||e.status===_;if("all"!==S){const t=new Date(e.created_at),a=new Date;let r=new Date;switch(S){case"today":r.setHours(0,0,0,0);break;case"week":r.setDate(a.getDate()-7);break;case"month":r.setMonth(a.getMonth()-1)}if("all"!==S&&t<r)return!1}return t&&a&&r}));return e.sort(((e,t)=>{switch(q){case"date_desc":return new Date(t.created_at)-new Date(e.created_at);case"date_asc":return new Date(e.created_at)-new Date(t.created_at);case"amount_desc":return t.quantity*t.unit_cost-e.quantity*e.unit_cost;case"amount_asc":return e.quantity*e.unit_cost-t.quantity*t.unit_cost;case"ingredient":return e.ingredient_name?.localeCompare(t.ingredient_name)||0;default:return 0}})),e}),[$,c,i,_,S,q]),R=(0,r.useMemo)((()=>{const e=$.filter((e=>{const t=new Date(e.created_at),a=new Date;return a.setHours(0,0,0,0),t.setHours(0,0,0,0),t.getTime()===a.getTime()})),t=$.filter((e=>"in"===e.type)).reduce(((e,t)=>e+t.quantity*t.unit_cost),0),a=$.filter((e=>"out"===e.type)).reduce(((e,t)=>e+t.quantity*t.unit_cost),0),r=$.filter((e=>"pending"===e.status)).length;return{todayCount:e.length,totalIn:t,totalOut:a,pending:r}}),[$]),W=e=>{O(e),M(!0)};return P?r.createElement("div",{className:"flex items-center justify-center min-h-96"},r.createElement(p.A,{size:"lg"})):r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},r.createElement("div",null,r.createElement("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white"},"Transacciones"),r.createElement("p",{className:"text-gray-600 dark:text-gray-400"},"Historial de movimientos de inventario")),r.createElement("div",{className:"flex items-center gap-3"},r.createElement(v.A,{variant:"outline",className:"flex items-center gap-2"},r.createElement(d.A,{className:"h-4 w-4"}),"Exportar"),r.createElement(v.A,{onClick:()=>{F(!0)},className:"flex items-center gap-2"},r.createElement(o.A,{className:"h-4 w-4"}),"Nueva Transacción"))),r.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Transacciones Hoy"),r.createElement("p",{className:"text-2xl font-bold text-gray-900 dark:text-white"},R.todayCount)),r.createElement(u.A,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"}))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Entradas Totales"),r.createElement("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400"},"$",R.totalIn.toFixed(0))),r.createElement(l.A,{className:"h-8 w-8 text-green-600 dark:text-green-400"}))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Salidas Totales"),r.createElement("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400"},"$",R.totalOut.toFixed(0))),r.createElement(s.A,{className:"h-8 w-8 text-red-600 dark:text-red-400"}))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Pendientes"),r.createElement("p",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400"},R.pending)),r.createElement(g.A,{className:"h-8 w-8 text-orange-600 dark:text-orange-400"})))),r.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4"},r.createElement("div",{className:"lg:col-span-2"},r.createElement(N.A,{placeholder:"Buscar transacciones...",value:c,onChange:e=>m(e.target.value),className:"w-full"})),r.createElement(b.A,{value:i,onChange:w},r.createElement("option",{value:"all"},"Todos los tipos"),r.createElement("option",{value:"in"},"Entradas"),r.createElement("option",{value:"out"},"Salidas"),r.createElement("option",{value:"adjustment"},"Ajustes")),r.createElement(b.A,{value:_,onChange:A},r.createElement("option",{value:"all"},"Todos los estados"),r.createElement("option",{value:"completed"},"Completadas"),r.createElement("option",{value:"pending"},"Pendientes"),r.createElement("option",{value:"cancelled"},"Canceladas")),r.createElement(b.A,{value:q,onChange:D},r.createElement("option",{value:"date_desc"},"Más recientes"),r.createElement("option",{value:"date_asc"},"Más antiguas"),r.createElement("option",{value:"amount_desc"},"Mayor monto"),r.createElement("option",{value:"amount_asc"},"Menor monto"),r.createElement("option",{value:"ingredient"},"Por ingrediente"))),r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},V.map((e=>r.createElement(h,{key:e.id,transaction:e,onView:W})))),0===V.length&&r.createElement("div",{className:"text-center py-12"},r.createElement(x.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),r.createElement("p",{className:"text-gray-500 dark:text-gray-400"},"No se encontraron transacciones")),r.createElement(C,{isOpen:j,onClose:()=>F(!1),onSave:async a=>{try{if(!(await fetch("/api/transactions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok)throw new Error("Error al crear la transacción");e("Transacción creada","La transacción ha sido registrada exitosamente"),F(!1),H()}catch(e){t("Error",e.message||"Error al crear la transacción")}}}),r.createElement(k.A,{isOpen:I,onClose:()=>{M(!1),O(null)},title:"Detalles de Transacción",size:"lg"},L&&r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"grid grid-cols-2 gap-4"},r.createElement("div",null,r.createElement("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"ID"),r.createElement("p",{className:"text-lg text-gray-900 dark:text-white"},L.id)),r.createElement("div",null,r.createElement("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Estado"),r.createElement(f.A,{variant:"completed"===L.status?"success":"warning"},"completed"===L.status?"Completada":"Pendiente")),r.createElement("div",null,r.createElement("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Ingrediente"),r.createElement("p",{className:"text-lg text-gray-900 dark:text-white"},L.ingredient_name)),r.createElement("div",null,r.createElement("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Tipo"),r.createElement("p",{className:"text-lg text-gray-900 dark:text-white"},"in"===L.type?"Entrada":"out"===L.type?"Salida":"Ajuste")),r.createElement("div",null,r.createElement("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Cantidad"),r.createElement("p",{className:"text-lg text-gray-900 dark:text-white"},L.quantity," ",L.unit)),r.createElement("div",null,r.createElement("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Costo Total"),r.createElement("p",{className:"text-lg text-gray-900 dark:text-white"},"$",(L.quantity*L.unit_cost).toFixed(2)))),L.notes&&r.createElement("div",null,r.createElement("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Notas"),r.createElement("p",{className:"text-gray-900 dark:text-white"},L.notes)),r.createElement("div",{className:"flex justify-end"},r.createElement(v.A,{variant:"outline",onClick:()=>{M(!1),O(null)}},"Cerrar")))))}}}]);