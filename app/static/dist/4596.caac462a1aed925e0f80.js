"use strict";(self.webpackChunkvenezia_frontend=self.webpackChunkvenezia_frontend||[]).push([[4596],{64596:function(e,t,a){a.r(t);var r=a(96540),n=a(3385),l=a(6632),s=a(43241),o=a(67984),c=a(94945),i=a(80964),d=a(35627),m=a(15977),g=a(48309),u=a(86589),y=a(29696),h=a(76316),b=a(418),x=a(96844),p=a(17133),v=a(44731),k=a(66118),w=a(91031),E=a(83240),f=a(27993);k.t1.register(k.PP,k.kc,k.FN,k.No,k.E8,k.Bs,k.hE,k.m_,k.s$,k.dN),t.default=()=>{const{user:e}=(0,E.A)(),[t,a]=(0,r.useState)(!0),[k,N]=(0,r.useState)([]),[A,_]=(0,r.useState)([]),[D,P]=(0,r.useState)("month"),[S,C]=(0,r.useState)({totalRevenue:0,totalSales:0,avgTicket:0,topProducts:[],revenueByBranch:[],salesTrend:[],inventoryAlerts:[],employeePerformance:[]});(0,r.useEffect)((()=>{T()}),[A,D]);const T=async()=>{try{a(!0);const{data:t}=await w.ND.from("branches").select("*").eq("organization_id",e?.organization_id||"demo").eq("is_active",!0);N(t||[]),0===A.length&&t&&_(t.map((e=>e.id))),await Promise.all([B(),q(),F(),H()])}catch(e){console.error("Error loading dashboard:",e)}finally{a(!1)}},B=async()=>{const e=j(),{data:t}=await w.ND.from("sales").select("*, branches(name)").in("branch_id",A.length>0?A:["demo"]).gte("created_at",e),a=t?.reduce(((e,t)=>e+(t.total_amount||0)),0)||0,r=t?.length||0,n=r>0?a/r:0,l=k.map((e=>{const a=t?.filter((t=>t.branch_id===e.id))||[],r=a.reduce(((e,t)=>e+(t.total_amount||0)),0);return{branch:e.name,revenue:r,sales:a.length}})),s=O(t);C((e=>({...e,totalRevenue:a,totalSales:r,avgTicket:n,revenueByBranch:l,salesTrend:s})))},q=async()=>{const{data:e}=await w.ND.from("sale_items").select("\n        quantity,\n        price,\n        products(name, category),\n        sales!inner(branch_id, created_at)\n      ").in("sales.branch_id",A.length>0?A:["demo"]).gte("sales.created_at",j()),t={};e?.forEach((e=>{if(e.products){const a=e.products.name;t[a]||(t[a]={name:a,quantity:0,revenue:0}),t[a].quantity+=e.quantity||0,t[a].revenue+=(e.price||0)*(e.quantity||0)}}));const a=Object.values(t).sort(((e,t)=>t.revenue-e.revenue)).slice(0,10);C((e=>({...e,topProducts:a})))},F=async()=>{const{data:e}=await w.ND.from("branch_inventory").select("\n        *,\n        branches(name),\n        products(name)\n      ").in("branch_id",A.length>0?A:["demo"]).lte("current_stock","min_stock").eq("is_available",!0);C((t=>({...t,inventoryAlerts:e||[]})))},H=async()=>{const{data:e}=await w.ND.from("employee_shifts").select("\n        *,\n        users(name),\n        branches(name)\n      ").in("branch_id",A.length>0?A:["demo"]).gte("date",j()).eq("status","completed"),t={};e?.forEach((e=>{if(e.users){const a=e.user_id;if(t[a]||(t[a]={name:e.users.name,hoursWorked:0,shifts:0}),t[a].shifts+=1,e.clock_in&&e.clock_out){const r=(new Date(e.clock_out)-new Date(e.clock_in))/36e5;t[a].hoursWorked+=r}}})),C((e=>({...e,employeePerformance:Object.values(t)})))},j=()=>{const e=new Date;switch(D){case"today":return new Date(e.setHours(0,0,0,0)).toISOString();case"week":return new Date(e.setDate(e.getDate()-7)).toISOString();case"month":default:return new Date(e.setMonth(e.getMonth()-1)).toISOString();case"year":return new Date(e.setFullYear(e.getFullYear()-1)).toISOString()}},O=e=>{const t=[];for(let a=("today"===D?24:30)-1;a>=0;a--){const r=new Date;r.setDate(r.getDate()-a);const n=new Date(r.setHours(0,0,0,0)),l=new Date(r.setHours(23,59,59,999)),s=e?.filter((e=>{const t=new Date(e.created_at);return t>=n&&t<=l}))||[];t.push({date:n.toLocaleDateString(),sales:s.length,revenue:s.reduce(((e,t)=>e+(t.total_amount||0)),0)})}return t},I=({title:e,value:t,change:a,icon:o,color:c,format:i="number"})=>{const d="currency"===i?(0,f.vv)(t):t.toLocaleString(),m=a>=0;return r.createElement(n.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{y:-5},className:"bg-white dark:bg-gray-900 rounded-xl shadow-lg dark:shadow-gray-950/30 p-8 border border-gray-200 dark:border-gray-800 transition-all duration-300 hover:shadow-xl dark:hover:shadow-gray-950/50"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-gray-700 dark:text-gray-300 text-base font-medium"},e),r.createElement("p",{className:"text-3xl font-bold mt-3 text-gray-900 dark:text-white"},d),void 0!==a&&r.createElement("div",{className:"flex items-center mt-2 text-sm "+(m?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400")},m?r.createElement(l.A,{className:"h-4 w-4"}):r.createElement(s.A,{className:"h-4 w-4"}),r.createElement("span",{className:"ml-1"},Math.abs(a),"%"))),r.createElement("div",{className:`p-3 rounded-lg bg-gradient-to-r ${c}`},r.createElement(o,{className:"h-6 w-6 text-white"}))))},M=({branch:e,index:t})=>{const a=Math.max(...S.revenueByBranch.map((e=>e.revenue))),l=a>0?e.revenue/a*100:0;return r.createElement(n.P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1*t},whileHover:{scale:1.02},className:"bg-gradient-to-r from-gray-50 to-white dark:from-gray-900 dark:to-gray-800 rounded-lg p-4 cursor-pointer shadow-sm hover:shadow-md transition-all duration-300"},r.createElement("div",{className:"flex items-center justify-between mb-2"},r.createElement("h4",{className:"font-semibold flex items-center gap-2 text-gray-900 dark:text-white"},r.createElement(o.A,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"}),e.branch),r.createElement("span",{className:"text-base text-gray-600 dark:text-gray-300"},e.sales," ventas")),r.createElement("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400"},(0,f.vv)(e.revenue)),r.createElement("div",{className:"mt-3"},r.createElement("div",{className:"bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden"},r.createElement(n.P.div,{initial:{width:0},animate:{width:`${l}%`},transition:{duration:1,ease:"easeOut"},className:"bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full"}))))},R={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1,labels:{color:"#9CA3AF"}},tooltip:{backgroundColor:"rgba(31, 41, 55, 0.9)",titleColor:"#F9FAFB",bodyColor:"#D1D5DB",borderColor:"#374151",borderWidth:1}},scales:{x:{grid:{color:"rgba(107, 114, 128, 0.1)",borderColor:"rgba(107, 114, 128, 0.2)"},ticks:{color:"#9CA3AF"}},y:{grid:{color:"rgba(107, 114, 128, 0.1)",borderColor:"rgba(107, 114, 128, 0.2)"},ticks:{color:"#9CA3AF",callback:function(e){return(0,f.vv)(e)}}}}};return r.createElement("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-950 transition-colors duration-200"},r.createElement("div",{className:"bg-white dark:bg-gray-900 shadow-lg dark:shadow-gray-950/30 border-b border-gray-200 dark:border-gray-800 transition-all duration-200"},r.createElement("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},r.createElement("div",{className:"py-6"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white flex items-center gap-3"},r.createElement(c.A,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"}),"Dashboard Corporativo"),r.createElement("p",{className:"mt-3 text-lg text-gray-700 dark:text-gray-300"},"Visión general de todas las sucursales")),r.createElement("div",{className:"flex items-center gap-3"},r.createElement(n.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>window.location.href="/branches",className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all duration-200 shadow-md hover:shadow-lg"},r.createElement(i.A,{className:"h-4 w-4"}),"Gestionar Sucursales")))))),r.createElement("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},r.createElement("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-md dark:shadow-gray-950/30 p-6 border border-gray-200 dark:border-gray-800 transition-all duration-200"},r.createElement("div",{className:"flex flex-wrap items-center gap-4"},r.createElement("div",{className:"flex items-center gap-2"},r.createElement(d.A,{className:"h-6 w-6 text-gray-600 dark:text-gray-300"}),r.createElement("select",{multiple:!0,value:A,onChange:e=>_(Array.from(e.target.selectedOptions,(e=>e.value))),className:"border-2 dark:border-gray-700 rounded-lg px-4 py-3 text-base bg-white dark:bg-gray-800 text-gray-900 dark:text-white min-w-[200px]"},k.map((e=>r.createElement("option",{key:e.id,value:e.id},e.name))))),r.createElement("div",{className:"flex gap-2"},["today","week","month","year"].map((e=>r.createElement("button",{key:e,onClick:()=>P(e),className:"px-4 py-2 rounded-lg transition-all duration-200 "+(D===e?"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-md":"bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300")},"today"===e?"Hoy":"week"===e?"Semana":"month"===e?"Mes":"Año")))),r.createElement("div",{className:"ml-auto flex gap-2"},r.createElement(n.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:T,className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-all duration-200"},r.createElement(m.A,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})),r.createElement(n.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-all duration-200"},r.createElement(g.A,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})))))),r.createElement("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12"},t?r.createElement("div",{className:"flex justify-center py-12"},r.createElement("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})):r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},r.createElement(I,{title:"Ingresos Totales",value:S.totalRevenue,change:12.5,icon:u.A,color:"from-green-500 to-emerald-600",format:"currency"}),r.createElement(I,{title:"Ventas Totales",value:S.totalSales,change:8.3,icon:y.A,color:"from-blue-500 to-cyan-600"}),r.createElement(I,{title:"Ticket Promedio",value:S.avgTicket,change:-2.1,icon:h.A,color:"from-purple-500 to-pink-600",format:"currency"}),r.createElement(I,{title:"Alertas de Stock",value:S.inventoryAlerts.length,icon:b.A,color:"from-red-500 to-orange-600"})),r.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6"},r.createElement(n.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white dark:bg-gray-900 rounded-xl shadow-lg dark:shadow-gray-950/30 p-8 border border-gray-200 dark:border-gray-800 transition-all duration-300"},r.createElement("h3",{className:"text-xl font-bold mb-6 flex items-center gap-3 text-gray-900 dark:text-white"},r.createElement(x.A,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),"Tendencia de Ventas"),r.createElement("div",{style:{height:"300px"}},r.createElement(v.N1,{data:{labels:S.salesTrend.map((e=>e.date)),datasets:[{label:"Ingresos",data:S.salesTrend.map((e=>e.revenue)),borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.3,fill:!0}]},options:R}))),r.createElement(n.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white dark:bg-gray-900 rounded-xl shadow-lg dark:shadow-gray-950/30 p-8 border border-gray-200 dark:border-gray-800 transition-all duration-300"},r.createElement("h3",{className:"text-xl font-bold mb-6 flex items-center gap-3 text-gray-900 dark:text-white"},r.createElement(p.A,{className:"h-5 w-5 text-purple-600 dark:text-purple-400"}),"Productos Más Vendidos"),r.createElement("div",{className:"space-y-3"},S.topProducts.slice(0,5).map(((e,t)=>r.createElement(n.P.div,{key:t,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1*t},className:"flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200"},r.createElement("div",{className:"flex items-center gap-3"},r.createElement("span",{className:"text-2xl font-bold text-gray-300 dark:text-gray-600"},t+1),r.createElement("div",null,r.createElement("p",{className:"font-medium text-gray-900 dark:text-white"},e.name),r.createElement("p",{className:"text-base text-gray-600 dark:text-gray-300"},e.quantity," unidades"))),r.createElement("p",{className:"font-semibold text-green-600 dark:text-green-400"},(0,f.vv)(e.revenue)))))))),r.createElement(n.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-900 rounded-xl shadow-lg dark:shadow-gray-950/30 p-8 border border-gray-200 dark:border-gray-800 transition-all duration-300"},r.createElement("h3",{className:"text-xl font-bold mb-6 flex items-center gap-3 text-gray-900 dark:text-white"},r.createElement(o.A,{className:"h-5 w-5 text-green-600 dark:text-green-400"}),"Rendimiento por Sucursal"),r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},S.revenueByBranch.map(((e,t)=>r.createElement(M,{key:t,branch:e,index:t}))))),S.inventoryAlerts.length>0&&r.createElement(n.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-red-50 to-orange-50 dark:from-red-900/20 dark:to-orange-900/20 rounded-xl shadow-lg dark:shadow-gray-950/20 p-6 transition-all duration-300"},r.createElement("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-red-700 dark:text-red-400"},r.createElement(b.A,{className:"h-5 w-5"}),"Alertas de Inventario Crítico"),r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},S.inventoryAlerts.map(((e,t)=>r.createElement(n.P.div,{key:t,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1*t},className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm hover:shadow-md transition-all duration-300"},r.createElement("p",{className:"font-medium text-gray-900 dark:text-white"},e.products?.name),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},e.branches?.name),r.createElement("div",{className:"mt-2 flex items-center justify-between"},r.createElement("span",{className:"text-red-600 dark:text-red-400 font-semibold"},e.current_stock," ",e.stock_unit),r.createElement("span",{className:"text-sm text-gray-500 dark:text-gray-500"},"Mín: ",e.min_stock," ",e.stock_unit))))))))))}}}]);