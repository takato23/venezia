"use strict";(self.webpackChunkvenezia_frontend=self.webpackChunkvenezia_frontend||[]).push([[1107],{41107:function(e,t,a){a.r(t);var r=a(96540),l=a(3385),c=a(3160),o=a(98188),n=a(32708),s=a(43197),i=a(80697),m=a(98445),d=(a(55467),a(82932),a(70700)),u=a(42203),g=a(67773),p=a(72284),E=a(11562),v=a(71428),x=a(93823);const y=(0,r.memo)((({product:e,category:t,onEdit:a,onDelete:s,onView:i})=>r.createElement(l.P.div,{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow p-4"},r.createElement("div",{className:"flex items-start justify-between mb-3"},r.createElement("div",{className:"flex-1"},r.createElement("h3",{className:"font-semibold text-gray-900 mb-1"},e.name),r.createElement("p",{className:"text-sm text-gray-600 mb-2"},e.description),r.createElement("div",{className:"flex items-center gap-2 text-xs text-gray-500"},r.createElement("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded"},t?.name||"Sin categoría"),r.createElement("span",{className:"font-medium"},"$",e.price))),r.createElement("div",{className:"flex gap-1"},r.createElement("button",{onClick:()=>i(e),className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"Ver detalles"},r.createElement(c.A,{className:"h-4 w-4"})),r.createElement("button",{onClick:()=>a(e),className:"p-1 text-gray-400 hover:text-yellow-600 transition-colors",title:"Editar"},r.createElement(o.A,{className:"h-4 w-4"})),r.createElement("button",{onClick:()=>s(e.id),className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"Eliminar"},r.createElement(n.A,{className:"h-4 w-4"})))))));y.displayName="ProductCard";const f=(0,r.memo)((({categoryName:e,products:t,categories:a,onEdit:l,onDelete:c,onView:o})=>r.createElement("div",{className:"space-y-3"},r.createElement("h2",{className:"text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2"},e," (",t.length,")"),r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},t.map((e=>{const t=(a||[]).find((t=>t.id===e.category_id));return r.createElement(y,{key:e.id,product:e,category:t,onEdit:l,onDelete:c,onView:o})}))))));f.displayName="CategorySection";const N=({product:e,categories:t,onSave:a,onClose:l})=>{const[c,o]=(0,r.useState)({name:"",description:"",price:"",category_id:"",weight_kg:"",max_flavors:"",sales_format:"",track_stock:!1,active:!0,...e});return r.createElement(g.A,{isOpen:!0,onClose:l,title:e?"Editar Producto":"Nuevo Producto"},r.createElement("form",{onSubmit:e=>{e.preventDefault(),a(c)},className:"space-y-4"},r.createElement(E.A,{label:"Nombre",value:c.name,onChange:e=>o({...c,name:e.target.value}),required:!0}),r.createElement(E.A,{label:"Descripción",value:c.description,onChange:e=>o({...c,description:e.target.value})}),r.createElement("div",{className:"grid grid-cols-2 gap-4"},r.createElement(E.A,{label:"Precio",type:"number",step:"0.01",value:c.price,onChange:e=>o({...c,price:e.target.value}),required:!0}),r.createElement(v.A,{label:"Categoría",value:c.category_id,onChange:e=>o({...c,category_id:e.target.value}),options:[{value:"",label:"Seleccionar categoría"},...(t||[]).map((e=>({value:e.id.toString(),label:e.name})))],required:!0})),r.createElement("div",{className:"grid grid-cols-2 gap-4"},r.createElement(E.A,{label:"Peso (kg)",type:"number",step:"0.1",value:c.weight_kg,onChange:e=>o({...c,weight_kg:e.target.value})}),r.createElement(E.A,{label:"Máx. Sabores",type:"number",value:c.max_flavors,onChange:e=>o({...c,max_flavors:e.target.value})})),r.createElement(E.A,{label:"Formato de Venta",value:c.sales_format,onChange:e=>o({...c,sales_format:e.target.value})}),r.createElement("div",{className:"space-y-2"},r.createElement("label",{className:"flex items-center gap-2"},r.createElement("input",{type:"checkbox",checked:c.track_stock,onChange:e=>o({...c,track_stock:e.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),r.createElement("span",{className:"text-sm text-gray-700"},"Rastrear inventario")),r.createElement("label",{className:"flex items-center gap-2"},r.createElement("input",{type:"checkbox",checked:c.active,onChange:e=>o({...c,active:e.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),r.createElement("span",{className:"text-sm text-gray-700"},"Producto activo"))),r.createElement("div",{className:"flex gap-3 pt-4"},r.createElement(p.A,{type:"submit",className:"flex-1"},e?"Actualizar":"Crear"," Producto"),r.createElement(p.A,{type:"button",variant:"outline",onClick:l,className:"flex-1"},"Cancelar"))))},b=({category:e,onSave:t,onClose:a})=>{const[l,c]=(0,r.useState)(e?.name||"");return r.createElement(g.A,{isOpen:!0,onClose:a,title:e?"Editar Categoría":"Nueva Categoría"},r.createElement("form",{onSubmit:e=>{e.preventDefault(),t({name:l})},className:"space-y-4"},r.createElement(E.A,{label:"Nombre de la Categoría",value:l,onChange:e=>c(e.target.value),required:!0}),r.createElement("div",{className:"flex gap-3 pt-4"},r.createElement(p.A,{type:"submit",className:"flex-1"},e?"Actualizar":"Crear"," Categoría"),r.createElement(p.A,{type:"button",variant:"outline",onClick:a,className:"flex-1"},"Cancelar"))))},h=({product:e,category:t,onClose:a})=>r.createElement(g.A,{isOpen:!0,onClose:a,title:"Detalles del Producto"},r.createElement("div",{className:"space-y-4"},r.createElement("div",null,r.createElement("h3",{className:"font-semibold text-lg"},e.name),e.description&&r.createElement("p",{className:"text-gray-600 mt-1"},e.description)),r.createElement("div",{className:"grid grid-cols-2 gap-4"},r.createElement("div",null,r.createElement("span",{className:"text-sm font-medium text-gray-500"},"Precio:"),r.createElement("p",{className:"text-lg font-semibold"},"$",e.price)),r.createElement("div",null,r.createElement("span",{className:"text-sm font-medium text-gray-500"},"Categoría:"),r.createElement("p",null,t?.name||"Sin categoría"))),(e.weight_kg||e.max_flavors||e.sales_format)&&r.createElement("div",{className:"grid grid-cols-2 gap-4"},e.weight_kg&&r.createElement("div",null,r.createElement("span",{className:"text-sm font-medium text-gray-500"},"Peso:"),r.createElement("p",null,e.weight_kg," kg")),e.max_flavors&&r.createElement("div",null,r.createElement("span",{className:"text-sm font-medium text-gray-500"},"Máx. Sabores:"),r.createElement("p",null,e.max_flavors)),e.sales_format&&r.createElement("div",null,r.createElement("span",{className:"text-sm font-medium text-gray-500"},"Formato:"),r.createElement("p",null,e.sales_format))),r.createElement("div",{className:"flex gap-4"},r.createElement("div",null,r.createElement("span",{className:"text-sm font-medium text-gray-500"},"Estado:"),r.createElement("p",{className:"inline-block px-2 py-1 rounded-full text-xs font-medium "+(e.active?"bg-green-100 text-green-800":"bg-red-100 text-red-800")},e.active?"Activo":"Inactivo")),r.createElement("div",null,r.createElement("span",{className:"text-sm font-medium text-gray-500"},"Rastreo de Stock:"),r.createElement("p",{className:"inline-block px-2 py-1 rounded-full text-xs font-medium "+(e.track_stock?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800")},e.track_stock?"Activado":"Desactivado"))),r.createElement("div",{className:"pt-4"},r.createElement(p.A,{onClick:a,className:"w-full"},"Cerrar"))));t.default=()=>{const[e,t]=(0,r.useState)(""),[a,l]=(0,r.useState)(""),[c,o]=(0,r.useState)(!1),[n,g]=(0,r.useState)(!1),[y,C]=(0,r.useState)(null),[k,w]=(0,r.useState)(null),[_,A]=(0,r.useState)(null),{success:S,error:P}=(0,u.d)(),{data:D,loading:j,refetch:$,invalidateCache:z}=(0,d.Wl)("/api/products"),{data:T,loading:O,refetch:L,invalidateCache:V}=(0,d.Wl)("/api/product_categories"),q=j||O,M=(0,r.useMemo)((()=>Array.isArray(D)?D.filter((t=>{const r=t.name.toLowerCase().includes(e.toLowerCase())||(t.description||"").toLowerCase().includes(e.toLowerCase()),l=""===a||t.category_id===parseInt(a);return r&&l})):[]),[D,e,a]),F=(0,r.useMemo)((()=>T?M.reduce(((e,t)=>{const a=(T||[]).find((e=>e.id===t.category_id))?.name||"Sin categoría";return e[a]||(e[a]=[]),e[a].push(t),e}),{}):{}),[M,T]),I=(0,r.useCallback)((async e=>{try{const t=y?`/api/products/${y.id}`:"/api/products",a=y?"PUT":"POST",r=await fetch(t,{method:a,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(r.ok)o(!1),C(null),z(),$(),S(y?"Producto actualizado":"Producto creado",`${e.name} se ${y?"actualizó":"creó"} correctamente`);else{const e=await r.json();P("Error al guardar",e.error||"No se pudo guardar el producto")}}catch(e){console.error("Error:",e),P("Error de conexión","No se pudo conectar con el servidor")}}),[y,z,$,S,P]),J=(0,r.useCallback)((async e=>{if(window.confirm("¿Está seguro de eliminar este producto?"))try{const t=await fetch(`/api/products/${e}`,{method:"DELETE"});if(t.ok)z(),$(),S("Producto eliminado","El producto se eliminó correctamente");else{const e=await t.json();P("Error al eliminar",e.error||"No se pudo eliminar el producto")}}catch(e){console.error("Error:",e),P("Error de conexión","No se pudo conectar con el servidor")}}),[z,$,S,P]),R=(0,r.useCallback)((async e=>{try{const t=k?`/api/product_categories/${k.id}`:"/api/product_categories",a=k?"PUT":"POST",r=await fetch(t,{method:a,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(r.ok)g(!1),w(null),V(),L(),S(k?"Categoría actualizada":"Categoría creada",`${e.name} se ${k?"actualizó":"creó"} correctamente`);else{const e=await r.json();P("Error al guardar",e.error||"No se pudo guardar la categoría")}}catch(e){console.error("Error:",e),P("Error de conexión","No se pudo conectar con el servidor")}}),[k,V,L,S,P]),U=((0,r.useCallback)((async e=>{if(window.confirm("¿Está seguro de eliminar esta categoría?"))try{const t=await fetch(`/api/product_categories/${e}`,{method:"DELETE"});if(t.ok)V(),L(),S("Categoría eliminada","La categoría se eliminó correctamente");else{const e=await t.json();P("Error al eliminar",e.error||"No se pudo eliminar la categoría")}}catch(e){console.error("Error:",e),P("Error de conexión","No se pudo conectar con el servidor")}}),[V,L,S,P]),(0,r.useCallback)((e=>{C(e),o(!0)}),[])),W=(0,r.useCallback)((e=>{A(e)}),[]);return q?r.createElement("div",{className:"flex items-center justify-center h-64"},r.createElement(x.A,{size:"lg"})):r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"},r.createElement("div",null,r.createElement("h1",{className:"text-2xl font-bold text-gray-900"},"Productos"),r.createElement("p",{className:"text-gray-600"},"Gestión de productos y categorías")),r.createElement("div",{className:"flex flex-col sm:flex-row gap-2"},r.createElement(p.A,{onClick:()=>{g(!0),w(null)},variant:"outline",icon:s.A},"Nueva Categoría"),r.createElement(p.A,{onClick:()=>{o(!0),C(null)},icon:i.A},"Nuevo Producto"))),r.createElement("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4"},r.createElement("div",{className:"flex flex-col sm:flex-row gap-4"},r.createElement("div",{className:"flex-1"},r.createElement(E.A,{type:"text",placeholder:"Buscar productos...",value:e,onChange:e=>t(e.target.value),icon:m.A})),r.createElement("div",{className:"sm:w-48"},r.createElement(v.A,{value:a,onChange:e=>l(e.target.value),options:[{value:"",label:"Todas las categorías"},...(T||[]).map((e=>({value:e.id.toString(),label:e.name})))]})))),r.createElement("div",{className:"space-y-6"},Object.entries(F).map((([e,t])=>r.createElement(f,{key:e,categoryName:e,products:t,categories:T,onEdit:U,onDelete:J,onView:W})))),c&&r.createElement(N,{product:y,categories:T,onSave:I,onClose:()=>{o(!1),C(null)}}),n&&r.createElement(b,{category:k,onSave:R,onClose:()=>{g(!1),w(null)}}),_&&r.createElement(h,{product:_,category:T.find((e=>e.id===_.category_id)),onClose:()=>A(null)}))}}}]);