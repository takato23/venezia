"use strict";(self.webpackChunkvenezia_frontend=self.webpackChunkvenezia_frontend||[]).push([[965],{70965:function(e,a,t){t.r(a),t.d(a,{default:function(){return ee}});var r=t(96540),s=t(13558),l=t(96844),n=t(87073),c=t(27798),i=t(63415),o=t(9498),m=t(48852),d=t(48686),u=t(22492),g=t(93893),p=t(51004),b=t(80964),y=t(20053),E=({tabs:e,initial:a,render:t})=>{const[s,l]=(0,r.useState)(a||e[0].id);return r.createElement("div",{className:"w-full"},r.createElement("div",{role:"tablist","aria-label":"Pestañas",className:"mb-6 flex flex-wrap gap-2"},e.map((({id:e,label:a,icon:t})=>r.createElement("button",{key:e,role:"tab","aria-selected":s===e,"aria-controls":`tab-panel-${e}`,id:`tab-${e}`,onClick:()=>l(e),className:(0,y.A)("inline-flex items-center gap-2 rounded-xl px-4 py-2 text-sm font-medium focus-ring",s===e?"bg-venezia-900 text-white shadow-minimal":"bg-white text-venezia-700 hover:bg-venezia-100 border border-venezia-200")},t&&r.createElement(t,{className:"h-4 w-4"}),r.createElement("span",null,a))))),e.map((({id:e})=>r.createElement("div",{key:e,role:"tabpanel",id:`tab-panel-${e}`,"aria-labelledby":`tab-${e}`,hidden:s!==e,className:"focus:outline-none"},s===e&&t(e)))))},x=t(55467),v=t(97282),f=t(55042),N=t(43954),h=t(19869),w=t(76069),k=t(93540),A=t(3160),C=t(42203),S=t(72284),_=t(11562),z=t(71428),j=t(28219),P=t(67773),I=t(76894),D=()=>{const{user:e,updateUser:a,logout:t}=(0,x.n)(),{success:s,error:n}=(0,C.d)(),[c,i]=(0,r.useState)("profile"),[g,p]=(0,r.useState)(!1),[E,D]=(0,r.useState)(!1),[T,M]=(0,r.useState)(!1),[B,G]=(0,r.useState)({name:e?.name||"",email:e?.email||"",phone:e?.phone||"",position:e?.position||"",department:e?.department||"",address:e?.address||"",avatar:e?.avatar||null}),[L,O]=(0,r.useState)({current_password:"",new_password:"",confirm_password:""}),[R,V]=(0,r.useState)({}),[$,U]=(0,r.useState)({current:!1,new:!1,confirm:!1}),q={admin:{label:"Administrador",color:"text-red-600",bg:"bg-red-100"},manager:{label:"Gerente",color:"text-blue-600",bg:"bg-blue-100"},supervisor:{label:"Supervisor",color:"text-green-600",bg:"bg-green-100"},employee:{label:"Empleado",color:"text-gray-600",bg:"bg-gray-100"}},K=[{value:"production",label:"Producción"},{value:"sales",label:"Ventas"},{value:"inventory",label:"Inventario"},{value:"delivery",label:"Entregas"},{value:"administration",label:"Administración"}],F=[{id:"profile",label:"Perfil",icon:d.A},{id:"security",label:"Seguridad",icon:u.A},{id:"activity",label:"Actividad",icon:l.A}],J=q[e?.role]||q.employee;return r.createElement("div",{className:"max-w-4xl mx-auto space-y-6"},r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6"},r.createElement("div",{className:"flex items-center gap-6"},r.createElement("div",{className:"relative"},r.createElement("div",{className:"w-20 h-20 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center overflow-hidden"},B.avatar?r.createElement("img",{src:B.avatar,alt:"Avatar",className:"w-full h-full object-cover"}):r.createElement(d.A,{className:"w-8 h-8 text-gray-400"})),r.createElement("label",{className:"absolute bottom-0 right-0 p-1 bg-venezia-600 text-white rounded-full cursor-pointer hover:bg-venezia-700 transition-colors"},r.createElement(v.A,{className:"w-3 h-3"}),r.createElement("input",{type:"file",accept:"image/*",onChange:async e=>{const a=e.target.files[0];if(!a)return;const t=new FormData;t.append("avatar",a),M(!0);try{const e=await fetch("/api/auth/avatar",{method:"POST",body:t});if(e.ok){const a=await e.json();G((e=>({...e,avatar:a.avatar}))),s("Avatar actualizado","Tu foto de perfil se ha actualizado")}else n("Error","No se pudo subir la imagen")}catch(e){n("Error","Error al subir la imagen")}finally{M(!1)}},className:"hidden"}))),r.createElement("div",{className:"flex-1"},r.createElement("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white"},e?.name||"Usuario"),r.createElement("p",{className:"text-gray-600 dark:text-gray-400 mt-1"},e?.email),r.createElement("div",{className:"flex items-center gap-3 mt-2"},r.createElement(j.A,{className:(0,y.A)(J.bg,J.color),size:"sm"},J.label),e?.department&&r.createElement("span",{className:"text-sm text-gray-500 dark:text-gray-400"},K.find((a=>a.value===e.department))?.label||e.department))),r.createElement("div",{className:"flex items-center gap-2"},r.createElement(S.A,{onClick:()=>D(!0),variant:"outline",size:"sm",icon:o.A},"Cambiar Contraseña"),r.createElement(S.A,{onClick:t,variant:"outline",size:"sm",icon:f.A},"Cerrar Sesión")))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700"},r.createElement("div",{className:"border-b dark:border-gray-700"},r.createElement("div",{className:"flex"},F.map((e=>{const a=e.icon;return r.createElement("button",{key:e.id,onClick:()=>i(e.id),className:(0,y.A)("flex items-center gap-2 px-6 py-3 border-b-2 transition-colors",c===e.id?"border-venezia-600 text-venezia-600 dark:text-venezia-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200")},r.createElement(a,{className:"w-4 h-4"}),e.label)})))),r.createElement("div",{className:"p-6"},"profile"===c&&r.createElement("form",{onSubmit:async e=>{e.preventDefault(),M(!0);try{const e=await a(B);e.success?(s("Perfil actualizado","Tu información se ha actualizado correctamente"),p(!1)):n("Error",e.error||"No se pudo actualizar el perfil")}catch(e){n("Error","Error al actualizar el perfil")}finally{M(!1)}},className:"space-y-6"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white"},"Información Personal"),r.createElement(S.A,{type:"button",onClick:()=>p(!g),variant:"outline",size:"sm",icon:g?m.A:b.A},g?"Cancelar":"Editar")),r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6"},r.createElement(_.A,{label:"Nombre completo",name:"name",value:B.name,onChange:e=>G({...B,name:e.target.value}),disabled:!g,icon:d.A}),r.createElement(_.A,{label:"Email",name:"email",type:"email",value:B.email,onChange:e=>G({...B,email:e.target.value}),disabled:!g,icon:N.A}),r.createElement(_.A,{label:"Teléfono",name:"phone",value:B.phone,onChange:e=>G({...B,phone:e.target.value}),disabled:!g,icon:h.A}),r.createElement(z.A,{label:"Cargo",name:"position",value:B.position,onChange:e=>G({...B,position:e.target.value}),disabled:!g,options:[{value:"manager",label:"Gerente"},{value:"supervisor",label:"Supervisor"},{value:"operator",label:"Operador"},{value:"assistant",label:"Asistente"},{value:"driver",label:"Repartidor"}]}),r.createElement(z.A,{label:"Departamento",name:"department",value:B.department,onChange:e=>G({...B,department:e.target.value}),disabled:!g,options:K}),r.createElement(_.A,{label:"Dirección",name:"address",value:B.address,onChange:e=>G({...B,address:e.target.value}),disabled:!g,icon:w.A})),g&&r.createElement("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700"},r.createElement(S.A,{type:"button",onClick:()=>p(!1),variant:"outline"},"Cancelar"),r.createElement(S.A,{type:"submit",variant:"primary",icon:m.A,loading:T},"Guardar Cambios"))),"security"===c&&r.createElement("div",{className:"space-y-6"},r.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white"},"Configuración de Seguridad"),r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6"},r.createElement("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4"},r.createElement("h4",{className:"font-medium text-gray-900 dark:text-white mb-2"},"Contraseña"),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3"},"Última actualización: ",e?.password_changed_at?new Date(e.password_changed_at).toLocaleDateString():"Nunca"),r.createElement(S.A,{onClick:()=>D(!0),variant:"outline",size:"sm",icon:o.A},"Cambiar Contraseña")),r.createElement("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4"},r.createElement("h4",{className:"font-medium text-gray-900 dark:text-white mb-2"},"Sesiones Activas"),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3"},"Gestiona las sesiones de tu cuenta"),r.createElement(S.A,{variant:"outline",size:"sm",icon:l.A},"Ver Sesiones"))),r.createElement("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4"},r.createElement("div",{className:"flex items-start gap-3"},r.createElement(u.A,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5"}),r.createElement("div",null,r.createElement("h4",{className:"font-medium text-blue-900 dark:text-blue-100"},"Recomendaciones de Seguridad"),r.createElement("ul",{className:"text-sm text-blue-700 dark:text-blue-300 mt-2 space-y-1"},r.createElement("li",null,"• Usa una contraseña fuerte y única"),r.createElement("li",null,"• Cambia tu contraseña regularmente"),r.createElement("li",null,"• No compartas tus credenciales"),r.createElement("li",null,"• Cierra sesión en dispositivos compartidos")))))),"activity"===c&&r.createElement("div",{className:"space-y-6"},r.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white"},"Actividad Reciente"),r.createElement("div",{className:"space-y-4"},r.createElement("div",{className:"text-center py-8"},r.createElement(l.A,{className:"w-12 h-12 mx-auto text-gray-400 mb-2"}),r.createElement("p",{className:"text-gray-500 dark:text-gray-400"},"El registro de actividad estará disponible próximamente")))))),r.createElement(P.A,{isOpen:E,onClose:()=>{D(!1),O({current_password:"",new_password:"",confirm_password:""}),V({})},title:r.createElement("div",{className:"flex items-center gap-2"},r.createElement(o.A,{className:"w-5 h-5"}),"Cambiar Contraseña"),size:"md"},r.createElement("form",{onSubmit:async e=>{e.preventDefault();const a={};if(L.current_password||(a.current_password="La contraseña actual es requerida"),L.new_password?L.new_password.length<6&&(a.new_password="La contraseña debe tener al menos 6 caracteres"):a.new_password="La nueva contraseña es requerida",L.new_password!==L.confirm_password&&(a.confirm_password="Las contraseñas no coinciden"),Object.keys(a).length>0)V(a);else{M(!0);try{const e=await fetch("/api/auth/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(L)});if(e.ok)s("Contraseña actualizada","Tu contraseña se ha cambiado correctamente"),O({current_password:"",new_password:"",confirm_password:""}),D(!1);else{const a=await e.json();n("Error",a.error||"No se pudo cambiar la contraseña")}}catch(e){n("Error","Error al cambiar la contraseña")}finally{M(!1)}}},className:"space-y-6"},r.createElement("div",{className:"space-y-4"},r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Contraseña Actual"),r.createElement("div",{className:"relative"},r.createElement("input",{type:$.current?"text":"password",value:L.current_password,onChange:e=>O({...L,current_password:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-venezia-500 focus:border-transparent dark:bg-gray-700 dark:text-white pr-10",placeholder:"Ingresa tu contraseña actual"}),r.createElement("button",{type:"button",onClick:()=>U({...$,current:!$.current}),className:"absolute right-3 top-1/2 transform -translate-y-1/2"},$.current?r.createElement(k.A,{className:"w-4 h-4 text-gray-400"}):r.createElement(A.A,{className:"w-4 h-4 text-gray-400"}))),R.current_password&&r.createElement(I.A,{error:R.current_password})),r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Nueva Contraseña"),r.createElement("div",{className:"relative"},r.createElement("input",{type:$.new?"text":"password",value:L.new_password,onChange:e=>O({...L,new_password:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-venezia-500 focus:border-transparent dark:bg-gray-700 dark:text-white pr-10",placeholder:"Ingresa la nueva contraseña"}),r.createElement("button",{type:"button",onClick:()=>U({...$,new:!$.new}),className:"absolute right-3 top-1/2 transform -translate-y-1/2"},$.new?r.createElement(k.A,{className:"w-4 h-4 text-gray-400"}):r.createElement(A.A,{className:"w-4 h-4 text-gray-400"}))),R.new_password&&r.createElement(I.A,{error:R.new_password})),r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Confirmar Nueva Contraseña"),r.createElement("div",{className:"relative"},r.createElement("input",{type:$.confirm?"text":"password",value:L.confirm_password,onChange:e=>O({...L,confirm_password:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-venezia-500 focus:border-transparent dark:bg-gray-700 dark:text-white pr-10",placeholder:"Confirma la nueva contraseña"}),r.createElement("button",{type:"button",onClick:()=>U({...$,confirm:!$.confirm}),className:"absolute right-3 top-1/2 transform -translate-y-1/2"},$.confirm?r.createElement(k.A,{className:"w-4 h-4 text-gray-400"}):r.createElement(A.A,{className:"w-4 h-4 text-gray-400"}))),R.confirm_password&&r.createElement(I.A,{error:R.confirm_password}))),r.createElement("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700"},r.createElement(S.A,{type:"button",onClick:()=>D(!1),variant:"outline"},"Cancelar"),r.createElement(S.A,{type:"submit",variant:"primary",icon:m.A,loading:T},"Cambiar Contraseña")))))};const T={"sales.view":"Ver ventas","sales.create":"Crear ventas","sales.edit":"Editar ventas","sales.delete":"Eliminar ventas","inventory.view":"Ver inventario","inventory.edit":"Editar inventario","inventory.transfer":"Transferir stock","production.view":"Ver producción","production.create":"Crear órdenes de producción","production.edit":"Editar producción","delivery.view":"Ver entregas","delivery.create":"Crear entregas","delivery.edit":"Editar entregas","delivery.assign":"Asignar repartidores","reports.view":"Ver reportes","reports.export":"Exportar reportes","reports.financial":"Ver reportes financieros","users.view":"Ver usuarios","users.create":"Crear usuarios","users.edit":"Editar usuarios","users.delete":"Eliminar usuarios","settings.view":"Ver configuración","settings.edit":"Editar configuración","settings.system":"Configuración del sistema","admin.all":"Acceso completo de administrador"},M={admin:["sales.view","sales.create","sales.edit","sales.delete","inventory.view","inventory.edit","inventory.transfer","production.view","production.create","production.edit","delivery.view","delivery.create","delivery.edit","delivery.assign","reports.view","reports.export","reports.financial","users.view","users.create","users.edit","users.delete","settings.view","settings.edit","settings.system","admin.all"],manager:["sales.view","sales.create","sales.edit","inventory.view","inventory.edit","inventory.transfer","production.view","production.create","production.edit","delivery.view","delivery.create","delivery.edit","delivery.assign","reports.view","reports.export","reports.financial","users.view","users.edit","settings.view","settings.edit"],supervisor:["sales.view","sales.create","sales.edit","inventory.view","inventory.edit","production.view","production.create","production.edit","delivery.view","delivery.create","delivery.edit","reports.view","reports.export","users.view"],employee:["sales.view","sales.create","inventory.view","production.view","delivery.view","reports.view"],driver:["delivery.view","reports.view"]},B=()=>{const{getUserPermissions:e,user:a}=(()=>{const{user:e}=(0,x.n)(),a=a=>{if(!e||!e.role)return!1;const t=M[e.role]||[];return!!t.includes("admin.all")||t.includes(a)};return{hasPermission:a,hasAnyPermission:e=>e.some((e=>a(e))),hasAllPermissions:e=>e.every((e=>a(e))),getUserPermissions:()=>e&&e.role&&M[e.role]||[],user:e}})(),t=e();return a?r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6"},r.createElement("div",{className:"flex items-center gap-2 mb-4"},r.createElement(u.A,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),r.createElement("h3",{className:"font-medium text-gray-900 dark:text-white"},"Permisos de Usuario")),r.createElement("div",{className:"mb-4"},r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Rol: ",r.createElement("span",{className:"font-medium"},a.role))),r.createElement("div",{className:"space-y-2"},t.map((e=>r.createElement("div",{key:e,className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700/50 rounded"},r.createElement("span",{className:"text-sm font-mono text-gray-700 dark:text-gray-300"},e),r.createElement("span",{className:"text-xs text-gray-500 dark:text-gray-400"},T[e]||"Sin descripción"))))),0===t.length&&r.createElement("p",{className:"text-center text-gray-500 dark:text-gray-400 py-4"},"No hay permisos asignados")):null};var G=t(39574),L=t(4179),O=t(15977),R=t(48697),V=t(27235),$=t(418),U=t(10607),q=({isOpen:e,onClose:a})=>{const{user:t}=(0,x.n)(),{success:s,error:n,warning:c}=(0,C.d)(),[i,o]=(0,r.useState)([]),[m,d]=(0,r.useState)(!0),[g,p]=(0,r.useState)(new Set),b=async()=>{d(!0);try{const e=await fetch("/api/auth/sessions");if(e.ok){const a=await e.json();o(a.sessions||[])}else n("Error","No se pudieron cargar las sesiones")}catch(e){n("Error","Error de conexión")}finally{d(!1)}},E=async(e,a=!1)=>{if(!a||window.confirm("¿Estás seguro de cerrar tu sesión actual?")){p((a=>new Set(a).add(e)));try{(await fetch(`/api/auth/sessions/${e}`,{method:"DELETE"})).ok?a?(s("Sesión cerrada","Tu sesión actual se ha cerrado"),window.location.reload()):(s("Sesión terminada","La sesión se ha cerrado correctamente"),b()):n("Error","No se pudo terminar la sesión")}catch(e){n("Error","Error al terminar la sesión")}finally{p((a=>{const t=new Set(a);return t.delete(e),t}))}}};(0,r.useEffect)((()=>{e&&b()}),[e]);const v=e=>e.includes("Mobile")||e.includes("Android")||e.includes("iPhone")?G.A:L.A,f=e=>e.includes("Chrome")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")?"Safari":e.includes("Edge")?"Edge":"Desconocido",N=e=>e?.city&&e?.country?`${e.city}, ${e.country}`:e?.ip||"Ubicación desconocida",h=i.find((e=>e.is_current)),k=i.filter((e=>!e.is_current));return r.createElement(P.A,{isOpen:e,onClose:a,title:r.createElement("div",{className:"flex items-center gap-2"},r.createElement(l.A,{className:"w-5 h-5"}),"Gestión de Sesiones"),size:"lg"},r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4"},r.createElement("div",{className:"flex items-start gap-3"},r.createElement(u.A,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5"}),r.createElement("div",null,r.createElement("h3",{className:"font-medium text-blue-900 dark:text-blue-100"},"Seguridad de tu Cuenta"),r.createElement("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1"},"Revisa y gestiona las sesiones activas en tu cuenta. Si ves alguna actividad sospechosa, termina esas sesiones inmediatamente.")))),r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",{className:"flex items-center gap-2"},r.createElement(S.A,{onClick:b,variant:"outline",size:"sm",icon:O.A,loading:m},"Actualizar"),k.length>0&&r.createElement(S.A,{onClick:async()=>{if(window.confirm("¿Estás seguro de cerrar todas las demás sesiones?")){d(!0);try{(await fetch("/api/auth/sessions/terminate-others",{method:"POST"})).ok?(s("Sesiones cerradas","Todas las demás sesiones se han cerrado"),b()):n("Error","No se pudieron cerrar las sesiones")}catch(e){n("Error","Error al cerrar las sesiones")}finally{d(!1)}}},variant:"outline",size:"sm",icon:R.A,className:"text-red-600 hover:text-red-700 border-red-300 hover:border-red-400"},"Cerrar Todas las Demás")),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},i.length," sesión",1!==i.length?"es":""," activa",1!==i.length?"s":"")),r.createElement(U.A,{loading:m,error:!1,empty:0===i.length,onRetry:b,emptyText:"No hay sesiones activas",emptyIcon:l.A}),!m&&i.length>0&&r.createElement("div",{className:"space-y-4"},h&&r.createElement("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4"},r.createElement("div",{className:"flex items-start justify-between"},r.createElement("div",{className:"flex items-start gap-3"},r.createElement(v(h.user_agent),{className:"w-6 h-6 text-green-600 dark:text-green-400 mt-1"}),r.createElement("div",{className:"flex-1"},r.createElement("div",{className:"flex items-center gap-2 mb-1"},r.createElement("h4",{className:"font-medium text-green-900 dark:text-green-100"},"Sesión Actual"),r.createElement(j.A,{variant:"success",size:"xs"},"Activo")),r.createElement("div",{className:"space-y-1 text-sm text-green-700 dark:text-green-300"},r.createElement("p",null,f(h.user_agent)," en ",h.platform||"Plataforma desconocida"),r.createElement("div",{className:"flex items-center gap-1"},r.createElement(w.A,{className:"w-3 h-3"}),r.createElement("span",null,N(h.location))),r.createElement("div",{className:"flex items-center gap-1"},r.createElement(V.A,{className:"w-3 h-3"}),r.createElement("span",null,"Iniciado: ",new Date(h.created_at).toLocaleString())),r.createElement("div",{className:"flex items-center gap-1"},r.createElement(l.A,{className:"w-3 h-3"}),r.createElement("span",null,"Última actividad: ",new Date(h.last_activity).toLocaleString()))))),r.createElement(S.A,{onClick:()=>E(h.id,!0),variant:"outline",size:"sm",icon:R.A,loading:g.has(h.id),className:"text-red-600 hover:text-red-700 border-red-300 hover:border-red-400"},"Cerrar"))),k.map((e=>{const a=v(e.user_agent),t=(e=>e.is_suspicious||!1)(e);return r.createElement("div",{key:e.id,className:(0,y.A)("border rounded-lg p-4",t?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700")},r.createElement("div",{className:"flex items-start justify-between"},r.createElement("div",{className:"flex items-start gap-3"},r.createElement(a,{className:(0,y.A)("w-6 h-6 mt-1",t?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400")}),r.createElement("div",{className:"flex-1"},r.createElement("div",{className:"flex items-center gap-2 mb-1"},r.createElement("h4",{className:(0,y.A)("font-medium",t?"text-red-900 dark:text-red-100":"text-gray-900 dark:text-white")},f(e.user_agent)," en ",e.platform||"Plataforma desconocida"),t&&r.createElement(j.A,{variant:"error",size:"xs"},r.createElement($.A,{className:"w-3 h-3 mr-1"}),"Sospechoso")),r.createElement("div",{className:(0,y.A)("space-y-1 text-sm",t?"text-red-700 dark:text-red-300":"text-gray-600 dark:text-gray-400")},r.createElement("div",{className:"flex items-center gap-1"},r.createElement(w.A,{className:"w-3 h-3"}),r.createElement("span",null,N(e.location))),r.createElement("div",{className:"flex items-center gap-1"},r.createElement(V.A,{className:"w-3 h-3"}),r.createElement("span",null,"Iniciado: ",new Date(e.created_at).toLocaleString())),r.createElement("div",{className:"flex items-center gap-1"},r.createElement(l.A,{className:"w-3 h-3"}),r.createElement("span",null,"Última actividad: ",new Date(e.last_activity).toLocaleString()))))),r.createElement(S.A,{onClick:()=>E(e.id),variant:"outline",size:"sm",icon:R.A,loading:g.has(e.id),className:"text-red-600 hover:text-red-700 border-red-300 hover:border-red-400"},"Terminar")))}))),r.createElement("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4"},r.createElement("h4",{className:"font-medium text-gray-900 dark:text-white mb-2"},"Consejos de Seguridad"),r.createElement("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1"},r.createElement("li",null,"• Cierra sesiones en dispositivos que ya no uses"),r.createElement("li",null,"• Revisa regularmente tus sesiones activas"),r.createElement("li",null,"• Reporta cualquier actividad sospechosa"),r.createElement("li",null,"• Usa dispositivos confiables para acceder a tu cuenta"))),r.createElement("div",{className:"flex justify-end pt-4 border-t dark:border-gray-700"},r.createElement(S.A,{onClick:a,variant:"outline",icon:R.A},"Cerrar"))))},K=t(3385),F=t(32307),J=t(54833),H=t(48309),Q=t(94796),W=t(37946),X=t(60799),Y=()=>{const[e,a]=(0,r.useState)([]),[t,s]=(0,r.useState)(null),[l,n]=(0,r.useState)(!0),[c,i]=(0,r.useState)(!1),[o,m]=(0,r.useState)(null);(0,r.useEffect)((()=>{d(),u()}),[]);const d=async()=>{try{const e=await fetch("/api/backups"),t=await e.json();t.success&&a(t.data)}catch(e){console.error("Error fetching backups:",e),X.Ay.error("Error al cargar backups")}finally{n(!1)}},u=async()=>{try{const e=await fetch("/api/backups/info"),a=await e.json();a.success&&s(a.data)}catch(e){console.error("Error fetching backup info:",e)}},g=e=>{if(0===e)return"0 Bytes";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["Bytes","KB","MB","GB"][a]};return r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white"},"Gestión de Backups"),r.createElement("button",{onClick:async()=>{i(!0);try{const e=await fetch("/api/backups",{method:"POST",headers:{"Content-Type":"application/json"}}),a=await e.json();a.success?(X.Ay.success("Backup creado exitosamente"),d(),u()):X.Ay.error(a.message||"Error al crear backup")}catch(e){console.error("Error creating backup:",e),X.Ay.error("Error al crear backup")}finally{i(!1)}},disabled:c||t?.isRunning,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},c?r.createElement(O.A,{className:"h-5 w-5 animate-spin"}):r.createElement(p.A,{className:"h-5 w-5"}),c?"Creando...":"Crear Backup")),t&&r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4"},r.createElement(K.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400"},"Total Backups"),r.createElement("p",{className:"text-2xl font-bold text-gray-800 dark:text-white"},t.totalBackups," / ",t.maxBackups)),r.createElement(p.A,{className:"h-8 w-8 text-blue-500"}))),r.createElement(K.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400"},"Espacio Total"),r.createElement("p",{className:"text-2xl font-bold text-gray-800 dark:text-white"},g(t.totalSize))),r.createElement(J.A,{className:"h-8 w-8 text-green-500"}))),r.createElement(K.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400"},"Último Backup"),r.createElement("p",{className:"text-2xl font-bold text-gray-800 dark:text-white"},t.newestBackup?new Date(t.newestBackup.created).toLocaleDateString():"Nunca")),r.createElement(F.A,{className:"h-8 w-8 text-purple-500"})))),r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden"},r.createElement("div",{className:"px-6 py-4 border-b dark:border-gray-700"},r.createElement("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white"},"Backups Disponibles")),l?r.createElement("div",{className:"p-12 text-center"},r.createElement(O.A,{className:"h-8 w-8 animate-spin mx-auto text-gray-400"}),r.createElement("p",{className:"mt-2 text-gray-600 dark:text-gray-400"},"Cargando backups...")):0===e.length?r.createElement("div",{className:"p-12 text-center"},r.createElement(p.A,{className:"h-12 w-12 mx-auto text-gray-300"}),r.createElement("p",{className:"mt-2 text-gray-600 dark:text-gray-400"},"No hay backups disponibles")):r.createElement("div",{className:"divide-y dark:divide-gray-700"},e.map((e=>r.createElement(K.P.div,{key:e.fileName,initial:{opacity:0},animate:{opacity:1},className:"p-6 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",{className:"flex-1"},r.createElement("div",{className:"flex items-center gap-3"},(e=>{switch(e){case"scheduled":return r.createElement(V.A,{className:"h-4 w-4"});case"weekly":return r.createElement(F.A,{className:"h-4 w-4"});default:return r.createElement(p.A,{className:"h-4 w-4"})}})(e.type),r.createElement("div",null,r.createElement("h4",{className:"font-medium text-gray-800 dark:text-white"},e.fileName),r.createElement("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-500 dark:text-gray-400"},r.createElement("span",{className:"flex items-center gap-1"},r.createElement(F.A,{className:"h-3 w-3"}),new Date(e.created).toLocaleString()),r.createElement("span",{className:"flex items-center gap-1"},r.createElement(J.A,{className:"h-3 w-3"}),g(e.size)),r.createElement("span",{className:"px-2 py-0.5 bg-gray-100 dark:bg-gray-600 rounded text-xs"},(e=>{switch(e){case"scheduled":return"Diario";case"weekly":return"Semanal";case"manual":return"Manual";default:return e}})(e.type)))))),r.createElement("div",{className:"flex items-center gap-2 ml-4"},r.createElement("button",{onClick:()=>{return a=e.fileName,void window.open(`/api/backups/${a}/download`,"_blank");var a},className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors",title:"Descargar backup"},r.createElement(H.A,{className:"h-5 w-5"})),r.createElement("button",{onClick:()=>(async e=>{if(confirm(`¿Estás seguro de restaurar el backup ${e}? Se perderán todos los cambios actuales.`)){m(e);try{const a=await fetch(`/api/backups/${e}/restore`,{method:"POST",headers:{"Content-Type":"application/json"}}),t=await a.json();t.success?(X.Ay.success("Backup restaurado exitosamente"),setTimeout((()=>window.location.reload()),2e3)):X.Ay.error(t.message||"Error al restaurar backup")}catch(e){console.error("Error restoring backup:",e),X.Ay.error("Error al restaurar backup")}finally{m(null)}}})(e.fileName),disabled:o===e.fileName,className:"p-2 text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-lg transition-colors disabled:opacity-50",title:"Restaurar backup"},o===e.fileName?r.createElement(O.A,{className:"h-5 w-5 animate-spin"}):r.createElement(Q.A,{className:"h-5 w-5"}))))))))),r.createElement("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4"},r.createElement("div",{className:"flex items-start gap-3"},r.createElement(W.A,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),r.createElement("div",{className:"text-sm text-blue-700 dark:text-blue-300"},r.createElement("p",{className:"font-medium mb-1"},"Información sobre backups:"),r.createElement("ul",{className:"list-disc list-inside space-y-1"},r.createElement("li",null,"Los backups automáticos se realizan diariamente a las 2:00 AM"),r.createElement("li",null,"Se realiza un backup completo semanal los domingos a las 3:00 AM"),r.createElement("li",null,"Se mantienen los últimos 30 backups, los más antiguos se eliminan automáticamente"),r.createElement("li",null,"Al restaurar un backup se perderán todos los cambios realizados después de ese punto"))))))},Z=t(50646),ee=()=>{const{user:e,updateUser:a,darkMode:t,toggleDarkMode:y}=(0,x.n)(),[v,f]=(0,r.useState)(!1),[N,h]=(0,r.useState)("false"!==localStorage.getItem("ai-assistant-enabled")),[w,k]=(0,r.useState)(localStorage.getItem("ai-default-mode")||"guided"),[A,C]=(0,r.useState)(localStorage.getItem("gemini-api-key")||""),[_,z]=(0,r.useState)((()=>Z.default.getServiceStatus())),j=[{id:"profile",label:"Perfil",icon:d.A},{id:"appearance",label:"Apariencia",icon:s.A},{id:"ai",label:"Asistente AI",icon:n.A},{id:"security",label:"Seguridad",icon:u.A},{id:"permissions",label:"Permisos",icon:g.A},{id:"backup",label:"Backup",icon:p.A}];return r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",null,r.createElement("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2"},r.createElement(b.A,{className:"h-6 w-6"})," Configuración"),r.createElement("p",{className:"text-gray-600 dark:text-gray-400 mt-1"},"Ajustes del sistema y preferencias personales"))),r.createElement(E,{tabs:j,render:a=>{switch(a){case"profile":return r.createElement(D,null);case"appearance":return r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6"},r.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4"},"Configuración de Tema"),r.createElement("div",{className:"space-y-4"},r.createElement("p",{className:"text-gray-600 dark:text-gray-400"},"Personaliza la apariencia de la aplicación según tus preferencias."),r.createElement("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},r.createElement("div",null,r.createElement("h4",{className:"font-medium text-gray-900 dark:text-white"},"Modo Oscuro"),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},t?"Actualmente usando modo oscuro":"Actualmente usando modo claro")),r.createElement(S.A,{onClick:y,variant:"outline",icon:s.A},t?"Cambiar a Modo Claro":"Cambiar a Modo Oscuro")))));case"security":return r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6"},r.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4"},"Gestión de Seguridad"),r.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6"},r.createElement("div",{className:"space-y-4"},r.createElement("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},r.createElement("h4",{className:"font-medium text-gray-900 dark:text-white mb-2"},"Sesiones Activas"),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3"},"Gestiona las sesiones activas en tu cuenta"),r.createElement(S.A,{onClick:()=>f(!0),variant:"outline",size:"sm",icon:l.A},"Ver Sesiones"))),r.createElement("div",{className:"space-y-4"},r.createElement("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},r.createElement("h4",{className:"font-medium text-gray-900 dark:text-white mb-2"},"Información de Cuenta"),r.createElement("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1"},r.createElement("p",null,"Usuario: ",e?.username||e?.email),r.createElement("p",null,"Rol: ",e?.role||"No asignado"),r.createElement("p",null,"Último acceso: ",e?.last_login?new Date(e.last_login).toLocaleString():"Desconocido")))))));case"permissions":return r.createElement(B,null);case"ai":return r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6"},r.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center gap-2"},r.createElement(n.A,{className:"w-5 h-5"}),"Configuración del Asistente AI"),r.createElement("div",{className:"space-y-6"},r.createElement("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},r.createElement("div",null,r.createElement("h4",{className:"font-medium text-gray-900 dark:text-white"},"Asistente AI Flotante"),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400"},"Muestra el botón flotante del asistente AI en la esquina inferior derecha")),r.createElement("button",{onClick:()=>{const e=!N;h(e),localStorage.setItem("ai-assistant-enabled",e.toString()),window.dispatchEvent(new CustomEvent("ai-assistant-toggle",{detail:{enabled:e}}))},className:"p-2"},N?r.createElement(c.A,{className:"w-10 h-6 text-blue-600"}):r.createElement(i.A,{className:"w-10 h-6 text-gray-400"}))),r.createElement("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},r.createElement("h4",{className:"font-medium text-gray-900 dark:text-white mb-3"},"Modo por Defecto"),r.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4"},"Elige qué modo del asistente se activa al abrir"),r.createElement("div",{className:"grid grid-cols-2 gap-4"},r.createElement("button",{onClick:()=>{k("guided"),localStorage.setItem("ai-default-mode","guided")},className:"p-4 rounded-lg border-2 transition-all "+("guided"===w?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300")},r.createElement("div",{className:"text-center"},r.createElement("div",{className:"text-2xl mb-2"},"🧙‍♂️"),r.createElement("h5",{className:"font-medium text-gray-900 dark:text-white"},"Modo Guiado"),r.createElement("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1"},"Asistente paso a paso con botones"))),r.createElement("button",{onClick:()=>{k("chat"),localStorage.setItem("ai-default-mode","chat")},className:"p-4 rounded-lg border-2 transition-all "+("chat"===w?"border-purple-500 bg-purple-50 dark:bg-purple-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300")},r.createElement("div",{className:"text-center"},r.createElement("div",{className:"text-2xl mb-2"},"💬"),r.createElement("h5",{className:"font-medium text-gray-900 dark:text-white"},"Modo Chat AI"),r.createElement("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1"},"Conversación libre con IA"))))),r.createElement("div",{className:"p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-700"},r.createElement("h4",{className:"font-medium text-purple-900 dark:text-purple-100 mb-3 flex items-center gap-2"},r.createElement(o.A,{className:"w-4 h-4"}),"Configuración de Gemini AI"),r.createElement("p",{className:"text-sm text-purple-800 dark:text-purple-200 mb-4"},"Para habilitar el chat AI con Gemini, necesitas una API key gratuita de Google"),r.createElement("div",{className:"space-y-3"},r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-purple-900 dark:text-purple-100 mb-2"},"API Key de Gemini"),r.createElement("div",{className:"flex gap-2"},r.createElement("input",{type:"password",value:A,onChange:e=>C(e.target.value),placeholder:"AIzaSy... (opcional)",className:"flex-1 px-3 py-2 border border-purple-300 dark:border-purple-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 dark:bg-purple-900/20"}),r.createElement(S.A,{onClick:()=>{const e=Z.default.setGeminiApiKey(A);z(Z.default.getServiceStatus()),e?alert("✅ API Key configurada correctamente"):alert("❌ Error al configurar API Key")},size:"sm",icon:m.A},"Guardar"))),r.createElement("div",{className:"flex items-center justify-between p-3 bg-purple-100 dark:bg-purple-800/30 rounded-lg"},r.createElement("div",null,r.createElement("p",{className:"text-sm font-medium text-purple-900 dark:text-purple-100"},"Estado: ",_.hasApiKey?_.geminiAvailable?"🟢 Conectado":"🟡 Verificando...":"⚪ Sin configurar"),r.createElement("p",{className:"text-xs text-purple-700 dark:text-purple-300"},"Requests hoy: ",_.dailyRequests,"/50",_.hasApiKey&&` (${_.remainingRequests} restantes)`)),!_.hasApiKey&&r.createElement("a",{href:"https://makersuite.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-purple-600 dark:text-purple-400 hover:underline"},"Obtener API Key →")))),r.createElement("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700"},r.createElement("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2"},"Atajos de Teclado"),r.createElement("div",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1"},r.createElement("p",null,"• ",r.createElement("kbd",{className:"px-2 py-1 bg-blue-100 dark:bg-blue-800 rounded"},"Ctrl")," + ",r.createElement("kbd",{className:"px-2 py-1 bg-blue-100 dark:bg-blue-800 rounded"},"Shift")," + ",r.createElement("kbd",{className:"px-2 py-1 bg-blue-100 dark:bg-blue-800 rounded"},"A")," - Abrir/Cerrar asistente"),r.createElement("p",null,"• ",r.createElement("kbd",{className:"px-2 py-1 bg-blue-100 dark:bg-blue-800 rounded"},"Esc")," - Cerrar asistente (cuando está abierto)"))))));case"backup":return r.createElement(Y,null);default:return null}}}),r.createElement(q,{isOpen:v,onClose:()=>f(!1)}))}}}]);