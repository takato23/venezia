<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test de NavegaciÃ³n - Venezia</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #2563eb;
      text-align: center;
      margin-bottom: 30px;
    }
    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .test-item {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 20px;
      background: #fafafa;
    }
    .test-item h3 {
      margin: 0 0 10px 0;
      color: #374151;
    }
    .test-item p {
      margin: 0 0 15px 0;
      color: #6b7280;
      font-size: 14px;
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
      margin-bottom: 5px;
    }
    button:hover {
      background: #1d4ed8;
    }
    .status {
      margin-top: 15px;
      padding: 10px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
    }
    .status.success {
      background: #dcfce7;
      color: #16a34a;
      border: 1px solid #bbf7d0;
    }
    .status.error {
      background: #fef2f2;
      color: #dc2626;
      border: 1px solid #fecaca;
    }
    .status.testing {
      background: #fef3c7;
      color: #d97706;
      border: 1px solid #fed7aa;
    }
    .summary {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 20px;
      margin-top: 30px;
    }
    .iframe-container {
      width: 100%;
      height: 400px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      margin-top: 15px;
      overflow: hidden;
    }
    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§ª Test de NavegaciÃ³n - Venezia</h1>
    
    <div class="test-grid" id="testGrid">
      <!-- Los items se generarÃ¡n dinÃ¡micamente -->
    </div>
    
    <div class="summary" id="summary">
      <h3>ğŸ“Š Resumen de Pruebas</h3>
      <p id="summaryText">Haz click en "Probar Todo" para comenzar las pruebas automÃ¡ticas.</p>
    </div>
    
    <div style="text-align: center; margin: 30px 0;">
      <button onclick="runAllTests()" style="background: #16a34a; font-size: 16px; padding: 15px 30px;">
        ğŸš€ Probar Todo
      </button>
      <button onclick="resetTests()" style="background: #6b7280;">
        ğŸ”„ Resetear
      </button>
    </div>
  </div>

  <script>
    // Definir las rutas a probar
    const routes = [
      {
        name: 'Dashboard',
        path: '/',
        description: 'PÃ¡gina principal con mÃ©tricas y resumen',
        criticalElements: ['.dashboard', '[data-testid="metrics"]']
      },
      {
        name: 'Productos',
        path: '/products',
        description: 'GestiÃ³n de productos y catÃ¡logo',
        criticalElements: ['.product-card', '[data-testid="products-list"]']
      },
      {
        name: 'Inventario',
        path: '/inventory',
        description: 'Control de stock e inventario',
        criticalElements: ['.inventory-table', '[data-testid="stock-data"]']
      },
      {
        name: 'ProducciÃ³n',
        path: '/production',
        description: 'Ã“rdenes y lotes de producciÃ³n',
        criticalElements: ['.production-orders', '[data-testid="batches"]']
      },
      {
        name: 'POS',
        path: '/pos',
        description: 'Punto de venta',
        criticalElements: ['.pos-interface', '[data-testid="cash-register"]']
      },
      {
        name: 'AnalÃ­ticas',
        path: '/analytics',
        description: 'Reportes y anÃ¡lisis',
        criticalElements: ['.analytics-charts', '[data-testid="reports"]']
      },
      {
        name: 'ConfiguraciÃ³n',
        path: '/settings',
        description: 'ConfiguraciÃ³n del sistema',
        criticalElements: ['.settings-panel', '[data-testid="config"]']
      },
      {
        name: 'Tienda Web',
        path: '/webshop',
        description: 'Interfaz de tienda web',
        criticalElements: ['.webshop', '[data-testid="products-grid"]']
      }
    ];

    let testResults = {};

    // Generar los items de prueba
    function generateTestItems() {
      const testGrid = document.getElementById('testGrid');
      testGrid.innerHTML = '';
      
      routes.forEach((route, index) => {
        const item = document.createElement('div');
        item.className = 'test-item';
        item.innerHTML = `
          <h3>${route.name}</h3>
          <p>${route.description}</p>
          <p><strong>Ruta:</strong> <code>${route.path}</code></p>
          <button onclick="testRoute('${route.path}', ${index})">ğŸ§ª Probar</button>
          <button onclick="openRoute('${route.path}')">ğŸ”— Abrir</button>
          <div class="status" id="status-${index}" style="display: none;"></div>
          <div class="iframe-container" id="iframe-${index}" style="display: none;">
            <iframe id="frame-${index}"></iframe>
          </div>
        `;
        testGrid.appendChild(item);
      });
    }

    // Probar una ruta especÃ­fica
    function testRoute(path, index) {
      const statusEl = document.getElementById(`status-${index}`);
      const iframeContainer = document.getElementById(`iframe-${index}`);
      const iframe = document.getElementById(`frame-${index}`);
      
      statusEl.style.display = 'block';
      statusEl.className = 'status testing';
      statusEl.textContent = 'ğŸ”„ Probando...';
      
      const testUrl = `http://localhost:5173${path}`;
      
      // Configurar iframe
      iframe.src = testUrl;
      iframeContainer.style.display = 'block';
      
      // Timer para detectar si carga exitosamente
      const timeout = setTimeout(() => {
        testResults[path] = { success: false, error: 'Timeout - No cargÃ³ en 10 segundos' };
        statusEl.className = 'status error';
        statusEl.textContent = 'âŒ Error: Timeout';
        updateSummary();
      }, 10000);
      
      iframe.onload = () => {
        clearTimeout(timeout);
        
        // Verificar si hay errores en la consola del iframe
        try {
          setTimeout(() => {
            const iframeWindow = iframe.contentWindow;
            if (iframeWindow && iframeWindow.document) {
              const hasError = iframeWindow.document.querySelector('.error-boundary, .error-message');
              if (hasError) {
                testResults[path] = { success: false, error: 'Error boundary detectado' };
                statusEl.className = 'status error';
                statusEl.textContent = 'âŒ Error en la pÃ¡gina';
              } else {
                testResults[path] = { success: true, error: null };
                statusEl.className = 'status success';
                statusEl.textContent = 'âœ… Carga exitosa';
              }
            } else {
              testResults[path] = { success: true, error: null };
              statusEl.className = 'status success';
              statusEl.textContent = 'âœ… Carga exitosa';
            }
            updateSummary();
          }, 2000);
        } catch (e) {
          // Cross-origin restrictions, pero la pÃ¡gina cargÃ³
          testResults[path] = { success: true, error: null };
          statusEl.className = 'status success';
          statusEl.textContent = 'âœ… Carga exitosa';
          updateSummary();
        }
      };
      
      iframe.onerror = () => {
        clearTimeout(timeout);
        testResults[path] = { success: false, error: 'Error al cargar iframe' };
        statusEl.className = 'status error';
        statusEl.textContent = 'âŒ Error al cargar';
        updateSummary();
      };
    }

    // Abrir ruta en nueva ventana
    function openRoute(path) {
      window.open(`http://localhost:5173${path}`, '_blank');
    }

    // Ejecutar todas las pruebas
    async function runAllTests() {
      testResults = {};
      for (let i = 0; i < routes.length; i++) {
        await new Promise(resolve => {
          testRoute(routes[i].path, i);
          setTimeout(resolve, 3000); // Esperar 3 segundos entre pruebas
        });
      }
    }

    // Resetear pruebas
    function resetTests() {
      testResults = {};
      routes.forEach((route, index) => {
        const statusEl = document.getElementById(`status-${index}`);
        const iframeContainer = document.getElementById(`iframe-${index}`);
        statusEl.style.display = 'none';
        iframeContainer.style.display = 'none';
      });
      updateSummary();
    }

    // Actualizar resumen
    function updateSummary() {
      const summaryText = document.getElementById('summaryText');
      const total = Object.keys(testResults).length;
      const passed = Object.values(testResults).filter(r => r.success).length;
      const failed = total - passed;
      
      if (total === 0) {
        summaryText.innerHTML = 'Haz click en "Probar Todo" para comenzar las pruebas automÃ¡ticas.';
        return;
      }
      
      let html = `
        <strong>Total probado:</strong> ${total}/${routes.length}<br>
        <strong>âœ… Exitosas:</strong> ${passed}<br>
        <strong>âŒ Fallaron:</strong> ${failed}
      `;
      
      if (failed > 0) {
        html += '<br><br><strong>ğŸš¨ Rutas con problemas:</strong><br>';
        Object.entries(testResults)
          .filter(([path, result]) => !result.success)
          .forEach(([path, result]) => {
            html += `â€¢ ${path} - ${result.error}<br>`;
          });
      }
      
      if (total === routes.length) {
        if (failed === 0) {
          html += '<br><strong>ğŸ‰ Â¡Todas las rutas funcionan correctamente!</strong>';
        } else {
          html += '<br><strong>ğŸ”§ Hay rutas que necesitan reparaciÃ³n.</strong>';
        }
      }
      
      summaryText.innerHTML = html;
    }

    // Inicializar
    generateTestItems();
  </script>
</body>
</html>